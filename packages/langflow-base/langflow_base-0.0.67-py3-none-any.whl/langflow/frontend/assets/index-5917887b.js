import{aR as ee,ax as u,j as o,au as ae,av as R,aS as O,u as P,h as $,aT as ne,aU as oe,az as se,aA as te,aV as re,r as C,aw as U,f as I,aW as A,I as L,aX as le,aD as de,aE as ce}from"./index-e2611c7b.js";import{H as ie}from"./index-3b1e07c0.js";import{I as fe}from"./input-20a61278.js";function ue(m){ee(m).then(d=>{const r=u.getState().folders.find(g=>g.id===m);d.folder_name=(r==null?void 0:r.name)||"folder",d.folder_description=(r==null?void 0:r.description)||"";const b=`data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(d))}`,l=document.createElement("a");l.href=b,l.download=`${d.folder_name}.json`,l.click()})}const pe=({items:m,pathname:d})=>o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:m.map(t=>o.jsx(ae,{to:t.href,children:o.jsxs("div",{"data-testid":`sidebar-nav-${t.title}`,className:R(O({variant:"ghost"}),d===t.href?"border border-border bg-muted hover:bg-muted":"border border-transparent hover:border-border hover:bg-transparent","flex w-full shrink-0 justify-start gap-4"),children:[t.icon,o.jsx("span",{className:"block max-w-full truncate opacity-100",children:t.title})]},t.title)}))}),me=pe,ge=(m,d)=>{const t=u(a=>a.setFolderDragging),r=u(a=>a.setFolderIdDragging),b=P(a=>a.setErrorData),l=u(a=>a.getFoldersApi),g=$(a=>a.flows),c=a=>{d&&d(a)},j=async a=>{if(a.dataTransfer.types.some(s=>s==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const s=a.dataTransfer.files[0];s.type==="application/json"?E(s):b({title:se,list:[te]})}},f=(a,s)=>{a.preventDefault(),a.dataTransfer.types.some(h=>h==="Files")&&t(!0),r(s)},w=(a,s)=>{a.dataTransfer.types.some(h=>h==="Files")&&t(!0),r(s),a.preventDefault()},N=a=>{a.preventDefault(),a.target===a.currentTarget&&(t(!1),r(""))},v=(a,s)=>{var h,F;if((h=a==null?void 0:a.dataTransfer)!=null&&h.getData("flow")){const x=JSON.parse((F=a==null?void 0:a.dataTransfer)==null?void 0:F.getData("flow"));if(x){T(x.id,s);return}}a.preventDefault(),j(a)},T=(a,s)=>{const h=g.find(S=>S.id===a);if(!h)throw new Error("Flow not found");const F={...h,folder_id:s},x=ne(F,g);F.name=x,t(!1),r(""),oe(F).then(()=>{l(!0),c(s)})},E=a=>{const s=new FormData;s.append("file",a),t(!1),r(""),re(s).then(()=>{l(!0),c(m)})};return{dragOver:f,dragEnter:w,dragLeave:N,onDrop:v}},he=({pathname:m,handleChangeFolder:d,handleDeleteFolder:t})=>{var _;const r=C.useRef(null),b=u(e=>e.setFolders),l=u(e=>e.folders),[g,c]=C.useState({}),j=$(e=>e.takeSnapshot),[f,w]=C.useState(l.map(e=>({name:e.name,edit:!1}))),N=u(e=>e.uploadFolder),v=m.split("/"),T=m.split("/").length<4,E=u(e=>e.myCollectionId),a=u(e=>e.getFoldersApi),s=u(e=>e.folderIdDragging),h=e=>T&&e===E?!0:v.includes(e),F=U(),x=((_=F==null?void 0:F.state)==null?void 0:_.folderId)??E,S=u(e=>e.getFolderById),z=P(e=>e.setErrorData),V=P(e=>e.setSuccessData),W=e=>{S(e)},{dragOver:H,dragEnter:J,dragLeave:K,onDrop:M}=ge(x,W),G=()=>{N(x).then(()=>{S(x),V({title:"Uploaded successfully"})}).catch(e=>{console.log(e),z({title:"Error on upload",list:[e.response.data]})})},X=e=>{ue(e)};function q(){ce({name:"New Folder",parent_id:null,description:""}).then(e=>{a(!0)})}function Q(e,B){const{target:{value:y}}=e;c(n=>({...n,[B]:y}))}return C.useEffect(()=>{l.map(e=>({name:e.name,edit:!1}))},[l]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between gap-2",children:[o.jsx("div",{className:"flex-1 self-start text-lg font-semibold",children:"Folders"}),o.jsx(I,{variant:"primary",size:"icon",className:"px-2",onClick:q,"data-testid":"add-folder-button",children:o.jsx(A,{name:"FolderPlus",className:"w-4"})}),o.jsx(I,{variant:"primary",size:"icon",className:"px-2",onClick:G,"data-testid":"upload-folder-button",children:o.jsx(A,{name:"Upload",className:"w-4"})})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:l.map((e,B)=>{const y=f==null?void 0:f.filter(n=>n.name===e.name)[0];return o.jsx("div",{onDragOver:n=>H(n,e.id),onDragEnter:n=>J(n,e.id),onDragLeave:K,onDrop:n=>M(n,e.id),"data-testid":`sidebar-nav-${e.name}`,className:R(O({variant:"ghost"}),h(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",s===e.id?"bg-border":""),onClick:()=>d(e.id),children:o.jsxs("div",{onDoubleClick:n=>{var D;if(e.name!=="My Projects"){if(g[e.name]||c({[e.name]:e.name}),(D=f.find(p=>p.name===e.name))!=null&&D.name){const p=f.map(i=>i.name===e.name?{name:e.name,edit:!0}:{name:i.name,edit:!1});w(p),j(),n.stopPropagation(),n.preventDefault();return}w(p=>[...p,{name:e.name,edit:!0}]),c(p=>({...p,[e.name]:e.name})),j(),n.stopPropagation(),n.preventDefault()}},className:"flex w-full items-center gap-4",children:[o.jsx(L,{name:"folder",className:"w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),y!=null&&y.edit?o.jsx("div",{children:o.jsx(fe,{className:"w-36",onChange:n=>{Q(n,e.name)},ref:r,onKeyDown:n=>{var D;if(n.key==="Escape"){const p=f.map(i=>i.name===e.name?{name:e.name,edit:!1}:{name:i.name,edit:!1});w(p),c({}),w(l.map(i=>({name:i.name,edit:!1})))}n.key==="Enter"&&((D=r.current)==null||D.blur()),le(n,n.key,"")},autoFocus:!0,onBlur:async()=>{var D,p;const n=f.map(i=>i.name===e.name?{name:e.name,edit:!1}:{name:i.name,edit:!1});if(w(n),g[e.name].trim()!==""){c(k=>({...k,[e.name]:g[e.name]}));const i={...e,name:g[e.name],flows:((D=e.flows)==null?void 0:D.length)>0?e.flows:[],components:((p=e.components)==null?void 0:p.length)>0?e.components:[]},Y=await de(i,e.id),Z=l.filter(k=>k.name!==e.name);b([...Z,Y]),c({}),w(l.map(k=>({name:k.name,edit:!1})))}else c(i=>({...i,[e.name]:e.name}))},value:g[e.name],id:`input-folder-${e.name}`,"data-testid":"input-folder"})}):o.jsx("span",{className:"block w-full truncate opacity-100",children:e.name}),B>0&&o.jsx(I,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{t(e),n.stopPropagation(),n.preventDefault()},variant:"ghost",children:o.jsx(L,{name:"trash",className:" w-4 stroke-[1.5]"})}),o.jsx(I,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{X(e.id),n.stopPropagation(),n.preventDefault()},size:"none",variant:"none",children:o.jsx(L,{name:"Download",className:"  w-4 stroke-[1.5] text-white  "})})]})},e.id)})})})]})},Fe=he;function De({className:m,items:d,handleChangeFolder:t,handleEditFolder:r,handleDeleteFolder:b,...l}){const c=U().pathname,j=u(v=>v.loading),f=u(v=>v.folders),N=["folder","components","flows","all"].some(v=>c.includes(v));return o.jsx("nav",{className:R(m),...l,children:o.jsx(ie,{children:d.length>0?o.jsx(me,{items:d,pathname:c}):!j&&(f==null?void 0:f.length)>0&&N&&o.jsx(Fe,{pathname:c,handleChangeFolder:t,handleDeleteFolder:b})})})}export{De as S};
