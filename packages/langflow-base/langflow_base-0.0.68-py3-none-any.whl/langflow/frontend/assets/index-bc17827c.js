import{r as m,j as e,av as _,I as b,aw as R,u as C,ax as w,ay as ie,az as de,aA as ue,h,y as P,S as I,f as O,ai as pe,au as me,aB as fe,aC as he}from"./index-e2611c7b.js";import{u as G,a as xe,F as ge}from"./form-7b5cd389.js";import{C as je,S as K,I as we}from"./index-edd22e82.js";import{P as ve}from"./index-acc74570.js";import{D as Se}from"./index-247761bc.js";import{N as De}from"./index-aedc17ba.js";import{C as be}from"./checkbox-bd626baa.js";import{c as Ce}from"./cloneDeep-69889649.js";import"./textarea-e833be5d.js";import"./index-0f7f4d3b.js";import"./index-64514ed8.js";import"./tabs-670de4f9.js";import"./index-5a634871.js";import"./input-20a61278.js";import"./table-a765fa31.js";import"./index-c9a8a184.js";import"./index-0b8f8dc4.js";import"./popover-bbb451e2.js";import"./index-19078874.js";function Ne({onFileDrop:t,children:o,dragMessage:r}){const[d,l]=m.useState(!1);m.useEffect(()=>{const a=()=>{document.visibilityState==="visible"&&l(!1)};return document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a)}},[]);const n=a=>{a.preventDefault(),a.dataTransfer.types.some(p=>p==="Files")&&t&&l(!0)},c=a=>{a.dataTransfer.types.some(p=>p==="Files")&&t&&l(!0),a.preventDefault()},i=a=>{a.preventDefault(),t&&l(!1)},u=a=>{a.preventDefault(),t&&t(a),l(!1)};return e.jsx("div",{onDragOver:n,onDragEnter:c,onDragLeave:i,onDrop:u,className:_("h-full w-full",d?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:d?e.jsxs(e.Fragment,{children:[e.jsx(b,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),r||"Drop your file here"]}):o})}const ye=(t,o)=>{var a;const r=R(),d=C(p=>p.setSuccessData),l=C(p=>p.setErrorData),n=w(p=>p.getFolderById),c=(a=r==null?void 0:r.state)==null?void 0:a.folderId,i=w(p=>p.myCollectionId);return[p=>{if(p.preventDefault(),p.dataTransfer.types.some(f=>f==="Files")){const f=p.dataTransfer.files.item(0);if(f.type==="application/json"){const j=new FileReader;j.onload=x=>{const S=x.target.result,y=JSON.parse(S).is_component;t({newProject:!0,file:f,isComponent:o==="all"?null:o==="component"}).then(()=>{d({title:`${y?"Component":"Flow"} uploaded successfully`}),n(c||i)}).catch(E=>{l({title:ie,list:[E]})})},j.readAsText(f)}else l({title:de,list:[ue]})}}]},Ee=t=>{switch(t){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},ke=(t,o)=>{const r=o==="component",d=(n,c)=>{const i=(n==null?void 0:n.updated_at)||(n==null?void 0:n.date_created),u=(c==null?void 0:c.updated_at)||(c==null?void 0:c.date_created);return i&&u?new Date(u).getTime()-new Date(i).getTime():i?1:u?-1:0},l=o==="all"?t:t==null?void 0:t.filter(n=>((n==null?void 0:n.is_component)??!1)===r);return(l==null?void 0:l.sort(d))??[]},Le=({})=>{h(r=>r.addFlow),P();const[t,o]=m.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-2 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1 ",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(De,{open:t,setOpen:o}),e.jsx("button",{onClick:()=>{o(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ðŸš€"})]})})})})},_e=({handleSelectAll:t,handleDelete:o,handleDuplicate:r,handleExport:d,disableFunctions:l})=>{const[n,c]=m.useState(!0),i=()=>{t(n),c(u=>!u)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center justify-self-start",children:e.jsx("a",{onClick:i,className:"cursor-pointer text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{checked:!n,id:"terms"}),e.jsx("span",{className:"label text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:n?"Select All":"Unselect All"})]})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{children:e.jsx(I,{content:l?e.jsx("span",{children:"Select items to export"}):e.jsx("span",{children:"Export selected items"}),children:e.jsx(O,{variant:"none",size:"none",onClick:d,disabled:l,children:e.jsx(b,{name:"FileDown",className:_("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(I,{content:l?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx(O,{variant:"none",size:"none",onClick:r,disabled:l,children:e.jsx(b,{name:"Copy",className:_("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(I,{content:l?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx(O,{variant:"none",size:"none",onClick:o,disabled:l,children:e.jsx(b,{name:"Trash2",className:_("h-5 w-5 text-primary transition-all",l?"":"hover:text-status-red")})})})})]})]})})},Oe=(t,o,r,d,l,n,c,i,u)=>({handleDeleteMultiple:m.useCallback(()=>{o(t).then(()=>{r(),d(!0),(!l||l===n)&&c(l||n),i({title:"Selected items deleted successfully"})}).catch(()=>{u({title:"Error deleting items",list:["Please try again"]})})},[t,o,r,d,l,n,c,i,u])}),Te=(t,o)=>m.useMemo(()=>{const d=n=>({all:"item",component:"component",flow:"flow"})[n]||"",l=n=>({all:"items",component:"components",flow:"flows"})[n]||"";return(t==null?void 0:t.length)===1?d(o):l(o)},[t,o]),Ae=(t,o,r)=>{m.useEffect(()=>{const l=Ce(t||[]).filter(n=>n.name.toLowerCase().includes(o.toLowerCase())||n.description.toLowerCase().includes(o.toLowerCase()));r(o===""?t:l)},[t,o,r])},Me=(t,o,r,d,l,n,c,i,u,a,p,f)=>({handleDuplicate:m.useCallback(()=>{Promise.all(t.map(x=>o(!0,r.find(S=>S.id===x)))).then(()=>{d(),l(!0),(!n||n===c)&&i(n||c),u({title:`${f} duplicated successfully`}),a([]),p(!1)})},[t,o,r,d,l,n,c,i,u,a,p,f])}),Fe=(t,o,r,d,l,n,c,i,u)=>({handleExport:m.useCallback(()=>{t.forEach(p=>{const f=o.find(j=>j.id===p);f&&r(d({id:f.id,data:f.data,description:f.description,name:f.name,last_tested_version:l,is_component:!1}),f.name,f.description)}),n({title:`${u} exported successfully`}),c([]),i(!1)},[t,o,r,d,l,n,c,i,u])}),Ie=(t,o,r)=>({handleSelectAll:m.useCallback(l=>{const n=t==null?void 0:t.map(c=>c.id);if(l){Object.keys(o()).forEach(c=>{n!=null&&n.includes(c)&&r(c,!0)});return}Object.keys(o()).forEach(c=>{r(c,!1)})},[t,o,r])}),Re=(t,o,r,d,l)=>({handleSelectOptionsChange:m.useCallback(c=>{if(!((t==null?void 0:t.length)>0)){o({title:"No items selected",list:["Please select items to delete"]});return}c==="delete"?r(!0):c==="duplicate"?d():c==="export"&&l()},[t,o,r,d,l])}),Pe=(t,o)=>{m.useEffect(()=>{if(!t||Object.keys(t).length===0)return;const r=Object.keys(t).filter(d=>t[d]===!0);o(r)},[t,o])};function ze({type:t="all"}){var W;const o=h(s=>s.uploadFlow),r=h(s=>s.removeFlow),d=h(s=>s.isLoading),l=h(s=>s.setAllFlows),n=h(s=>s.allFlows),c=w(s=>{var v;return(v=s.selectedFolder)==null?void 0:v.flows}),i=C(s=>s.setSuccessData),u=C(s=>s.setErrorData),[a,p]=m.useState(!1),f=h(s=>s.searchFlowsComponents),j=h(s=>s.setSelectedFlowsComponentsCards),x=h(s=>s.selectedFlowsComponentsCards),[S]=ye(o,t),[N,y]=m.useState(20),[E,z]=m.useState(1),q=P(),k=R(),T=ke(n,t),B=(E-1)*N,Q=B+N,g=T==null?void 0:T.slice(B,Q),X=Ee(t),D=(W=k==null?void 0:k.state)==null?void 0:W.folderId,A=w(s=>s.getFolderById),M=w(s=>s.myCollectionId),U=w(s=>s.getFoldersApi),Y=w(s=>s.setFolderUrl),Z=h(s=>s.addFlow),$=m.useMemo(()=>window.location.pathname.includes("components")?"Components":window.location.pathname.includes("flows")?"Flows":"Items",[window.location]);m.useEffect(()=>{Y(D??""),j([]),L(!1),A(D||M)},[k]),Ae(c,f,l);const H=()=>{z(1),y(20)},{getValues:V,control:J,setValue:ee}=G(),te=xe({control:J}),ne=G(),{handleSelectAll:L}=Ie(c,V,ee),{handleDuplicate:se}=Me(x,Z,n,H,U,D,M,A,i,j,L,$),oe=pe(s=>s.version),{handleExport:le}=Fe(x,n,he,fe,oe,i,j,L,$),{handleSelectOptionsChange:F}=Re(x,u,p,se,le),{handleDeleteMultiple:ae}=Oe(x,r,H,U,D,M,A,i,u);Pe(te,j);const re=Te(x,t),ce=()=>{var s;return t==="all"?n==null?void 0:n.length:(s=n==null?void 0:n.filter(v=>(v.is_component??!1)===(t==="component")))==null?void 0:s.length};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full gap-4 pb-5",children:(n==null?void 0:n.length)>0&&e.jsx(_e,{handleDelete:()=>F("delete"),handleSelectAll:L,handleDuplicate:()=>F("duplicate"),handleExport:()=>F("export"),disableFunctions:!((x==null?void 0:x.length)>0)})}),e.jsx(Ne,{onFileDrop:S,dragMessage:`Drag your ${X} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!d&&(g==null?void 0:g.length)===0?e.jsx(Le,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:d===!1&&(g==null?void 0:g.length)>0?e.jsx(e.Fragment,{children:g==null?void 0:g.map(s=>m.createElement(ge,{...ne,key:s.id},e.jsx("form",{children:e.jsx(je,{is_component:t==="component",data:{is_component:s.is_component??!1,...s},disabled:d,"data-testid":"edit-flow-button-"+s.id,button:s.is_component?e.jsx(e.Fragment,{}):e.jsx(me,{to:"/flow/"+s.id,children:e.jsxs(O,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":"edit-flow-button-"+s.id,children:[e.jsx(b,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})}),onClick:s.is_component?void 0:()=>{q("/flow/"+s.id)},playground:!s.is_component,control:J})})))}):e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(K,{})]})})}),!d&&(g==null?void 0:g.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(ve,{storeComponent:!0,pageIndex:E,pageSize:N,rowsCount:[10,20,50,100],totalRowsCount:ce(),paginate:(s,v)=>{z(v),y(s)}})})]})}),a&&e.jsx(Se,{open:a,setOpen:p,onConfirm:ae,description:re,children:e.jsx(e.Fragment,{})})]})}const Be=({tabsOptions:t,setActiveTab:o,loading:r,tabActive:d})=>{const l=P(),n=w(i=>i.folderUrl),c=i=>{const u=window.location.pathname;let a="";switch(i){case"Flows":a=u.replace(/components|all/,"flows");break;case"Components":a=u.replace(/flows|all/,"components");break;default:a=u.replace(/flows|components/,"all");break}l(a,{state:{folderId:n}})};return m.useEffect(()=>{const i=window.location.pathname;i.includes("components")?o("Components"):i.includes("flows")?o("Flows"):o("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:t.map((i,u)=>e.jsx("button",{"data-testid":`${i}-button-store`,disabled:r,onClick:()=>{c(i)},className:(d===i?"border-b-2 border-primary p-3":" border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(r?" cursor-not-allowed ":""),children:i},u))})})},Ue=({})=>{var u;const t=R(),o=w(a=>a.myCollectionId);(u=t==null?void 0:t.state)!=null&&u.folderId;const r=h(a=>a.isLoading),[d,l]=m.useState("Flows");C(a=>a.setErrorData),h(a=>a.allFlows);const[n,c]=m.useState(""),i=h(a=>a.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(we,{loading:r,value:n,onChange:a=>{i(a.target.value),c(a.target.value)},onKeyDown:a=>{a.key==="Enter"&&i(n)}}),e.jsx(Be,{tabsOptions:["All","Flows","Components"],setActiveTab:l,loading:r,tabActive:d})]})})},rt=({type:t})=>e.jsxs(e.Fragment,{children:[e.jsx(Ue,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx(ze,{type:t},t)})]});export{rt as default};
