{"ast":null,"code":"import _regeneratorRuntime from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/runner/work/inference/inference/xinference/web/ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Box,FormControl,InputLabel,MenuItem,Select}from'@mui/material';import React,{useContext,useEffect,useState}from'react';import{ApiContext}from'../../components/apiContext';import fetcher from'../../components/fetcher';import HotkeyFocusTextField from'../../components/hotkeyFocusTextField';import ModelCard from'./modelCard';import style from'./styles/launchModelStyle';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LaunchModelComponent=function LaunchModelComponent(_ref){var modelType=_ref.modelType,gpuAvailable=_ref.gpuAvailable;var endPoint=useContext(ApiContext).endPoint;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),registrationData=_useState2[0],setRegistrationData=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),searchTerm=_useState4[0],setSearchTerm=_useState4[1];var _useState5=useState('all'),_useState6=_slicedToArray(_useState5,2),status=_useState6[0],setStatus=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),completeDeleteArr=_useState8[0],setCompleteDeleteArr=_useState8[1];var _useContext=useContext(ApiContext),isCallingApi=_useContext.isCallingApi,setIsCallingApi=_useContext.setIsCallingApi;var _useContext2=useContext(ApiContext),isUpdatingModel=_useContext2.isUpdatingModel;var handleChange=function handleChange(e){setSearchTerm(e.target.value);};var handleStatusChange=function handleStatusChange(event){setStatus(event.target.value);};var filter=function filter(registration){if(!registration||typeof searchTerm!=='string')return false;var modelName=registration.model_name?registration.model_name.toLowerCase():'';if(!modelName.includes(searchTerm.toLowerCase())){return false;}if(completeDeleteArr.includes(registration.model_name)){registration.cache_status=Array.isArray(registration.cache_status)?[false]:false;}if(status&&status!=='all'){if(registration.cache_status&&!completeDeleteArr.includes(registration.model_name)){return true;}else{return false;}}return true;};var handleCompleteDelete=function handleCompleteDelete(model_name){setCompleteDeleteArr([].concat(_toConsumableArray(completeDeleteArr),[model_name]));};var update=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,registrations,builtinModels;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(isCallingApi||isUpdatingModel)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;setIsCallingApi(true);_context.next=6;return fetcher(\"\".concat(endPoint,\"/v1/model_registrations/\").concat(modelType,\"?detailed=true\"),{method:'GET'});case 6:response=_context.sent;_context.next=9;return response.json();case 9:registrations=_context.sent;builtinModels=registrations.filter(function(v){return v.is_builtin;});setRegistrationData(builtinModels);_context.next=17;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](2);console.error('Error:',_context.t0);case 17:_context.prev=17;setIsCallingApi(false);return _context.finish(17);case 20:case\"end\":return _context.stop();}},_callee,null,[[2,14,17,20]]);}));return function update(){return _ref2.apply(this,arguments);};}();useEffect(function(){update();},[]);return/*#__PURE__*/_jsxs(Box,{m:\"20px\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'150px 1fr',columnGap:'20px',margin:'30px 2rem'},children:[/*#__PURE__*/_jsxs(FormControl,{variant:\"outlined\",margin:\"normal\",children:[/*#__PURE__*/_jsx(InputLabel,{id:\"select-status\",children:\"Status\"}),/*#__PURE__*/_jsxs(Select,{id:\"status\",labelId:\"select-status\",label:\"Status\",onChange:handleStatusChange,value:status,size:\"small\",sx:{width:'150px'},children:[/*#__PURE__*/_jsx(MenuItem,{value:\"all\",children:\"all\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"cached\",children:\"cached\"})]})]}),/*#__PURE__*/_jsx(FormControl,{variant:\"outlined\",margin:\"normal\",children:/*#__PURE__*/_jsx(HotkeyFocusTextField,{id:\"search\",type:\"search\",label:\"Search for \".concat(modelType,\" model name\"),value:searchTerm,onChange:handleChange,size:\"small\",hotkey:\"/\"})})]}),/*#__PURE__*/_jsx(\"div\",{style:style,children:registrationData.filter(function(registration){return filter(registration);}).map(function(filteredRegistration){return/*#__PURE__*/_jsx(ModelCard,{url:endPoint,modelData:filteredRegistration,modelType:modelType,gpuAvailable:gpuAvailable,onHandleCompleteDelete:handleCompleteDelete},filteredRegistration.model_name);})})]});};export default LaunchModelComponent;","map":{"version":3,"names":["Box","FormControl","InputLabel","MenuItem","Select","React","useContext","useEffect","useState","ApiContext","fetcher","HotkeyFocusTextField","ModelCard","style","jsx","_jsx","jsxs","_jsxs","LaunchModelComponent","_ref","modelType","gpuAvailable","endPoint","_useState","_useState2","_slicedToArray","registrationData","setRegistrationData","_useState3","_useState4","searchTerm","setSearchTerm","_useState5","_useState6","status","setStatus","_useState7","_useState8","completeDeleteArr","setCompleteDeleteArr","_useContext","isCallingApi","setIsCallingApi","_useContext2","isUpdatingModel","handleChange","e","target","value","handleStatusChange","event","filter","registration","modelName","model_name","toLowerCase","includes","cache_status","Array","isArray","handleCompleteDelete","concat","_toConsumableArray","update","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","registrations","builtinModels","wrap","_callee$","_context","prev","next","abrupt","method","sent","json","v","is_builtin","t0","console","error","finish","stop","apply","arguments","m","children","display","gridTemplateColumns","columnGap","margin","variant","id","labelId","label","onChange","size","sx","width","type","hotkey","map","filteredRegistration","url","modelData","onHandleCompleteDelete"],"sources":["/home/runner/work/inference/inference/xinference/web/ui/src/scenes/launch_model/LaunchModelComponent.js"],"sourcesContent":["import { Box, FormControl, InputLabel, MenuItem, Select } from '@mui/material'\nimport React, { useContext, useEffect, useState } from 'react'\n\nimport { ApiContext } from '../../components/apiContext'\nimport fetcher from '../../components/fetcher'\nimport HotkeyFocusTextField from '../../components/hotkeyFocusTextField'\nimport ModelCard from './modelCard'\nimport style from './styles/launchModelStyle'\n\nconst LaunchModelComponent = ({ modelType, gpuAvailable }) => {\n  let endPoint = useContext(ApiContext).endPoint\n  const [registrationData, setRegistrationData] = useState([])\n  const [searchTerm, setSearchTerm] = useState('')\n  const [status, setStatus] = useState('all')\n  const [completeDeleteArr, setCompleteDeleteArr] = useState([])\n\n  const { isCallingApi, setIsCallingApi } = useContext(ApiContext)\n  const { isUpdatingModel } = useContext(ApiContext)\n\n  const handleChange = (e) => {\n    setSearchTerm(e.target.value)\n  }\n\n  const handleStatusChange = (event) => {\n    setStatus(event.target.value)\n  }\n\n  const filter = (registration) => {\n    if (!registration || typeof searchTerm !== 'string') return false\n    const modelName = registration.model_name\n      ? registration.model_name.toLowerCase()\n      : ''\n    if (!modelName.includes(searchTerm.toLowerCase())) {\n      return false\n    }\n    if (completeDeleteArr.includes(registration.model_name)) {\n      registration.cache_status = Array.isArray(registration.cache_status)\n        ? [false]\n        : false\n    }\n    if (status && status !== 'all') {\n      if (\n        registration.cache_status &&\n        !completeDeleteArr.includes(registration.model_name)\n      ) {\n        return true\n      } else {\n        return false\n      }\n    }\n    return true\n  }\n\n  const handleCompleteDelete = (model_name) => {\n    setCompleteDeleteArr([...completeDeleteArr, model_name])\n  }\n\n  const update = async () => {\n    if (isCallingApi || isUpdatingModel) return\n\n    try {\n      setIsCallingApi(true)\n\n      const response = await fetcher(\n        `${endPoint}/v1/model_registrations/${modelType}?detailed=true`,\n        {\n          method: 'GET',\n        }\n      )\n\n      const registrations = await response.json()\n\n      const builtinModels = registrations.filter((v) => {\n        return v.is_builtin\n      })\n      setRegistrationData(builtinModels)\n    } catch (error) {\n      console.error('Error:', error)\n    } finally {\n      setIsCallingApi(false)\n    }\n  }\n\n  useEffect(() => {\n    update()\n  }, [])\n\n  return (\n    <Box m=\"20px\">\n      <div\n        style={{\n          display: 'grid',\n          gridTemplateColumns: '150px 1fr',\n          columnGap: '20px',\n          margin: '30px 2rem',\n        }}\n      >\n        <FormControl variant=\"outlined\" margin=\"normal\">\n          <InputLabel id=\"select-status\">Status</InputLabel>\n          <Select\n            id=\"status\"\n            labelId=\"select-status\"\n            label=\"Status\"\n            onChange={handleStatusChange}\n            value={status}\n            size=\"small\"\n            sx={{ width: '150px' }}\n          >\n            <MenuItem value=\"all\">all</MenuItem>\n            <MenuItem value=\"cached\">cached</MenuItem>\n          </Select>\n        </FormControl>\n        <FormControl variant=\"outlined\" margin=\"normal\">\n          <HotkeyFocusTextField\n            id=\"search\"\n            type=\"search\"\n            label={`Search for ${modelType} model name`}\n            value={searchTerm}\n            onChange={handleChange}\n            size=\"small\"\n            hotkey=\"/\"\n          />\n        </FormControl>\n      </div>\n      <div style={style}>\n        {registrationData\n          .filter((registration) => filter(registration))\n          .map((filteredRegistration) => (\n            <ModelCard\n              key={filteredRegistration.model_name}\n              url={endPoint}\n              modelData={filteredRegistration}\n              modelType={modelType}\n              gpuAvailable={gpuAvailable}\n              onHandleCompleteDelete={handleCompleteDelete}\n            />\n          ))}\n      </div>\n    </Box>\n  )\n}\n\nexport default LaunchModelComponent\n"],"mappings":"4kBAAA,OAASA,GAAG,CAAEC,WAAW,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,MAAM,KAAQ,eAAe,CAC9E,MAAO,CAAAC,KAAK,EAAIC,UAAU,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAE9D,OAASC,UAAU,KAAQ,6BAA6B,CACxD,MAAO,CAAAC,OAAO,KAAM,0BAA0B,CAC9C,MAAO,CAAAC,oBAAoB,KAAM,uCAAuC,CACxE,MAAO,CAAAC,SAAS,KAAM,aAAa,CACnC,MAAO,CAAAC,KAAK,KAAM,2BAA2B,QAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAE7C,GAAM,CAAAC,oBAAoB,CAAG,QAAvB,CAAAA,oBAAoBA,CAAAC,IAAA,CAAoC,IAA9B,CAAAC,SAAS,CAAAD,IAAA,CAATC,SAAS,CAAEC,YAAY,CAAAF,IAAA,CAAZE,YAAY,CACrD,GAAI,CAAAC,QAAQ,CAAGhB,UAAU,CAACG,UAAU,CAAC,CAACa,QAAQ,CAC9C,IAAAC,SAAA,CAAgDf,QAAQ,CAAC,EAAE,CAAC,CAAAgB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAArDG,gBAAgB,CAAAF,UAAA,IAAEG,mBAAmB,CAAAH,UAAA,IAC5C,IAAAI,UAAA,CAAoCpB,QAAQ,CAAC,EAAE,CAAC,CAAAqB,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAAzCE,UAAU,CAAAD,UAAA,IAAEE,aAAa,CAAAF,UAAA,IAChC,IAAAG,UAAA,CAA4BxB,QAAQ,CAAC,KAAK,CAAC,CAAAyB,UAAA,CAAAR,cAAA,CAAAO,UAAA,IAApCE,MAAM,CAAAD,UAAA,IAAEE,SAAS,CAAAF,UAAA,IACxB,IAAAG,UAAA,CAAkD5B,QAAQ,CAAC,EAAE,CAAC,CAAA6B,UAAA,CAAAZ,cAAA,CAAAW,UAAA,IAAvDE,iBAAiB,CAAAD,UAAA,IAAEE,oBAAoB,CAAAF,UAAA,IAE9C,IAAAG,WAAA,CAA0ClC,UAAU,CAACG,UAAU,CAAC,CAAxDgC,YAAY,CAAAD,WAAA,CAAZC,YAAY,CAAEC,eAAe,CAAAF,WAAA,CAAfE,eAAe,CACrC,IAAAC,YAAA,CAA4BrC,UAAU,CAACG,UAAU,CAAC,CAA1CmC,eAAe,CAAAD,YAAA,CAAfC,eAAe,CAEvB,GAAM,CAAAC,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAIC,CAAC,CAAK,CAC1Bf,aAAa,CAACe,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAC/B,CAAC,CAED,GAAM,CAAAC,kBAAkB,CAAG,QAArB,CAAAA,kBAAkBA,CAAIC,KAAK,CAAK,CACpCf,SAAS,CAACe,KAAK,CAACH,MAAM,CAACC,KAAK,CAAC,CAC/B,CAAC,CAED,GAAM,CAAAG,MAAM,CAAG,QAAT,CAAAA,MAAMA,CAAIC,YAAY,CAAK,CAC/B,GAAI,CAACA,YAAY,EAAI,MAAO,CAAAtB,UAAU,GAAK,QAAQ,CAAE,MAAO,MAAK,CACjE,GAAM,CAAAuB,SAAS,CAAGD,YAAY,CAACE,UAAU,CACrCF,YAAY,CAACE,UAAU,CAACC,WAAW,CAAC,CAAC,CACrC,EAAE,CACN,GAAI,CAACF,SAAS,CAACG,QAAQ,CAAC1B,UAAU,CAACyB,WAAW,CAAC,CAAC,CAAC,CAAE,CACjD,MAAO,MAAK,CACd,CACA,GAAIjB,iBAAiB,CAACkB,QAAQ,CAACJ,YAAY,CAACE,UAAU,CAAC,CAAE,CACvDF,YAAY,CAACK,YAAY,CAAGC,KAAK,CAACC,OAAO,CAACP,YAAY,CAACK,YAAY,CAAC,CAChE,CAAC,KAAK,CAAC,CACP,KAAK,CACX,CACA,GAAIvB,MAAM,EAAIA,MAAM,GAAK,KAAK,CAAE,CAC9B,GACEkB,YAAY,CAACK,YAAY,EACzB,CAACnB,iBAAiB,CAACkB,QAAQ,CAACJ,YAAY,CAACE,UAAU,CAAC,CACpD,CACA,MAAO,KAAI,CACb,CAAC,IAAM,CACL,MAAO,MAAK,CACd,CACF,CACA,MAAO,KAAI,CACb,CAAC,CAED,GAAM,CAAAM,oBAAoB,CAAG,QAAvB,CAAAA,oBAAoBA,CAAIN,UAAU,CAAK,CAC3Cf,oBAAoB,IAAAsB,MAAA,CAAAC,kBAAA,CAAKxB,iBAAiB,GAAEgB,UAAU,EAAC,CAAC,CAC1D,CAAC,CAED,GAAM,CAAAS,MAAM,6BAAAC,KAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA,MAAAC,QAAA,CAAAC,aAAA,CAAAC,aAAA,QAAAL,mBAAA,GAAAM,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,cACTnC,YAAY,EAAIG,eAAe,GAAA8B,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAG,MAAA,kBAAAH,QAAA,CAAAC,IAAA,GAGjCjC,eAAe,CAAC,IAAI,CAAC,CAAAgC,QAAA,CAAAE,IAAA,SAEE,CAAAlE,OAAO,IAAAmD,MAAA,CACzBvC,QAAQ,6BAAAuC,MAAA,CAA2BzC,SAAS,mBAC/C,CACE0D,MAAM,CAAE,KACV,CACF,CAAC,QALKT,QAAQ,CAAAK,QAAA,CAAAK,IAAA,CAAAL,QAAA,CAAAE,IAAA,SAOc,CAAAP,QAAQ,CAACW,IAAI,CAAC,CAAC,QAArCV,aAAa,CAAAI,QAAA,CAAAK,IAAA,CAEbR,aAAa,CAAGD,aAAa,CAACnB,MAAM,CAAC,SAAC8B,CAAC,CAAK,CAChD,MAAO,CAAAA,CAAC,CAACC,UAAU,CACrB,CAAC,CAAC,CACFvD,mBAAmB,CAAC4C,aAAa,CAAC,CAAAG,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAAS,EAAA,CAAAT,QAAA,aAElCU,OAAO,CAACC,KAAK,CAAC,QAAQ,CAAAX,QAAA,CAAAS,EAAO,CAAC,SAAAT,QAAA,CAAAC,IAAA,IAE9BjC,eAAe,CAAC,KAAK,CAAC,QAAAgC,QAAA,CAAAY,MAAA,8BAAAZ,QAAA,CAAAa,IAAA,MAAAnB,OAAA,uBAEzB,kBAxBK,CAAAL,MAAMA,CAAA,SAAAC,KAAA,CAAAwB,KAAA,MAAAC,SAAA,OAwBX,CAEDlF,SAAS,CAAC,UAAM,CACdwD,MAAM,CAAC,CAAC,CACV,CAAC,CAAE,EAAE,CAAC,CAEN,mBACE9C,KAAA,CAACjB,GAAG,EAAC0F,CAAC,CAAC,MAAM,CAAAC,QAAA,eACX1E,KAAA,QACEJ,KAAK,CAAE,CACL+E,OAAO,CAAE,MAAM,CACfC,mBAAmB,CAAE,WAAW,CAChCC,SAAS,CAAE,MAAM,CACjBC,MAAM,CAAE,WACV,CAAE,CAAAJ,QAAA,eAEF1E,KAAA,CAAChB,WAAW,EAAC+F,OAAO,CAAC,UAAU,CAACD,MAAM,CAAC,QAAQ,CAAAJ,QAAA,eAC7C5E,IAAA,CAACb,UAAU,EAAC+F,EAAE,CAAC,eAAe,CAAAN,QAAA,CAAC,QAAM,CAAY,CAAC,cAClD1E,KAAA,CAACb,MAAM,EACL6F,EAAE,CAAC,QAAQ,CACXC,OAAO,CAAC,eAAe,CACvBC,KAAK,CAAC,QAAQ,CACdC,QAAQ,CAAEnD,kBAAmB,CAC7BD,KAAK,CAAEd,MAAO,CACdmE,IAAI,CAAC,OAAO,CACZC,EAAE,CAAE,CAAEC,KAAK,CAAE,OAAQ,CAAE,CAAAZ,QAAA,eAEvB5E,IAAA,CAACZ,QAAQ,EAAC6C,KAAK,CAAC,KAAK,CAAA2C,QAAA,CAAC,KAAG,CAAU,CAAC,cACpC5E,IAAA,CAACZ,QAAQ,EAAC6C,KAAK,CAAC,QAAQ,CAAA2C,QAAA,CAAC,QAAM,CAAU,CAAC,EACpC,CAAC,EACE,CAAC,cACd5E,IAAA,CAACd,WAAW,EAAC+F,OAAO,CAAC,UAAU,CAACD,MAAM,CAAC,QAAQ,CAAAJ,QAAA,cAC7C5E,IAAA,CAACJ,oBAAoB,EACnBsF,EAAE,CAAC,QAAQ,CACXO,IAAI,CAAC,QAAQ,CACbL,KAAK,eAAAtC,MAAA,CAAgBzC,SAAS,eAAc,CAC5C4B,KAAK,CAAElB,UAAW,CAClBsE,QAAQ,CAAEvD,YAAa,CACvBwD,IAAI,CAAC,OAAO,CACZI,MAAM,CAAC,GAAG,CACX,CAAC,CACS,CAAC,EACX,CAAC,cACN1F,IAAA,QAAKF,KAAK,CAAEA,KAAM,CAAA8E,QAAA,CACfjE,gBAAgB,CACdyB,MAAM,CAAC,SAACC,YAAY,QAAK,CAAAD,MAAM,CAACC,YAAY,CAAC,GAAC,CAC9CsD,GAAG,CAAC,SAACC,oBAAoB,qBACxB5F,IAAA,CAACH,SAAS,EAERgG,GAAG,CAAEtF,QAAS,CACduF,SAAS,CAAEF,oBAAqB,CAChCvF,SAAS,CAAEA,SAAU,CACrBC,YAAY,CAAEA,YAAa,CAC3ByF,sBAAsB,CAAElD,oBAAqB,EALxC+C,oBAAoB,CAACrD,UAM3B,CAAC,EACH,CAAC,CACD,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAApC,oBAAoB"},"metadata":{},"sourceType":"module","externalDependencies":[]}