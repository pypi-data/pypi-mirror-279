import{d as J,N as P,M as H,b3 as ie,o as p,n as T,w as s,a as l,Q as q,b as x,f as V,V as n,dd as Q,cC as W,O as K,cA as X,dE as ae,q as se,p as M,c as w,r as A,F as C,c3 as L,dF as re,cy as de,dG as y,aV as O,dH as ne,m as R}from"./index-lT0LPxUj.js";const ce=J({__name:"ExportDialog",props:{modelDBStore:{},projectDBStore:{}},setup(B){const f=B,h=P(()=>f.modelDBStore),S=P(()=>f.projectDBStore),e=H({items:[],selected:[]}),D=[{title:"Name",value:"name"},{title:"Created at",key:"props.createdAt"}],U=()=>{ae(JSON.stringify(e.selected.map(d=>d.props))),e.selected=[]},F=()=>{e.selected=[],e.items=[],h.value.state.models.forEach(d=>{e.items.push({group:"model",name:d.label,props:d.toJSON()})}),S.value.state.projects.forEach(d=>{e.items.push({group:"project",name:d.name,props:d.doc?d.toJSON():d})})};return ie(()=>{F()}),(d,m)=>(p(),T(X,{"max-width":"1280"},{default:s(({isActive:v})=>[l(K,null,{default:s(()=>[l(q,{class:"d-flex justify-space-between align-center"},{default:s(()=>[l(x,{icon:"mdi:mdi-export",size:"small"}),V(" Export "),l(n,{onClick:c=>v.value=!1,flat:"",icon:"mdi:mdi-close",size:"small"},null,8,["onClick"])]),_:2},1024),l(Q,{"group-by":[{key:"group",order:"asc"}],headers:D,items:e.items,"item-selectable":"valid","item-value":"name","return-object":"","show-select":"",modelValue:e.selected,"onUpdate:modelValue":m[0]||(m[0]=c=>e.selected=c)},{"item.valid":s(({value:c})=>[l(x,{color:c?"success":"error",icon:c?"mdi-check":"mdi-close"},null,8,["color","icon"])]),_:1},8,["items","modelValue"]),l(W,null,{default:s(()=>[l(n,{disabled:e.selected.length===0,onClick:()=>{U(),v.value=!1},"prepend-icon":"mdi:mdi-export",size:"small",text:"export selected",variant:"outlined"},null,8,["disabled","onClick"]),l(n,{onClick:m[1]||(m[1]=c=>F()),"prepend-icon":"mdi:mdi-reload",size:"small",text:"Reload",variant:"outlined"}),l(n,{onClick:c=>v.value=!1,size:"small",text:"close",variant:"outlined"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1}))}}),me=J({__name:"ImportDialog",props:{modelDBStore:{},projectDBStore:{}},setup(B){const f=B,h=P(()=>f.modelDBStore),S=P(()=>f.projectDBStore),e=H({githubFiles:[],githubGroup:"project",githubSelectedFile:{path:""},githubSelectedTree:{path:""},githubTag:"v3",githubTrees:[],items:[],selected:[],source:"",url:""}),D=[{icon:"network:network",title:"Import projects",value:"projects"},{icon:"nest:logo",title:"Import models",value:"models"}],U=[{icon:"mdi:mdi-paperclip",title:"Import from drive",value:"drive"},{icon:"mdi:mdi-github",title:"Import from GitHub",value:"github"},{icon:"mdi:mdi-web",title:"Import from URL",value:"url"}],F=[{title:"Name",value:"name"},{title:"Created at",key:"props.createdAt"},{title:"Version",key:"props.version"},{title:"Valid",key:"valid"}],d=i=>`https://api.github.com/repos/nest-desktop/nest-desktop-${e.githubGroup}/git/trees/`,m=i=>`https://raw.githubusercontent.com/nest-desktop/nest-desktop-${i||e.githubGroup}/${e.githubTag}/`,v=i=>{if(i==null)return;(Array.isArray(i)?i:[i]).forEach(a=>{var I,N;let o=!1;const r="elementType"in a?"model":"network"in a?"project":void 0;if(r===void 0)return;const g=[];let k,$,E="";switch(r){case"model":$=a,E=$.label||"",o=h.value.validateModel($);break;case"project":k=a,E=k.name||"",o=S.value.validateProject(k);const j=k.network;j&&ne(j)&&((I=j.models)==null||I.forEach(u=>{u.existing&&!h.value.hasModel(u.existing)&&!g.includes(u.existing)&&g.push(u.existing)})),(N=j.nodes)==null||N.forEach(u=>{if(!("model"in u))return;const b=u;b.model&&!h.value.hasModel(b.model)&&!g.includes(b.model)&&g.push(b.model)}),y.get(m("models")+"index.json").then(u=>{u.data&&g.forEach(b=>{const _=u.data[b];_&&c(_,b)})});break}e.items.push({group:r,name:E,props:a,valid:o})})},c=(i,t)=>{y.get(m("models")+i).then(a=>{if(!a.data)return;const r=(Array.isArray(a.data)?a.data:[a.data]).find(k=>k.id===t);if(!r)return;const g=h.value.validateModel(f);e.items.push({group:"model",name:r.label||"",props:r,valid:g})})},Y=i=>{e.githubSelectedFile={path:""},e.githubFiles=[],y.get(d()+i.sha).then(t=>{e.githubFiles=t.data.tree.filter(a=>a.type==="blob"&&a.path.endsWith(".json"))})},Z=()=>{e.githubSelectedTree={path:""},e.githubSelectedFile={path:""},e.githubFiles=[],e.githubTrees=[],O(()=>{y.get(d()+`${e.githubTag}?recursive=true`).then(i=>{e.githubTrees=i.data.tree.filter(t=>t.type==="tree")})})},G=i=>{e.url.length!==0&&y.get(e.url).then(t=>v(t.data))},ee=()=>{te(),le()},te=()=>{const i=e.selected.filter(t=>t.group==="model").map(t=>t.props);h.value.importModels(i)},le=()=>{const i=e.selected.filter(t=>t.group==="project").map(t=>t.props);S.value.importProjects(i)},z=i=>{const t=Array.isArray(i)?i[0]:i;if(!t)return;const a=new FileReader;a.readAsText(t),a.addEventListener("load",o=>{var r;return v(JSON.parse((r=o.target)==null?void 0:r.result))})},oe=()=>{O(()=>{const i=e.githubSelectedTree;!i&&!Object.keys(i).includes("path")||(e.url=m()+`${i.path}/${e.githubSelectedFile.path}`)})};return(i,t)=>(p(),T(X,{"max-width":"1280"},{default:s(({isActive:a})=>[l(K,null,{default:s(()=>[l(q,{class:"d-flex justify-space-between align-center"},{default:s(()=>[l(x,{icon:"mdi:mdi-import",size:"small"}),V(" Import "),l(n,{onClick:o=>a.value=!1,flat:"",icon:"mdi:mdi-close",size:"small"},null,8,["onClick"])]),_:2},1024),l(se,{class:"px-2",color:"transparent",density:"compact"},{default:s(()=>[l(M,{class:"mr-1",density:"compact",mandatory:"",modelValue:e.source,"onUpdate:modelValue":t[0]||(t[0]=o=>e.source=o),variant:"outlined"},{default:s(()=>[(p(),w(C,null,A(U,(o,r)=>l(n,R({key:r,style:{"min-width":"40px"},ref_for:!0},o),null,16)),64))]),_:1},8,["modelValue"]),e.source==="github"?(p(),w(C,{key:0},[l(M,{"onUpdate:modelValue":[Z,t[1]||(t[1]=o=>e.githubGroup=o)],class:"mx-1",density:"compact",mandatory:"",modelValue:e.githubGroup,variant:"outlined"},{default:s(()=>[(p(),w(C,null,A(D,(o,r)=>l(n,R({key:r,style:{"min-width":"40px"},ref_for:!0},o),null,16)),64))]),_:1},8,["modelValue"]),l(L,{disabled:e.githubTrees.length===0,items:e.githubTrees,label:e.githubGroup+" path","onUpdate:modelValue":[Y,t[2]||(t[2]=o=>e.githubSelectedTree=o)],class:"mx-1",density:"compact",flat:"","hide-details":"","item-title":"path","prepend-icon":"mdi:mdi-github","return-object":"",modelValue:e.githubSelectedTree,variant:"outlined"},null,8,["disabled","items","label","modelValue"]),l(L,{disabled:e.githubFiles.length===0,items:e.githubFiles,"onUpdate:modelValue":[oe,t[3]||(t[3]=o=>e.githubSelectedFile=o)],class:"mx-1",density:"compact",flat:"","hide-details":"","item-title":"path",label:"File","return-object":"",modelValue:e.githubSelectedFile,variant:"outlined"},null,8,["disabled","items","modelValue"]),l(n,{onClick:t[4]||(t[4]=o=>G()),flat:"","prepend-icon":"mdi:mdi-download",variant:"outlined"},{default:s(()=>[V(" Fetch ")]),_:1})],64)):e.source==="drive"?(p(),T(re,{key:1,"onUpdate:modelValue":z,density:"compact",flat:"","hide-details":"",label:"File","show-size":"",title:"Click to select a file","truncate-length":"100",variant:"outlined"},{append:s(()=>[l(n,{onUpload:z,flat:"","prepend-icon":"mdi:mdi-upload",variant:"outlined"},{default:s(()=>[V(" Upload ")]),_:1})]),_:1})):e.source==="url"?(p(),T(de,{key:2,class:"ma-0 pa-0",clearable:"",density:"compact",flat:"","full-width":"","hide-details":"",label:"URL","prepend-icon":"mdi:mdi-web",title:"Please enter the project's URL",modelValue:e.url,"onUpdate:modelValue":t[6]||(t[6]=o=>e.url=o),variant:"outlined"},{append:s(()=>[l(n,{onClick:t[5]||(t[5]=o=>G()),flat:"","prepend-icon":"mdi:mdi-download",variant:"outlined"},{default:s(()=>[V(" Fetch ")]),_:1})]),_:1},8,["modelValue"])):(p(),w(C,{key:3},[l(x,{icon:"mdi:mdi-arrow-left-thin"}),V(" Please select one source of files to import. ")],64))]),_:1}),l(Q,{"group-by":[{key:"group",order:"asc"}],headers:F,items:e.items,"show-expand":!1,"item-selectable":"valid","item-value":"name","return-object":"","show-select":"",modelValue:e.selected,"onUpdate:modelValue":t[7]||(t[7]=o=>e.selected=o)},{"item.valid":s(({value:o})=>[l(x,{color:o?"success":"error",icon:o?"mdi-check":"mdi-close"},null,8,["color","icon"])]),_:1},8,["items","modelValue"]),l(W,null,{default:s(()=>[l(n,{disabled:e.selected.length===0,onClick:()=>{ee(),a.value=!1},"prepend-icon":"mdi:mdi-import",size:"small",text:"import selected",variant:"outlined"},null,8,["disabled","onClick"]),l(n,{onClick:t[8]||(t[8]=o=>e.items=[]),"prepend-icon":"mdi:mdi-delete-empty-outline",size:"small",text:"Clear",variant:"outlined"}),l(n,{onClick:o=>a.value=!1,size:"small",text:"close",variant:"outlined"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1}))}});export{me as _,ce as a};
