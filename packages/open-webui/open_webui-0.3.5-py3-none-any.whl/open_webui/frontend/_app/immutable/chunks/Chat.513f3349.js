import{s as Xe,E as ft,F as dt,G as ht,H as mt,w as ue,e as Fe,i as O,d as h,I as Yt,x as Et,y as Tn,p as ke,f as E,g as I,h as k,L as ut,Y as Ot,u as $,v as gt,T as el,C as we,V as Gt,o as tl,l as ge,a as J,m as _e,c as Q,j as f,r as v,n as Se,R as Ye,P as _t,K as Dt,t as Me,z as ve,A as be,W as He,k as ct,S as At,Q as _l,O as Un,M as Pn}from"./scheduler.8ceb707f.js";import{S as Ke,i as xe,a as H,t as z,g as Ue,c as Pe,h as Cn,j as Vn,k as Xt,f as Oe,b as oe,d as ie,m as ae,e as ce}from"./index.07e72a31.js";import{g as zn}from"./globals.7f7f1b26.js";import{e as nt}from"./each.0e379b97.js";import{a as Ee}from"./Toaster.svelte_svelte_type_style_lang.a1b53f72.js";import{M as Rn,m as jn}from"./Messages.108589e0.js";import"./dayjs.min.5e6a5a69.js";import{g as sl}from"./navigation.f0e36ffc.js";import{p as Fn}from"./stores.55ee61e6.js";import{p as qn,q as Wn,h as ll,c as Jt,g as kt,k as Kt,r as Zn,u as al,m as Bn,a as xt,S as pl,x as vl,y as $t,W as Nn,j as Lt,l as Gn,s as Jn,v as Qn,i as Wt,O as Yn}from"./index.92b94e22.js";import{h as Ln,r as rl,i as bl,j as cl,v as wl,p as kl,s as Xn,k as Qt,a as yl,l as Kn}from"./index.d8705ee6.js";import{i as xn}from"./index.b6d16026.js";import{e as $n,p as El,c as es,b as Zt,z as Il,k as ol,m as ts,A as ls}from"./index.93cbbd84.js";import{f as ns}from"./index.db5cf18a.js";import{i as ss,j as rs,k as os,l as is}from"./index.7a64202d.js";import{T as as,S as cs,U as us,q as fs}from"./ShareChatModal.ed54b075.js";import{r as ds,s as hs,t as ms,v as gs}from"./index.d49b3807.js";import{f as Sl}from"./index.87fe8e34.js";import{A as _s}from"./AddFilesPlaceholder.685275a7.js";import"./sha256.65a6c54a.js";import{T as It}from"./Tooltip.fbf062c2.js";import{f as An,h as ps}from"./updater.e153cbf1.js";import{D as ul,M as Ht}from"./Dropdown.226b3ff4.js";import{s as vs,g as bs,u as ws,a as ks,M as fl}from"./menu-trigger.0f0338f1.js";import{f as nl}from"./index.e8e699b3.js";import{S as Hn}from"./Switch.55ed00d7.js";import{t as dl,s as ys}from"./index.aa9c631e.js";import{S as Es}from"./Selector.d4fd6ef9.js";import{d as Is}from"./index.e51049e7.js";import{g as Ut}from"./spread.8a54911c.js";import{f as Ss}from"./FileSaver.min.898eb36f.js";import{b as Ds}from"./index.9edd7fa9.js";import"./singletons.7207e731.js";import{M as Ms}from"./MenuLines.01456c47.js";import"./index.c4ca6160.js";const Ts=n=>({subIds:n&1}),Dl=n=>({subIds:n[0]});function Cs(n){let e;const t=n[6].default,l=ft(t,n,n[5],Dl);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,[o]){l&&l.p&&(!e||o&33)&&dt(l,t,s,s[5],e?mt(t,s[5],o,Ts):ht(s[5]),Dl)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Vs(n,e,t){let l,{$$slots:s={},$$scope:o}=e,{disabled:r=void 0}=e,{open:i=void 0}=e,{onOpenChange:a=void 0}=e;const{updateOption:u,ids:c,states:{subOpen:d}}=vs({disabled:r,onOpenChange:({next:b})=>(i!==b&&(a==null||a(b),t(2,i=b)),b)}),m=Is([c.menu,c.trigger],([b,S])=>({menu:b,trigger:S}));return ue(n,m,b=>t(0,l=b)),n.$$set=b=>{"disabled"in b&&t(3,r=b.disabled),"open"in b&&t(2,i=b.open),"onOpenChange"in b&&t(4,a=b.onOpenChange),"$$scope"in b&&t(5,o=b.$$scope)},n.$$.update=()=>{n.$$.dirty&4&&i!==void 0&&d.set(i),n.$$.dirty&8&&u("disabled",r)},[l,m,i,r,a,o,s]}class Bs extends Ke{constructor(e){super(),xe(this,e,Vs,Cs,Xe,{disabled:3,open:2,onOpenChange:4})}}const Ns=n=>({builder:n[0]&256}),Ml=n=>({builder:n[8]}),Ls=n=>({builder:n[0]&256}),Tl=n=>({builder:n[8]}),As=n=>({builder:n[0]&256}),Cl=n=>({builder:n[8]}),Hs=n=>({builder:n[0]&256}),Vl=n=>({builder:n[8]}),Os=n=>({builder:n[0]&256}),Bl=n=>({builder:n[8]}),Us=n=>({builder:n[0]&256}),Nl=n=>({builder:n[8]});function Ps(n){let e,t,l,s;const o=n[28].default,r=ft(o,n,n[27],Ml);let i=[n[8],n[13]],a={};for(let u=0;u<i.length;u+=1)a=Et(a,i[u]);return{c(){e=E("div"),r&&r.c(),this.h()},l(u){e=I(u,"DIV",{});var c=k(e);r&&r.l(c),c.forEach(h),this.h()},h(){ut(e,a)},m(u,c){O(u,e,c),r&&r.m(e,null),n[33](e),t=!0,l||(s=[Ot(n[8].action(e)),$(e,"m-focusout",n[12]),$(e,"m-keydown",n[12]),$(e,"m-pointermove",n[12])],l=!0)},p(u,c){r&&r.p&&(!t||c[0]&134217984)&&dt(r,o,u,u[27],t?mt(o,u[27],c,Ns):ht(u[27]),Ml),ut(e,a=Ut(i,[c[0]&256&&u[8],c[0]&8192&&u[13]]))},i(u){t||(H(r,u),t=!0)},o(u){z(r,u),t=!1},d(u){u&&h(e),r&&r.d(u),n[33](null),l=!1,gt(s)}}}function zs(n){let e,t,l,s,o;const r=n[28].default,i=ft(r,n,n[27],Tl);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=Et(u,a[c]);return{c(){e=E("div"),i&&i.c(),this.h()},l(c){e=I(c,"DIV",{});var d=k(e);i&&i.l(d),d.forEach(h),this.h()},h(){ut(e,u)},m(c,d){O(c,e,d),i&&i.m(e,null),n[32](e),l=!0,s||(o=[Ot(n[8].action(e)),$(e,"m-focusout",n[12]),$(e,"m-keydown",n[12]),$(e,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&dt(i,r,n,n[27],l?mt(r,n[27],d,Ls):ht(n[27]),Tl),ut(e,u=Ut(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(H(i,c),t&&t.end(1),l=!0)},o(c){z(i,c),c&&(t=Cn(e,n[5],n[6])),l=!1},d(c){c&&h(e),i&&i.d(c),n[32](null),c&&t&&t.end(),s=!1,gt(o)}}}function Rs(n){let e,t,l,s,o;const r=n[28].default,i=ft(r,n,n[27],Cl);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=Et(u,a[c]);return{c(){e=E("div"),i&&i.c(),this.h()},l(c){e=I(c,"DIV",{});var d=k(e);i&&i.l(d),d.forEach(h),this.h()},h(){ut(e,u)},m(c,d){O(c,e,d),i&&i.m(e,null),n[31](e),l=!0,s||(o=[Ot(n[8].action(e)),$(e,"m-focusout",n[12]),$(e,"m-keydown",n[12]),$(e,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&dt(i,r,n,n[27],l?mt(r,n[27],d,As):ht(n[27]),Cl),ut(e,u=Ut(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(H(i,c),c&&(t||el(()=>{t=Vn(e,n[3],n[4]),t.start()})),l=!0)},o(c){z(i,c),l=!1},d(c){c&&h(e),i&&i.d(c),n[31](null),s=!1,gt(o)}}}function js(n){let e,t,l,s,o,r;const i=n[28].default,a=ft(i,n,n[27],Vl);let u=[n[8],n[13]],c={};for(let d=0;d<u.length;d+=1)c=Et(c,u[d]);return{c(){e=E("div"),a&&a.c(),this.h()},l(d){e=I(d,"DIV",{});var m=k(e);a&&a.l(m),m.forEach(h),this.h()},h(){ut(e,c)},m(d,m){O(d,e,m),a&&a.m(e,null),n[30](e),s=!0,o||(r=[Ot(n[8].action(e)),$(e,"m-focusout",n[12]),$(e,"m-keydown",n[12]),$(e,"m-pointermove",n[12])],o=!0)},p(d,m){n=d,a&&a.p&&(!s||m[0]&134217984)&&dt(a,i,n,n[27],s?mt(i,n[27],m,Hs):ht(n[27]),Vl),ut(e,c=Ut(u,[m[0]&256&&n[8],m[0]&8192&&n[13]]))},i(d){s||(H(a,d),d&&el(()=>{s&&(l&&l.end(1),t=Vn(e,n[3],n[4]),t.start())}),s=!0)},o(d){z(a,d),t&&t.invalidate(),d&&(l=Cn(e,n[5],n[6])),s=!1},d(d){d&&h(e),a&&a.d(d),n[30](null),d&&l&&l.end(),o=!1,gt(r)}}}function Fs(n){let e,t,l,s,o;const r=n[28].default,i=ft(r,n,n[27],Bl);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=Et(u,a[c]);return{c(){e=E("div"),i&&i.c(),this.h()},l(c){e=I(c,"DIV",{});var d=k(e);i&&i.l(d),d.forEach(h),this.h()},h(){ut(e,u)},m(c,d){O(c,e,d),i&&i.m(e,null),n[29](e),l=!0,s||(o=[Ot(n[8].action(e)),$(e,"m-focusout",n[12]),$(e,"m-keydown",n[12]),$(e,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&dt(i,r,n,n[27],l?mt(r,n[27],d,Os):ht(n[27]),Bl),ut(e,u=Ut(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(H(i,c),c&&el(()=>{l&&(t||(t=Xt(e,n[1],n[2],!0)),t.run(1))}),l=!0)},o(c){z(i,c),c&&(t||(t=Xt(e,n[1],n[2],!1)),t.run(0)),l=!1},d(c){c&&h(e),i&&i.d(c),n[29](null),c&&t&&t.end(),s=!1,gt(o)}}}function qs(n){let e;const t=n[28].default,l=ft(t,n,n[27],Nl);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o[0]&134217984)&&dt(l,t,s,s[27],e?mt(t,s[27],o,Us):ht(s[27]),Nl)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Ws(n){let e,t,l,s;const o=[qs,Fs,js,Rs,zs,Ps],r=[];function i(a,u){return a[7]&&a[9]?0:a[1]&&a[9]?1:a[3]&&a[5]&&a[9]?2:a[3]&&a[9]?3:a[5]&&a[9]?4:a[9]?5:-1}return~(e=i(n))&&(t=r[e]=o[e](n)),{c(){t&&t.c(),l=Fe()},l(a){t&&t.l(a),l=Fe()},m(a,u){~e&&r[e].m(a,u),O(a,l,u),s=!0},p(a,u){let c=e;e=i(a),e===c?~e&&r[e].p(a,u):(t&&(Ue(),z(r[c],1,1,()=>{r[c]=null}),Pe()),~e?(t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),H(t,1),t.m(l.parentNode,l)):t=null)},i(a){s||(H(t),s=!0)},o(a){z(t),s=!1},d(a){a&&h(l),~e&&r[e].d(a)}}}function Zs(n,e,t){let l;const s=["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el"];let o=Yt(e,s),r,i,{$$slots:a={},$$scope:u}=e,{transition:c=void 0}=e,{transitionConfig:d=void 0}=e,{inTransition:m=void 0}=e,{inTransitionConfig:b=void 0}=e,{outTransition:S=void 0}=e,{outTransitionConfig:g=void 0}=e,{asChild:_=!1}=e,{id:p=void 0}=e,{side:w="right"}=e,{align:C="start"}=e,{sideOffset:D=0}=e,{alignOffset:N=0}=e,{collisionPadding:T=8}=e,{avoidCollisions:A=!0}=e,{collisionBoundary:V=void 0}=e,{sameWidth:W=!1}=e,{fitViewport:j=!1}=e,{strategy:U="absolute"}=e,{overlap:F=!1}=e,{el:re=void 0}=e;const{elements:{subMenu:le},states:{subOpen:R},ids:M,getAttrs:B}=bs();ue(n,le,Z=>t(26,r=Z)),ue(n,R,Z=>t(9,i=Z));const ee=An(),ne=B("sub-content");function fe(Z){ke[Z?"unshift":"push"](()=>{re=Z,t(0,re)})}function Be(Z){ke[Z?"unshift":"push"](()=>{re=Z,t(0,re)})}function Ge(Z){ke[Z?"unshift":"push"](()=>{re=Z,t(0,re)})}function $e(Z){ke[Z?"unshift":"push"](()=>{re=Z,t(0,re)})}function Ie(Z){ke[Z?"unshift":"push"](()=>{re=Z,t(0,re)})}return n.$$set=Z=>{e=Et(Et({},e),Tn(Z)),t(13,o=Yt(e,s)),"transition"in Z&&t(1,c=Z.transition),"transitionConfig"in Z&&t(2,d=Z.transitionConfig),"inTransition"in Z&&t(3,m=Z.inTransition),"inTransitionConfig"in Z&&t(4,b=Z.inTransitionConfig),"outTransition"in Z&&t(5,S=Z.outTransition),"outTransitionConfig"in Z&&t(6,g=Z.outTransitionConfig),"asChild"in Z&&t(7,_=Z.asChild),"id"in Z&&t(14,p=Z.id),"side"in Z&&t(15,w=Z.side),"align"in Z&&t(16,C=Z.align),"sideOffset"in Z&&t(17,D=Z.sideOffset),"alignOffset"in Z&&t(18,N=Z.alignOffset),"collisionPadding"in Z&&t(19,T=Z.collisionPadding),"avoidCollisions"in Z&&t(20,A=Z.avoidCollisions),"collisionBoundary"in Z&&t(21,V=Z.collisionBoundary),"sameWidth"in Z&&t(22,W=Z.sameWidth),"fitViewport"in Z&&t(23,j=Z.fitViewport),"strategy"in Z&&t(24,U=Z.strategy),"overlap"in Z&&t(25,F=Z.overlap),"el"in Z&&t(0,re=Z.el),"$$scope"in Z&&t(27,u=Z.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&p&&M.menu.set(p),n.$$.dirty[0]&67108864&&t(8,l=r),n.$$.dirty[0]&256&&Object.assign(l,ne),n.$$.dirty[0]&67076096&&ws({side:w,align:C,sideOffset:D,alignOffset:N,collisionPadding:T,avoidCollisions:A,collisionBoundary:V,sameWidth:W,fitViewport:j,strategy:U,overlap:F})},[re,c,d,m,b,S,g,_,l,i,le,R,ee,o,p,w,C,D,N,T,A,V,W,j,U,F,r,u,a,fe,Be,Ge,$e,Ie]}class Gs extends Ke{constructor(e){super(),xe(this,e,Zs,Ws,Xe,{transition:1,transitionConfig:2,inTransition:3,inTransitionConfig:4,outTransition:5,outTransitionConfig:6,asChild:7,id:14,side:15,align:16,sideOffset:17,alignOffset:18,collisionPadding:19,avoidCollisions:20,collisionBoundary:21,sameWidth:22,fitViewport:23,strategy:24,overlap:25,el:0},null,[-1,-1])}}const Js=n=>({builder:n&4}),Ll=n=>({builder:n[2]}),Qs=n=>({builder:n&4}),Al=n=>({builder:n[2]});function Ys(n){let e,t,l,s;const o=n[13].default,r=ft(o,n,n[12],Ll);let i=[n[2],n[6]],a={};for(let u=0;u<i.length;u+=1)a=Et(a,i[u]);return{c(){e=E("div"),r&&r.c(),this.h()},l(u){e=I(u,"DIV",{});var c=k(e);r&&r.l(c),c.forEach(h),this.h()},h(){ut(e,a)},m(u,c){O(u,e,c),r&&r.m(e,null),n[14](e),t=!0,l||(s=[Ot(n[2].action(e)),$(e,"m-click",n[5]),$(e,"m-focusin",n[5]),$(e,"m-focusout",n[5]),$(e,"m-keydown",n[5]),$(e,"m-pointerleave",n[5]),$(e,"m-pointermove",n[5])],l=!0)},p(u,c){r&&r.p&&(!t||c&4100)&&dt(r,o,u,u[12],t?mt(o,u[12],c,Js):ht(u[12]),Ll),ut(e,a=Ut(i,[c&4&&u[2],c&64&&u[6]]))},i(u){t||(H(r,u),t=!0)},o(u){z(r,u),t=!1},d(u){u&&h(e),r&&r.d(u),n[14](null),l=!1,gt(s)}}}function Xs(n){let e;const t=n[13].default,l=ft(t,n,n[12],Al);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&4100)&&dt(l,t,s,s[12],e?mt(t,s[12],o,Qs):ht(s[12]),Al)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Ks(n){let e,t,l,s;const o=[Xs,Ys],r=[];function i(a,u){return a[1]?0:1}return e=i(n),t=r[e]=o[e](n),{c(){t.c(),l=Fe()},l(a){t.l(a),l=Fe()},m(a,u){r[e].m(a,u),O(a,l,u),s=!0},p(a,[u]){let c=e;e=i(a),e===c?r[e].p(a,u):(Ue(),z(r[c],1,1,()=>{r[c]=null}),Pe(),t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),H(t,1),t.m(l.parentNode,l))},i(a){s||(H(t),s=!0)},o(a){z(t),s=!1},d(a){a&&h(l),r[e].d(a)}}}function xs(n,e,t){let l,s;const o=["disabled","asChild","id","el"];let r=Yt(e,o),i,a,{$$slots:u={},$$scope:c}=e,{disabled:d=!1}=e,{asChild:m=!1}=e,{id:b=void 0}=e,{el:S=void 0}=e;const{elements:{subTrigger:g},ids:_,getAttrs:p,options:w}=ks();ue(n,g,T=>t(11,a=T));const{disabled:C}=w;ue(n,C,T=>t(10,i=T));const D=An();function N(T){ke[T?"unshift":"push"](()=>{S=T,t(0,S)})}return n.$$set=T=>{e=Et(Et({},e),Tn(T)),t(6,r=Yt(e,o)),"disabled"in T&&t(7,d=T.disabled),"asChild"in T&&t(1,m=T.asChild),"id"in T&&t(8,b=T.id),"el"in T&&t(0,S=T.el),"$$scope"in T&&t(12,c=T.$$scope)},n.$$.update=()=>{n.$$.dirty&256&&b&&_.trigger.set(b),n.$$.dirty&2048&&t(2,l=a),n.$$.dirty&1152&&t(9,s={...p("sub-trigger"),...ps(d||i)}),n.$$.dirty&516&&Object.assign(l,s)},[S,m,l,g,C,D,r,d,b,s,i,a,c,u,N]}class $s extends Ke{constructor(e){super(),xe(this,e,xs,Ks,Xe,{disabled:7,asChild:1,id:8,el:0})}}function er(n){let e,t,l,s,o,r,i;return a(),{feed:u,reset:a};function a(){e=!0,t="",l=0,s=-1,o=void 0,r=void 0,i=""}function u(d){t=t?t+d:d,e&&tr(t)&&(t=t.slice(On.length)),e=!1;const m=t.length;let b=0,S=!1;for(;b<m;){S&&(t[b]===`
`&&++b,S=!1);let g=-1,_=s,p;for(let w=l;g<0&&w<m;++w)p=t[w],p===":"&&_<0?_=w-b:p==="\r"?(S=!0,g=w-b):p===`
`&&(g=w-b);if(g<0){l=m-b,s=_;break}else l=0,s=-1;c(t,b,_,g),b+=g+1}b===m?t="":b>0&&(t=t.slice(b))}function c(d,m,b,S){if(S===0){i.length>0&&(n({type:"event",id:o,event:r||void 0,data:i.slice(0,-1)}),i="",o=void 0),r=void 0;return}const g=b<0,_=d.slice(m,m+(g?S:b));let p=0;g?p=S:d[m+b+1]===" "?p=b+2:p=b+1;const w=m+p,C=S-p,D=d.slice(w,w+C).toString();if(_==="data")i+=D?"".concat(D,`
`):`
`;else if(_==="event")r=D;else if(_==="id"&&!D.includes("\0"))o=D;else if(_==="retry"){const N=parseInt(D,10);Number.isNaN(N)||n({type:"reconnect-interval",value:N})}}}const On=[239,187,191];function tr(n){return On.every((e,t)=>n.charCodeAt(t)===e)}class lr extends TransformStream{constructor(){let e;super({start(t){e=er(l=>{l.type==="event"&&t.enqueue(l)})},transform(t){e.feed(t)}})}}async function nr(n,e){const t=n.pipeThrough(new TextDecoderStream).pipeThrough(new lr).getReader();let l=sr(t);return e&&(l=rr(l)),l}async function*sr(n){var e,t,l;for(;;){const{value:s,done:o}=await n.read();if(o){yield{done:!0,value:""};break}if(!s)continue;const r=s.data;if(r.startsWith("[DONE]")){yield{done:!0,value:""};break}try{const i=JSON.parse(r);if(console.log(i),i.error){yield{done:!0,value:"",error:i.error};break}if(i.citations){yield{done:!1,value:"",citations:i.citations};continue}yield{done:!1,value:((l=(t=(e=i.choices)==null?void 0:e[0])==null?void 0:t.delta)==null?void 0:l.content)??"",usage:i.usage}}catch(i){console.error("Error extracting delta from SSE event:",i)}}}async function*rr(n){for await(const e of n){if(e.done){yield e;return}if(e.citations){yield e;continue}let t=e.value;if(t.length<5){yield{done:!1,value:t};continue}for(;t!="";){const l=Math.min(Math.floor(Math.random()*3)+1,t.length);yield{done:!1,value:t.slice(0,l)},(document==null?void 0:document.visibilityState)!=="hidden"&&await or(5),t=t.slice(l)}}}const or=n=>new Promise(e=>setTimeout(e,n));function Hl(n){let e,t=n[2]&&Ol(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,s){l[2]?t?(t.p(l,s),s&4&&H(t,1)):(t=Ol(l),t.c(),H(t,1),t.m(e.parentNode,e)):t&&(Ue(),z(t,1,1,()=>{t=null}),Pe())},d(l){l&&h(e),t&&t.d(l)}}}function Ol(n){let e,t,l,s,o=n[1].type+"",r,i,a,u,c,d=n[1].content+"",m,b,S,g,_,p,w=n[1].url&&Ul(),C=n[1].url&&Pl(),D=n[1].dismissible&&zl(n);return{c(){e=E("div"),t=E("div"),l=E("div"),s=E("div"),r=ge(o),a=J(),w&&w.c(),u=J(),c=E("div"),m=ge(d),b=J(),C&&C.c(),S=J(),g=E("div"),D&&D.c(),this.h()},l(N){e=I(N,"DIV",{class:!0});var T=k(e);t=I(T,"DIV",{class:!0});var A=k(t);l=I(A,"DIV",{class:!0});var V=k(l);s=I(V,"DIV",{class:!0});var W=k(s);r=_e(W,o),W.forEach(h),a=Q(V),w&&w.l(V),V.forEach(h),u=Q(A),c=I(A,"DIV",{class:!0});var j=k(c);m=_e(j,d),j.forEach(h),A.forEach(h),b=Q(T),C&&C.l(T),S=Q(T),g=I(T,"DIV",{class:!0});var U=k(g);D&&D.l(U),U.forEach(h),T.forEach(h),this.h()},h(){f(s,"class",i="text-xs font-black "+(n[3][n[1].type]??n[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"),f(l,"class","flex justify-between self-start"),f(c,"class","flex-1 text-xs text-gray-700 dark:text-white"),f(t,"class","flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5"),f(g,"class","flex self-start"),f(e,"class","top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30")},m(N,T){O(N,e,T),v(e,t),v(t,l),v(l,s),v(s,r),v(l,a),w&&w.m(l,null),v(t,u),v(t,c),v(c,m),v(e,b),C&&C.m(e,null),v(e,S),v(e,g),D&&D.m(g,null),p=!0},p(N,T){(!p||T&2)&&o!==(o=N[1].type+"")&&Se(r,o),(!p||T&2&&i!==(i="text-xs font-black "+(N[3][N[1].type]??N[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"))&&f(s,"class",i),N[1].url?w||(w=Ul(),w.c(),w.m(l,null)):w&&(w.d(1),w=null),(!p||T&2)&&d!==(d=N[1].content+"")&&Se(m,d),N[1].url?C||(C=Pl(),C.c(),C.m(e,S)):C&&(C.d(1),C=null),N[1].dismissible?D?D.p(N,T):(D=zl(N),D.c(),D.m(g,null)):D&&(D.d(1),D=null)},i(N){p||(N&&el(()=>{p&&(_||(_=Xt(e,Sl,{delay:100,duration:300},!0)),_.run(1))}),p=!0)},o(N){N&&(_||(_=Xt(e,Sl,{delay:100,duration:300},!1)),_.run(0)),p=!1},d(N){N&&h(e),w&&w.d(),C&&C.d(),D&&D.d(),N&&_&&_.end()}}}function Ul(n){let e,t='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/assets/files/whitepaper.pdf" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){e=E("div"),e.innerHTML=t,this.h()},l(l){e=I(l,"DIV",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-1ofrdjc"&&(e.innerHTML=t),this.h()},h(){f(e,"class","flex md:hidden group w-fit md:items-center")},m(l,s){O(l,e,s)},d(l){l&&h(e)}}}function Pl(n){let e,t='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){e=E("div"),e.innerHTML=t,this.h()},l(l){e=I(l,"DIV",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-15ujvd1"&&(e.innerHTML=t),this.h()},h(){f(e,"class","hidden md:flex group w-fit md:items-center")},m(l,s){O(l,e,s)},d(l){l&&h(e)}}}function zl(n){let e,t="×",l,s;return{c(){e=E("button"),e.textContent=t,this.h()},l(o){e=I(o,"BUTTON",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-17pf3tf"&&(e.textContent=t),this.h()},h(){f(e,"class","-mt-[3px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white h-1")},m(o,r){O(o,e,r),l||(s=$(e,"click",n[5]),l=!0)},p:we,d(o){o&&h(e),l=!1,s()}}}function ir(n){let e,t=!n[0]&&Hl(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,[s]){l[0]?t&&(t.d(1),t=null):t?t.p(l,s):(t=Hl(l),t.c(),t.m(e.parentNode,e))},i:we,o:we,d(l){l&&h(e),t&&t.d(l)}}}function ar(n,e,t){const l=Gt();let{banner:s={id:"",type:"info",title:"",content:"",url:"",dismissable:!0,timestamp:Math.floor(Date.now()/1e3)}}=e,{dismissed:o=!1}=e,r=!1;const i={info:"bg-blue-500/20 text-blue-700 dark:text-blue-200 ",success:"bg-green-500/20 text-green-700 dark:text-green-200",warning:"bg-yellow-500/20 text-yellow-700 dark:text-yellow-200",error:"bg-red-500/20 text-red-700 dark:text-red-200"},a=c=>{t(0,o=!0),l("dismiss",c)};tl(()=>{t(2,r=!0)});const u=()=>{a(s.id)};return n.$$set=c=>{"banner"in c&&t(1,s=c.banner),"dismissed"in c&&t(0,o=c.dismissed)},[o,s,r,i,a,u]}class cr extends Ke{constructor(e){super(),xe(this,e,ar,ir,Xe,{banner:1,dismissed:0})}}function Rl(n,e,t){const l=n.slice();return l[12]=e[t],l[14]=t,l}function jl(n){let e,t,l,s='<div class="text-lg font-semibold mt-2">/</div>',o,r,i,a,u,c,d='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',m,b,S=n[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",g,_=nt(n[1]),p=[];for(let w=0;w<_.length;w+=1)p[w]=Fl(Rl(n,_,w));return{c(){e=E("div"),t=E("div"),l=E("div"),l.innerHTML=s,o=J(),r=E("div"),i=E("div");for(let w=0;w<p.length;w+=1)p[w].c();a=J(),u=E("div"),c=E("div"),c.innerHTML=d,m=J(),b=E("div"),g=ge(S),this.h()},l(w){e=I(w,"DIV",{class:!0});var C=k(e);t=I(C,"DIV",{class:!0});var D=k(t);l=I(D,"DIV",{class:!0,"data-svelte-h":!0}),Ye(l)!=="svelte-17yak1f"&&(l.innerHTML=s),o=Q(D),r=I(D,"DIV",{class:!0});var N=k(r);i=I(N,"DIV",{class:!0});var T=k(i);for(let W=0;W<p.length;W+=1)p[W].l(T);T.forEach(h),a=Q(N),u=I(N,"DIV",{class:!0});var A=k(u);c=I(A,"DIV",{"data-svelte-h":!0}),Ye(c)!=="svelte-cdi12d"&&(c.innerHTML=d),m=Q(A),b=I(A,"DIV",{class:!0});var V=k(b);g=_e(V,S),V.forEach(h),A.forEach(h),N.forEach(h),D.forEach(h),C.forEach(h),this.h()},h(){f(l,"class","bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden"),f(b,"class","line-clamp-1"),f(u,"class","px-2 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-br-xl flex items-center space-x-1"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100"),f(t,"class","flex w-full dark:border dark:border-gray-850 rounded-lg"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(w,C){O(w,e,C),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i);for(let D=0;D<p.length;D+=1)p[D]&&p[D].m(i,null);v(r,a),v(r,u),v(u,c),v(u,m),v(u,b),v(b,g)},p(w,C){if(C&19){_=nt(w[1]);let D;for(D=0;D<_.length;D+=1){const N=Rl(w,_,D);p[D]?p[D].p(N,C):(p[D]=Fl(N),p[D].c(),p[D].m(i,null))}for(;D<p.length;D+=1)p[D].d(1);p.length=_.length}C&4&&S!==(S=w[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&Se(g,S)},d(w){w&&h(e),Dt(p,w)}}}function Fl(n){let e,t,l=n[12].command+"",s,o,r,i=n[12].title+"",a,u,c,d,m;function b(){return n[10](n[12])}function S(){return n[11](n[14])}return{c(){e=E("button"),t=E("div"),s=ge(l),o=J(),r=E("div"),a=ge(i),u=J(),this.h()},l(g){e=I(g,"BUTTON",{class:!0,type:!0});var _=k(e);t=I(_,"DIV",{class:!0});var p=k(t);s=_e(p,l),p.forEach(h),o=Q(_),r=I(_,"DIV",{class:!0});var w=k(r);a=_e(w,i),w.forEach(h),u=Q(_),_.forEach(h),this.h()},h(){f(t,"class","font-medium text-black dark:text-gray-100"),f(r,"class","text-xs text-gray-600 dark:text-gray-100"),f(e,"class",c="px-3 py-1.5 rounded-xl w-full text-left "+(n[14]===n[0]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),f(e,"type","button")},m(g,_){O(g,e,_),v(e,t),v(t,s),v(e,o),v(e,r),v(r,a),v(e,u),d||(m=[$(e,"click",b),$(e,"mousemove",S),$(e,"focus",fr)],d=!0)},p(g,_){n=g,_&2&&l!==(l=n[12].command+"")&&Se(s,l),_&2&&i!==(i=n[12].title+"")&&Se(a,i),_&1&&c!==(c="px-3 py-1.5 rounded-xl w-full text-left "+(n[14]===n[0]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&f(e,"class",c)},d(g){g&&h(e),d=!1,gt(m)}}}function ur(n){let e,t=n[1].length>0&&jl(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,[s]){l[1].length>0?t?t.p(l,s):(t=jl(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:we,o:we,d(l){l&&h(e),t&&t.d(l)}}}const fr=()=>{};function dr(n,e,t){let l,s;ue(n,qn,g=>t(9,s=g));const o=_t("i18n");ue(n,o,g=>t(2,l=g));let{files:r}=e,{prompt:i=""}=e,a=0,u=[];const c=()=>{t(0,a=Math.max(0,a-1))},d=()=>{t(0,a=Math.min(a+1,u.length-1))},m=async g=>{let _=g.content;if(g.content.includes("{{CLIPBOARD}}")){const C=await navigator.clipboard.readText().catch(T=>(Ee.error(l.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));console.log(C);const D=await navigator.clipboard.read();let N=null;for(const T of D)for(const A of T.types)if(A.startsWith("image/")){const V=await T.getType(A);N=URL.createObjectURL(V),console.log(`Image URL (${A}): ${N}`)}N&&t(6,r=[...r,{type:"image",url:N}]),_=g.content.replaceAll("{{CLIPBOARD}}",C)}t(5,i=_);const p=document.getElementById("chat-textarea");await Me(),p.style.height="",p.style.height=Math.min(p.scrollHeight,200)+"px",p==null||p.focus(),await Me();const w=Ln(i);if(w.length>0){const C=w.at(0);p.setSelectionRange(C==null?void 0:C.startIndex,C.endIndex+1)}},b=g=>{m(g)},S=g=>{t(0,a=g)};return n.$$set=g=>{"files"in g&&t(6,r=g.files),"prompt"in g&&t(5,i=g.prompt)},n.$$.update=()=>{n.$$.dirty&544&&t(1,u=s.filter(g=>g.command.includes(i)).sort((g,_)=>g.title.localeCompare(_.title))),n.$$.dirty&32&&i&&t(0,a=0)},[a,u,l,o,m,i,r,c,d,s,b,S]}class hr extends Ke{constructor(e){super(),xe(this,e,dr,ur,Xe,{files:6,prompt:5,selectUp:7,selectDown:8})}get selectUp(){return this.$$.ctx[7]}get selectDown(){return this.$$.ctx[8]}}function ql(n,e,t){const l=n.slice();return l[19]=e[t],l[21]=t,l}function Wl(n){let e,t,l,s='<div class="text-lg font-semibold mt-2">#</div>',o,r,i,a,u,c,d=nt(n[3]),m=[];for(let _=0;_<d.length;_+=1)m[_]=Zl(ql(n,d,_));function b(_,p){var w,C;if(p&1&&(u=null),p&1&&(c=null),u==null&&(u=!!_[0].split(" ").some(br)),u)return pr;if(c==null&&(c=!!((C=(w=_[0].split(" "))==null?void 0:w.at(0))!=null&&C.substring(1).startsWith("http"))),c)return _r}let S=b(n,-1),g=S&&S(n);return{c(){e=E("div"),t=E("div"),l=E("div"),l.innerHTML=s,o=J(),r=E("div"),i=E("div");for(let _=0;_<m.length;_+=1)m[_].c();a=J(),g&&g.c(),this.h()},l(_){e=I(_,"DIV",{class:!0});var p=k(e);t=I(p,"DIV",{class:!0});var w=k(t);l=I(w,"DIV",{class:!0,"data-svelte-h":!0}),Ye(l)!=="svelte-1bz58rh"&&(l.innerHTML=s),o=Q(w),r=I(w,"DIV",{class:!0});var C=k(r);i=I(C,"DIV",{class:!0});var D=k(i);for(let N=0;N<m.length;N+=1)m[N].l(D);a=Q(D),g&&g.l(D),D.forEach(h),C.forEach(h),w.forEach(h),p.forEach(h),this.h()},h(){f(l,"class","bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white dark:bg-gray-900 dark:text-gray-100"),f(t,"class","flex w-full dark:border dark:border-gray-850 rounded-lg"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(_,p){O(_,e,p),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(i,null);v(i,a),g&&g.m(i,null)},p(_,p){if(p&46){d=nt(_[3]);let w;for(w=0;w<d.length;w+=1){const C=ql(_,d,w);m[w]?m[w].p(C,p):(m[w]=Zl(C),m[w].c(),m[w].m(i,a))}for(;w<m.length;w+=1)m[w].d(1);m.length=d.length}S===(S=b(_,p))&&g?g.p(_,p):(g&&g.d(1),g=S&&S(_),g&&(g.c(),g.m(i,null)))},d(_){_&&h(e),Dt(m,_),g&&g.d()}}}function mr(n){let e,t,l=n[19].name+"",s,o,r=n[19].filename+"",i,a,u,c,d=n[19].title+"",m;return{c(){e=E("div"),t=ge("#"),s=ge(l),o=ge(" ("),i=ge(r),a=ge(")"),u=J(),c=E("div"),m=ge(d),this.h()},l(b){e=I(b,"DIV",{class:!0});var S=k(e);t=_e(S,"#"),s=_e(S,l),o=_e(S," ("),i=_e(S,r),a=_e(S,")"),S.forEach(h),u=Q(b),c=I(b,"DIV",{class:!0});var g=k(c);m=_e(g,d),g.forEach(h),this.h()},h(){f(e,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),f(c,"class","text-xs text-gray-600 dark:text-gray-100 line-clamp-1")},m(b,S){O(b,e,S),v(e,t),v(e,s),v(e,o),v(e,i),v(e,a),O(b,u,S),O(b,c,S),v(c,m)},p(b,S){S&8&&l!==(l=b[19].name+"")&&Se(s,l),S&8&&r!==(r=b[19].filename+"")&&Se(i,r),S&8&&d!==(d=b[19].title+"")&&Se(m,d)},d(b){b&&(h(e),h(u),h(c))}}}function gr(n){var a;let e,t=(((a=n[19])==null?void 0:a.title)??`#${n[19].name}`)+"",l,s,o,r=n[1].t("Collection")+"",i;return{c(){e=E("div"),l=ge(t),s=J(),o=E("div"),i=ge(r),this.h()},l(u){e=I(u,"DIV",{class:!0});var c=k(e);l=_e(c,t),c.forEach(h),s=Q(u),o=I(u,"DIV",{class:!0});var d=k(o);i=_e(d,r),d.forEach(h),this.h()},h(){f(e,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),f(o,"class","text-xs text-gray-600 dark:text-gray-100 line-clamp-1")},m(u,c){O(u,e,c),v(e,l),O(u,s,c),O(u,o,c),v(o,i)},p(u,c){var d;c&8&&t!==(t=(((d=u[19])==null?void 0:d.title)??`#${u[19].name}`)+"")&&Se(l,t),c&2&&r!==(r=u[1].t("Collection")+"")&&Se(i,r)},d(u){u&&(h(e),h(s),h(o))}}}function Zl(n){let e,t,l,s;function o(c,d){return c[19].type==="collection"?gr:mr}let r=o(n),i=r(n);function a(){return n[14](n[19])}function u(){return n[15](n[21])}return{c(){e=E("button"),i.c(),this.h()},l(c){e=I(c,"BUTTON",{class:!0,type:!0});var d=k(e);i.l(d),d.forEach(h),this.h()},h(){f(e,"class",t="px-3 py-1.5 rounded-xl w-full text-left "+(n[21]===n[2]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":"")),f(e,"type","button")},m(c,d){O(c,e,d),i.m(e,null),l||(s=[$(e,"click",a),$(e,"mousemove",u),$(e,"focus",wr)],l=!0)},p(c,d){n=c,r===(r=o(n))&&i?i.p(n,d):(i.d(1),i=r(n),i&&(i.c(),i.m(e,null))),d&4&&t!==(t="px-3 py-1.5 rounded-xl w-full text-left "+(n[21]===n[2]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":""))&&f(e,"class",t)},d(c){c&&h(e),i.d(),l=!1,gt(s)}}}function _r(n){var d,m;let e,t,l=((m=(d=n[0].split(" "))==null?void 0:d.at(0))==null?void 0:m.substring(1))+"",s,o,r,i=n[1].t("Web")+"",a,u,c;return{c(){e=E("button"),t=E("div"),s=ge(l),o=J(),r=E("div"),a=ge(i),this.h()},l(b){e=I(b,"BUTTON",{class:!0,type:!0});var S=k(e);t=I(S,"DIV",{class:!0});var g=k(t);s=_e(g,l),g.forEach(h),o=Q(S),r=I(S,"DIV",{class:!0});var _=k(r);a=_e(_,i),_.forEach(h),S.forEach(h),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(r,"class","text-xs text-gray-600 line-clamp-1"),f(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(e,"type","button")},m(b,S){O(b,e,S),v(e,t),v(t,s),v(e,o),v(e,r),v(r,a),u||(c=$(e,"click",n[17]),u=!0)},p(b,S){var g,_;S&1&&l!==(l=((_=(g=b[0].split(" "))==null?void 0:g.at(0))==null?void 0:_.substring(1))+"")&&Se(s,l),S&2&&i!==(i=b[1].t("Web")+"")&&Se(a,i)},d(b){b&&h(e),u=!1,c()}}}function pr(n){var d,m;let e,t,l=((m=(d=n[0].split(" "))==null?void 0:d.at(0))==null?void 0:m.substring(1))+"",s,o,r,i=n[1].t("Youtube")+"",a,u,c;return{c(){e=E("button"),t=E("div"),s=ge(l),o=J(),r=E("div"),a=ge(i),this.h()},l(b){e=I(b,"BUTTON",{class:!0,type:!0});var S=k(e);t=I(S,"DIV",{class:!0});var g=k(t);s=_e(g,l),g.forEach(h),o=Q(S),r=I(S,"DIV",{class:!0});var _=k(r);a=_e(_,i),_.forEach(h),S.forEach(h),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(r,"class","text-xs text-gray-600 line-clamp-1"),f(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(e,"type","button")},m(b,S){O(b,e,S),v(e,t),v(t,s),v(e,o),v(e,r),v(r,a),u||(c=$(e,"click",n[16]),u=!0)},p(b,S){var g,_;S&1&&l!==(l=((_=(g=b[0].split(" "))==null?void 0:g.at(0))==null?void 0:_.substring(1))+"")&&Se(s,l),S&2&&i!==(i=b[1].t("Youtube")+"")&&Se(a,i)},d(b){b&&h(e),u=!1,c()}}}function vr(n){var s,o;let e=n[3].length>0||((o=(s=n[0].split(" "))==null?void 0:s.at(0))==null?void 0:o.substring(1).startsWith("http")),t,l=e&&Wl(n);return{c(){l&&l.c(),t=Fe()},l(r){l&&l.l(r),t=Fe()},m(r,i){l&&l.m(r,i),O(r,t,i)},p(r,[i]){var a,u;i&9&&(e=r[3].length>0||((u=(a=r[0].split(" "))==null?void 0:a.at(0))==null?void 0:u.substring(1).startsWith("http"))),e?l?l.p(r,i):(l=Wl(r),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:we,o:we,d(r){r&&h(t),l&&l.d(r)}}}const br=n=>n.substring(1).startsWith("https://www.youtube.com")||n.substring(1).startsWith("https://youtu.be"),wr=()=>{};function kr(n,e,t){let l,s,o;ue(n,Wn,T=>t(13,s=T));const r=_t("i18n");ue(n,r,T=>t(1,o=T));let{prompt:i=""}=e;const a=Gt();let u=0,c=[],d=[],m=[];const b=()=>{t(2,u=Math.max(0,u-1))},S=()=>{t(2,u=Math.min(u+1,c.length-1))},g=async T=>{a("select",T),t(0,i=rl(i));const A=document.getElementById("chat-textarea");await Me(),A==null||A.focus(),await Me()},_=async T=>{a("url",T),t(0,i=rl(i));const A=document.getElementById("chat-textarea");await Me(),A==null||A.focus(),await Me()},p=async T=>{a("youtube",T),t(0,i=rl(i));const A=document.getElementById("chat-textarea");await Me(),A==null||A.focus(),await Me()},w=T=>{console.log(T),g(T)},C=T=>{t(2,u=T)},D=()=>{var A,V;const T=(V=(A=i.split(" "))==null?void 0:A.at(0))==null?void 0:V.substring(1);bl(T)?p(T):Ee.error(o.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},N=()=>{var A,V;const T=(V=(A=i.split(" "))==null?void 0:A.at(0))==null?void 0:V.substring(1);bl(T)?_(T):Ee.error(o.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return n.$$set=T=>{"prompt"in T&&t(0,i=T.prompt)},n.$$.update=()=>{n.$$.dirty&8194&&t(11,m=[...s.length>0?[{name:"All Documents",type:"collection",title:o.t("All Documents"),collection_names:s.map(T=>T.collection_name)}]:[],...s.reduce((T,A,V,W)=>{var j;return[...new Set([...T,...(((j=A==null?void 0:A.content)==null?void 0:j.tags)??[]).map(U=>U.name)])]},[]).map(T=>({name:T,type:"collection",collection_names:s.filter(A=>{var V;return(((V=A==null?void 0:A.content)==null?void 0:V.tags)??[]).map(W=>W.name).includes(T)}).map(A=>A.collection_name)}))]),n.$$.dirty&2049&&t(12,l=m.filter(T=>{var A,V;return T.name.includes(((V=(A=i.split(" "))==null?void 0:A.at(0))==null?void 0:V.substring(1))??"")}).sort((T,A)=>T.name.localeCompare(A.name))),n.$$.dirty&8193&&t(10,d=s.filter(T=>{var A,V;return T.name.includes(((V=(A=i.split(" "))==null?void 0:A.at(0))==null?void 0:V.substring(1))??"")}).sort((T,A)=>T.title.localeCompare(A.title))),n.$$.dirty&5120&&t(3,c=[...l,...d]),n.$$.dirty&4097&&i&&(t(2,u=0),console.log(l))},[i,o,u,c,r,g,_,p,b,S,d,m,l,s,w,C,D,N]}class yr extends Ke{constructor(e){super(),xe(this,e,kr,vr,Xe,{prompt:0,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function Gl(n,e,t){const l=n.slice();return l[16]=e[t],l[18]=t,l}function Jl(n){let e,t=n[2].length>0&&Ql(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,s){l[2].length>0?t?t.p(l,s):(t=Ql(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&h(e),t&&t.d(l)}}}function Ql(n){let e,t,l,s='<div class="text-lg font-semibold mt-2">@</div>',o,r,i,a=nt(n[2]),u=[];for(let c=0;c<a.length;c+=1)u[c]=Yl(Gl(n,a,c));return{c(){e=E("div"),t=E("div"),l=E("div"),l.innerHTML=s,o=J(),r=E("div"),i=E("div");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=I(c,"DIV",{class:!0});var d=k(e);t=I(d,"DIV",{class:!0});var m=k(t);l=I(m,"DIV",{class:!0,"data-svelte-h":!0}),Ye(l)!=="svelte-1wyzeqe"&&(l.innerHTML=s),o=Q(m),r=I(m,"DIV",{class:!0});var b=k(r);i=I(b,"DIV",{class:!0});var S=k(i);for(let g=0;g<u.length;g+=1)u[g].l(S);S.forEach(h),b.forEach(h),m.forEach(h),d.forEach(h),this.h()},h(){f(l,"class","bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100"),f(t,"class","flex w-full dark:border dark:border-gray-850 rounded-lg"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(c,d){O(c,e,d),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(i,null)},p(c,d){if(d&22){a=nt(c[2]);let m;for(m=0;m<a.length;m+=1){const b=Gl(c,a,m);u[m]?u[m].p(b,d):(u[m]=Yl(b),u[m].c(),u[m].m(i,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=a.length}},d(c){c&&h(e),Dt(u,c)}}}function Yl(n){let e,t,l=n[16].name+"",s,o,r,i,a;function u(){return n[11](n[16])}function c(){return n[12](n[18])}return{c(){e=E("button"),t=E("div"),s=ge(l),o=J(),this.h()},l(d){e=I(d,"BUTTON",{class:!0,type:!0});var m=k(e);t=I(m,"DIV",{class:!0});var b=k(t);s=_e(b,l),b.forEach(h),o=Q(m),m.forEach(h),this.h()},h(){f(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),f(e,"class",r="px-3 py-1.5 rounded-xl w-full text-left "+(n[18]===n[1]?"  bg-gray-50 dark:bg-gray-850  selected-command-option-button":"")),f(e,"type","button")},m(d,m){O(d,e,m),v(e,t),v(t,s),v(e,o),i||(a=[$(e,"click",u),$(e,"mousemove",c),$(e,"focus",Ir)],i=!0)},p(d,m){n=d,m&4&&l!==(l=n[16].name+"")&&Se(s,l),m&2&&r!==(r="px-3 py-1.5 rounded-xl w-full text-left "+(n[18]===n[1]?"  bg-gray-50 dark:bg-gray-850  selected-command-option-button":""))&&f(e,"class",r)},d(d){d&&h(e),i=!1,gt(a)}}}function Er(n){let e=n[0].charAt(0)==="@",t,l=e&&Jl(n);return{c(){l&&l.c(),t=Fe()},l(s){l&&l.l(s),t=Fe()},m(s,o){l&&l.m(s,o),O(s,t,o)},p(s,[o]){o&1&&(e=s[0].charAt(0)==="@"),e?l?l.p(s,o):(l=Jl(s),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:we,o:we,d(s){s&&h(t),l&&l.d(s)}}}const Ir=()=>{};function Sr(n,e,t){let l;ue(n,ll,p=>t(10,l=p));const s=_t("i18n");ue(n,s,p=>t(13,p));const o=Gt();let{prompt:r=""}=e,{user:i=null}=e,{chatInputPlaceholder:a=""}=e,{messages:u=[]}=e,c=0,d=[];const m=()=>{t(1,c=Math.max(0,c-1))},b=()=>{t(1,c=Math.min(c+1,d.length-1))},S=async p=>{t(0,r=""),o("select",p)},g=p=>{S(p)},_=p=>{t(1,c=p)};return n.$$set=p=>{"prompt"in p&&t(0,r=p.prompt),"user"in p&&t(5,i=p.user),"chatInputPlaceholder"in p&&t(6,a=p.chatInputPlaceholder),"messages"in p&&t(7,u=p.messages)},n.$$.update=()=>{n.$$.dirty&1025&&t(2,d=l.filter(p=>{var w,C;return p.name.includes(((C=(w=r.split(" "))==null?void 0:w.at(0))==null?void 0:C.substring(1))??"")}).sort((p,w)=>p.name.localeCompare(w.name))),n.$$.dirty&1&&r&&t(1,c=0)},[r,c,d,s,S,i,a,u,m,b,l,g,_]}class Dr extends Ke{constructor(e){super(),xe(this,e,Sr,Er,Xe,{prompt:0,user:5,chatInputPlaceholder:6,messages:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function Mr(n){let e,t;return{c(){e=ve("svg"),t=ve("path"),this.h()},l(l){e=be(l,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var s=k(e);t=be(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),k(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"stroke-linecap","round"),f(t,"stroke-linejoin","round"),f(t,"d","M6 18 18 6M6 6l12 12"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width",n[1]),f(e,"stroke","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),v(e,t)},p(l,[s]){s&2&&f(e,"stroke-width",l[1]),s&1&&f(e,"class",l[0])},i:we,o:we,d(l){l&&h(e)}}}function Tr(n,e,t){let{className:l="size-3.5"}=e,{strokeWidth:s="2"}=e;return n.$$set=o=>{"className"in o&&t(0,l=o.className),"strokeWidth"in o&&t(1,s=o.strokeWidth)},[l,s]}class Cr extends Ke{constructor(e){super(),xe(this,e,Tr,Mr,Xe,{className:0,strokeWidth:1})}}function Vr(n){let e,t,l;return{c(){e=ve("svg"),t=ve("path"),l=ve("path"),this.h()},l(s){e=be(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var o=k(e);t=be(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),k(t).forEach(h),l=be(o,"path",{d:!0}),k(l).forEach(h),o.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z"),f(t,"clip-rule","evenodd"),f(l,"d","M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",n[0])},m(s,o){O(s,e,o),v(e,t),v(e,l)},p(s,[o]){o&1&&f(e,"class",s[0])},i:we,o:we,d(s){s&&h(e)}}}function Br(n,e,t){let{className:l="size-4"}=e;return n.$$set=s=>{"className"in s&&t(0,l=s.className)},[l]}class Nr extends Ke{constructor(e){super(),xe(this,e,Br,Vr,Xe,{className:0})}}function Lr(n){let e,t;return{c(){e=ve("svg"),t=ve("path"),this.h()},l(l){e=be(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=k(e);t=be(s,"path",{d:!0}),k(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"d","M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),v(e,t)},p(l,[s]){s&1&&f(e,"class",l[0])},i:we,o:we,d(l){l&&h(e)}}}function Ar(n,e,t){let{className:l="size-4"}=e;return n.$$set=s=>{"className"in s&&t(0,l=s.className)},[l]}class Hr extends Ke{constructor(e){super(),xe(this,e,Ar,Lr,Xe,{className:0})}}function Or(n){let e,t;return{c(){e=ve("svg"),t=ve("path"),this.h()},l(l){e=be(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=k(e);t=be(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),k(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),v(e,t)},p(l,[s]){s&1&&f(e,"class",l[0])},i:we,o:we,d(l){l&&h(e)}}}function Ur(n,e,t){let{className:l="size-4"}=e;return n.$$set=s=>{"className"in s&&t(0,l=s.className)},[l]}class Pr extends Ke{constructor(e){super(),xe(this,e,Ur,Or,Xe,{className:0})}}function Xl(n,e,t){const l=n.slice();return l[17]=e[t],l[18]=e,l[19]=t,l}function zr(n){let e;const t=n[9].default,l=ft(t,n,n[16],null);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&65536)&&dt(l,t,s,s[16],e?mt(t,s[16],o,null):ht(s[16]),null)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Rr(n){let e,t;return e=new It({props:{content:n[7].t("More"),$$slots:{default:[zr]},$$scope:{ctx:n}}}),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s&128&&(o.content=l[7].t("More")),s&65536&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function Kl(n){let e,t,l,s,o=nt(Object.keys(n[1])),r=[];for(let a=0;a<o.length;a+=1)r[a]=xl(Xl(n,o,a));const i=a=>z(r[a],1,1,()=>{r[a]=null});return{c(){e=E("div");for(let a=0;a<r.length;a+=1)r[a].c();t=J(),l=E("hr"),this.h()},l(a){e=I(a,"DIV",{class:!0});var u=k(e);for(let c=0;c<r.length;c+=1)r[c].l(u);u.forEach(h),t=Q(a),l=I(a,"HR",{class:!0}),this.h()},h(){f(e,"class","max-h-28 overflow-y-auto scrollbar-hidden"),f(l,"class","border-gray-100 dark:border-gray-800 my-1")},m(a,u){O(a,e,u);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);O(a,t,u),O(a,l,u),s=!0},p(a,u){if(u&3){o=nt(Object.keys(a[1]));let c;for(c=0;c<o.length;c+=1){const d=Xl(a,o,c);r[c]?(r[c].p(d,u),H(r[c],1)):(r[c]=xl(d),r[c].c(),H(r[c],1),r[c].m(e,null))}for(Ue(),c=o.length;c<r.length;c+=1)i(c);Pe()}},i(a){if(!s){for(let u=0;u<o.length;u+=1)H(r[u]);s=!0}},o(a){r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)z(r[u]);s=!1},d(a){a&&(h(e),h(t),h(l)),Dt(r,a)}}}function jr(n){let e,t=n[1][n[17]].name+"",l;return{c(){e=E("div"),l=ge(t),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);l=_e(o,t),o.forEach(h),this.h()},h(){f(e,"class","line-clamp-1")},m(s,o){O(s,e,o),v(e,l)},p(s,o){o&2&&t!==(t=s[1][s[17]].name+"")&&Se(l,t)},d(s){s&&h(e)}}}function xl(n){var S;let e,t,l,s,o,r,i,a,u,c;l=new Pr({}),o=new It({props:{content:((S=n[1][n[17]])==null?void 0:S.description)??"",className:"flex-1",$$slots:{default:[jr]},$$scope:{ctx:n}}});function d(g){n[10](g,n[17])}function m(...g){return n[11](n[17],...g)}let b={};return n[1][n[17]].enabled!==void 0&&(b.state=n[1][n[17]].enabled),i=new Hn({props:b}),ke.push(()=>Oe(i,"state",d)),i.$on("change",m),{c(){e=E("div"),t=E("div"),oe(l.$$.fragment),s=J(),oe(o.$$.fragment),r=J(),oe(i.$$.fragment),u=J(),this.h()},l(g){e=I(g,"DIV",{class:!0});var _=k(e);t=I(_,"DIV",{class:!0});var p=k(t);ie(l.$$.fragment,p),s=Q(p),ie(o.$$.fragment,p),p.forEach(h),r=Q(_),ie(i.$$.fragment,_),u=Q(_),_.forEach(h),this.h()},h(){f(t,"class","flex-1 flex items-center gap-2"),f(e,"class","flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl")},m(g,_){O(g,e,_),v(e,t),ae(l,t,null),v(t,s),ae(o,t,null),v(e,r),ae(i,e,null),v(e,u),c=!0},p(g,_){var C;n=g;const p={};_&2&&(p.content=((C=n[1][n[17]])==null?void 0:C.description)??""),_&65538&&(p.$$scope={dirty:_,ctx:n}),o.$set(p);const w={};!a&&_&2&&(a=!0,w.state=n[1][n[17]].enabled,He(()=>a=!1)),i.$set(w)},i(g){c||(H(l.$$.fragment,g),H(o.$$.fragment,g),H(i.$$.fragment,g),c=!0)},o(g){z(l.$$.fragment,g),z(o.$$.fragment,g),z(i.$$.fragment,g),c=!1},d(g){g&&h(e),ce(l),ce(o),ce(i)}}}function $l(n){let e,t,l,s,o,r=n[7].t("Web Search")+"",i,a,u,c,d,m,b;l=new Hr({});function S(_){n[12](_)}let g={};return n[2]!==void 0&&(g.state=n[2]),u=new Hn({props:g}),ke.push(()=>Oe(u,"state",S)),{c(){e=E("div"),t=E("div"),oe(l.$$.fragment),s=J(),o=E("div"),i=ge(r),a=J(),oe(u.$$.fragment),d=J(),m=E("hr"),this.h()},l(_){e=I(_,"DIV",{class:!0});var p=k(e);t=I(p,"DIV",{class:!0});var w=k(t);ie(l.$$.fragment,w),s=Q(w),o=I(w,"DIV",{class:!0});var C=k(o);i=_e(C,r),C.forEach(h),w.forEach(h),a=Q(p),ie(u.$$.fragment,p),p.forEach(h),d=Q(_),m=I(_,"HR",{class:!0}),this.h()},h(){f(o,"class","line-clamp-1"),f(t,"class","flex-1 flex items-center gap-2"),f(e,"class","flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl"),f(m,"class","border-gray-100 dark:border-gray-800 my-1")},m(_,p){O(_,e,p),v(e,t),ae(l,t,null),v(t,s),v(t,o),v(o,i),v(e,a),ae(u,e,null),O(_,d,p),O(_,m,p),b=!0},p(_,p){(!b||p&128)&&r!==(r=_[7].t("Web Search")+"")&&Se(i,r);const w={};!c&&p&4&&(c=!0,w.state=_[2],He(()=>c=!1)),u.$set(w)},i(_){b||(H(l.$$.fragment,_),H(u.$$.fragment,_),b=!0)},o(_){z(l.$$.fragment,_),z(u.$$.fragment,_),b=!1},d(_){_&&(h(e),h(d),h(m)),ce(l),ce(u)}}}function Fr(n){let e,t,l,s=n[7].t("Upload Files")+"",o,r;return e=new Nr({}),{c(){oe(e.$$.fragment),t=J(),l=E("div"),o=ge(s),this.h()},l(i){ie(e.$$.fragment,i),t=Q(i),l=I(i,"DIV",{class:!0});var a=k(l);o=_e(a,s),a.forEach(h),this.h()},h(){f(l,"class","line-clamp-1")},m(i,a){ae(e,i,a),O(i,t,a),O(i,l,a),v(l,o),r=!0},p(i,a){(!r||a&128)&&s!==(s=i[7].t("Upload Files")+"")&&Se(o,s)},i(i){r||(H(e.$$.fragment,i),r=!0)},o(i){z(e.$$.fragment,i),r=!1},d(i){i&&(h(t),h(l)),ce(e,i)}}}function qr(n){var a,u;let e=Object.keys(n[1]).length>0,t,l,s,o,r=e&&Kl(n),i=((u=(a=n[6])==null?void 0:a.features)==null?void 0:u.enable_web_search)&&$l(n);return s=new Ht({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$slots:{default:[Fr]},$$scope:{ctx:n}}}),s.$on("click",n[13]),{c(){r&&r.c(),t=J(),i&&i.c(),l=J(),oe(s.$$.fragment)},l(c){r&&r.l(c),t=Q(c),i&&i.l(c),l=Q(c),ie(s.$$.fragment,c)},m(c,d){r&&r.m(c,d),O(c,t,d),i&&i.m(c,d),O(c,l,d),ae(s,c,d),o=!0},p(c,d){var b,S;d&2&&(e=Object.keys(c[1]).length>0),e?r?(r.p(c,d),d&2&&H(r,1)):(r=Kl(c),r.c(),H(r,1),r.m(t.parentNode,t)):r&&(Ue(),z(r,1,1,()=>{r=null}),Pe()),(S=(b=c[6])==null?void 0:b.features)!=null&&S.enable_web_search?i?(i.p(c,d),d&64&&H(i,1)):(i=$l(c),i.c(),H(i,1),i.m(l.parentNode,l)):i&&(Ue(),z(i,1,1,()=>{i=null}),Pe());const m={};d&65664&&(m.$$scope={dirty:d,ctx:c}),s.$set(m)},i(c){o||(H(r),H(i),H(s.$$.fragment,c),o=!0)},o(c){z(r),z(i),z(s.$$.fragment,c),o=!1},d(c){c&&(h(t),h(l)),r&&r.d(c),i&&i.d(c),ce(s,c)}}}function Wr(n){let e,t,l;return t=new fl({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow",sideOffset:15,alignOffset:-8,side:"top",align:"start",transition:nl,$$slots:{default:[qr]},$$scope:{ctx:n}}}),{c(){e=E("div"),oe(t.$$.fragment),this.h()},l(s){e=I(s,"DIV",{slot:!0});var o=k(e);ie(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(s,o){O(s,e,o),ae(t,e,null),l=!0},p(s,o){const r={};o&65743&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),ce(t)}}}function Zr(n){let e,t,l;function s(r){n[14](r)}let o={$$slots:{content:[Wr],default:[Rr]},$$scope:{ctx:n}};return n[5]!==void 0&&(o.show=n[5]),e=new ul({props:o}),ke.push(()=>Oe(e,"show",s)),e.$on("change",n[15]),{c(){oe(e.$$.fragment)},l(r){ie(e.$$.fragment,r)},m(r,i){ae(e,r,i),l=!0},p(r,[i]){const a={};i&65743&&(a.$$scope={dirty:i,ctx:r}),!t&&i&32&&(t=!0,a.show=r[5],He(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){ce(e,r)}}}function Gr(n,e,t){let l,s;ue(n,Jt,D=>t(6,l=D));let{$$slots:o={},$$scope:r}=e;const i=_t("i18n");ue(n,i,D=>t(7,s=D));let{uploadFilesHandler:a}=e,{selectedToolIds:u=[]}=e,{webSearchEnabled:c}=e,{tools:d={}}=e,{onClose:m}=e,b=!1;function S(D,N){n.$$.not_equal(d[N].enabled,D)&&(d[N].enabled=D,t(1,d),t(0,u))}const g=(D,N)=>{t(0,u=N.detail?[...u,D]:u.filter(T=>T!==D))};function _(D){c=D,t(2,c)}const p=()=>{a()};function w(D){b=D,t(5,b)}const C=D=>{D.detail===!1&&m()};return n.$$set=D=>{"uploadFilesHandler"in D&&t(3,a=D.uploadFilesHandler),"selectedToolIds"in D&&t(0,u=D.selectedToolIds),"webSearchEnabled"in D&&t(2,c=D.webSearchEnabled),"tools"in D&&t(1,d=D.tools),"onClose"in D&&t(4,m=D.onClose),"$$scope"in D&&t(16,r=D.$$scope)},n.$$.update=()=>{n.$$.dirty&3&&t(1,d=Object.fromEntries(Object.keys(d).map(D=>[D,{...d[D],enabled:u.includes(D)}])))},[u,d,c,a,m,b,l,s,i,o,S,g,_,p,w,C,r]}class Jr extends Ke{constructor(e){super(),xe(this,e,Gr,Zr,Xe,{uploadFilesHandler:3,selectedToolIds:0,webSearchEnabled:2,tools:1,onClose:4})}}function Qr(n){let e,t;return{c(){e=ve("svg"),t=ve("path"),this.h()},l(l){e=be(l,"svg",{"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var s=k(e);t=be(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),k(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z"),f(t,"clip-rule","evenodd"),f(e,"aria-hidden","true"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","currentColor"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width",n[1]),f(e,"stroke","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),v(e,t)},p(l,[s]){s&2&&f(e,"stroke-width",l[1]),s&1&&f(e,"class",l[0])},i:we,o:we,d(l){l&&h(e)}}}function Yr(n,e,t){let{className:l="w-4 h-4"}=e,{strokeWidth:s="0"}=e;return n.$$set=o=>{"className"in o&&t(0,l=o.className),"strokeWidth"in o&&t(1,s=o.strokeWidth)},[l,s]}class Xr extends Ke{constructor(e){super(),xe(this,e,Yr,Qr,Xe,{className:0,strokeWidth:1})}}function en(n,e,t){const l=n.slice();return l[29]=e[t],l}function tn(n){let e,t;return{c(){e=E("div"),this.h()},l(l){e=I(l,"DIV",{class:!0,style:!0}),k(e).forEach(h),this.h()},h(){f(e,"class",t="w-[2px] "+(n[0]?" bg-gray-500 dark:bg-gray-400   ":"bg-indigo-500 dark:bg-indigo-400  ")+" inline-block h-full"),ct(e,"height",Math.min(100,Math.max(14,n[29]*100))+"%")},m(l,s){O(l,e,s)},p(l,s){s[0]&1&&t!==(t="w-[2px] "+(l[0]?" bg-gray-500 dark:bg-gray-400   ":"bg-indigo-500 dark:bg-indigo-400  ")+" inline-block h-full")&&f(e,"class",t),s[0]&4&&ct(e,"height",Math.min(100,Math.max(14,l[29]*100))+"%")},d(l){l&&h(e)}}}function Kr(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-4"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>',l,s;return{c(){e=E("button"),e.innerHTML=t,this.h()},l(o){e=I(o,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-1qzkal"&&(e.innerHTML=t),this.h()},h(){f(e,"type","button"),f(e,"class","p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full")},m(o,r){O(o,e,r),l||(s=$(e,"click",n[10]),l=!0)},p:we,d(o){o&&h(e),l=!1,s()}}}function xr(n){let e,t=`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><style>.spinner_OSmW {
							transform-origin: center;
							animation: spinner_T6mA 0.75s step-end infinite;
						}
						@keyframes spinner_T6mA {
							8.3% {
								transform: rotate(30deg);
							}
							16.6% {
								transform: rotate(60deg);
							}
							25% {
								transform: rotate(90deg);
							}
							33.3% {
								transform: rotate(120deg);
							}
							41.6% {
								transform: rotate(150deg);
							}
							50% {
								transform: rotate(180deg);
							}
							58.3% {
								transform: rotate(210deg);
							}
							66.6% {
								transform: rotate(240deg);
							}
							75% {
								transform: rotate(270deg);
							}
							83.3% {
								transform: rotate(300deg);
							}
							91.6% {
								transform: rotate(330deg);
							}
							100% {
								transform: rotate(360deg);
							}
						}
					</style><g class="spinner_OSmW"><rect x="11" y="1" width="2" height="5" opacity=".14"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(30 12 12)" opacity=".29"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(60 12 12)" opacity=".43"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(90 12 12)" opacity=".57"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(120 12 12)" opacity=".71"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(150 12 12)" opacity=".86"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(180 12 12)"></rect></g></svg>`;return{c(){e=E("div"),e.innerHTML=t,this.h()},l(l){e=I(l,"DIV",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-otpw2s"&&(e.innerHTML=t),this.h()},h(){f(e,"class","text-gray-500 rounded-full cursor-not-allowed")},m(l,s){O(l,e,s)},p:we,d(l){l&&h(e)}}}function $r(n){let e,t,l,s,o,r,i,a,u,c,d,m,b=n[5](n[1])+"",S,g,_,p,w,C,D,N=nt(n[2].slice().reverse()),T=[];for(let j=0;j<N.length;j+=1)T[j]=tn(en(n,N,j));function A(j,U){return j[0]?xr:Kr}let V=A(n),W=V(n);return{c(){e=E("div"),t=E("div"),l=E("button"),s=ve("svg"),o=ve("path"),i=J(),a=E("div"),u=E("div");for(let j=0;j<T.length;j+=1)T[j].c();c=J(),d=E("div"),m=E("div"),S=ge(b),_=J(),p=E("div"),W.c(),this.h()},l(j){e=I(j,"DIV",{class:!0});var U=k(e);t=I(U,"DIV",{class:!0});var F=k(t);l=I(F,"BUTTON",{type:!0,class:!0});var re=k(l);s=be(re,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var le=k(s);o=be(le,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),k(o).forEach(h),le.forEach(h),re.forEach(h),F.forEach(h),i=Q(U),a=I(U,"DIV",{class:!0,dir:!0});var R=k(a);u=I(R,"DIV",{class:!0});var M=k(u);for(let fe=0;fe<T.length;fe+=1)T[fe].l(M);M.forEach(h),R.forEach(h),c=Q(U),d=I(U,"DIV",{class:!0});var B=k(d);m=I(B,"DIV",{class:!0});var ee=k(m);S=_e(ee,b),ee.forEach(h),B.forEach(h),_=Q(U),p=I(U,"DIV",{class:!0});var ne=k(p);W.l(ne),ne.forEach(h),U.forEach(h),this.h()},h(){f(o,"stroke-linecap","round"),f(o,"stroke-linejoin","round"),f(o,"d","M6 18 18 6M6 6l12 12"),f(s,"xmlns","http://www.w3.org/2000/svg"),f(s,"fill","none"),f(s,"viewBox","0 0 24 24"),f(s,"stroke-width","3"),f(s,"stroke","currentColor"),f(s,"class","size-4"),f(l,"type","button"),f(l,"class",r="p-1.5 "+(n[0]?" bg-gray-200 dark:bg-gray-700/50":"bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 ")+" rounded-full"),f(t,"class","flex items-center mr-1"),f(u,"class","flex-1 flex items-center gap-0.5 h-6"),f(a,"class","flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6"),f(a,"dir","rtl"),f(m,"class",g="text-sm "+(n[0]?" text-gray-500  dark:text-gray-400  ":" text-indigo-400 ")+" font-medium flex-1 mx-auto text-center"),f(d,"class","mx-1.5 pr-1 flex justify-center items-center"),f(p,"class","flex items-center mr-1"),f(e,"class",w=(n[0]?" bg-gray-100/50 dark:bg-gray-850/50":"bg-indigo-300/10 dark:bg-indigo-500/10 ")+" rounded-full flex p-2.5")},m(j,U){O(j,e,U),v(e,t),v(t,l),v(l,s),v(s,o),v(e,i),v(e,a),v(a,u);for(let F=0;F<T.length;F+=1)T[F]&&T[F].m(u,null);v(e,c),v(e,d),v(d,m),v(m,S),v(e,_),v(e,p),W.m(p,null),C||(D=$(l,"click",n[9]),C=!0)},p(j,U){if(U[0]&1&&r!==(r="p-1.5 "+(j[0]?" bg-gray-200 dark:bg-gray-700/50":"bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 ")+" rounded-full")&&f(l,"class",r),U[0]&5){N=nt(j[2].slice().reverse());let F;for(F=0;F<N.length;F+=1){const re=en(j,N,F);T[F]?T[F].p(re,U):(T[F]=tn(re),T[F].c(),T[F].m(u,null))}for(;F<T.length;F+=1)T[F].d(1);T.length=N.length}U[0]&2&&b!==(b=j[5](j[1])+"")&&Se(S,b),U[0]&1&&g!==(g="text-sm "+(j[0]?" text-gray-500  dark:text-gray-400  ":" text-indigo-400 ")+" font-medium flex-1 mx-auto text-center")&&f(m,"class",g),V===(V=A(j))&&W?W.p(j,U):(W.d(1),W=V(j),W&&(W.c(),W.m(p,null))),U[0]&1&&w!==(w=(j[0]?" bg-gray-100/50 dark:bg-gray-850/50":"bg-indigo-300/10 dark:bg-indigo-500/10 ")+" rounded-full flex p-2.5")&&f(e,"class",w)},i:we,o:we,d(j){j&&h(e),Dt(T,j),W.d(),C=!1,D()}}}const ln=300;function eo(n,e,t){let l,s,o;ue(n,kt,R=>t(18,s=R)),ue(n,Jt,R=>t(19,o=R));const r=_t("i18n");ue(n,r,R=>t(17,l=R));const i=Gt();let{recording:a=!1}=e,u=!1,c=!1,d=0,m=null,b="";const S=()=>{m=setInterval(()=>{t(1,d++,d)},1e3)},g=()=>{clearInterval(m),t(1,d=0)},_=R=>{const M=Math.floor(R/60),B=R%60,ee=B<10?`0${B}`:B;return`${M}:${ee}`};let p,w,C=[];const D=-45;let N=Array(ln).fill(0);const T=R=>{let M=0;for(let B=0;B<R.length;B++){const ee=(R[B]-128)/128;M+=ee*ee}return Math.sqrt(M/R.length)},A=R=>{R=R*10;const B=Math.pow(R,1.5);return Math.min(1,Math.max(.01,B))},V=R=>{const M=new AudioContext,B=M.createMediaStreamSource(R),ee=M.createAnalyser();ee.minDecibels=D,B.connect(ee);const ne=ee.frequencyBinCount,fe=new Uint8Array(ne),Be=new Uint8Array(ee.fftSize);(()=>{const $e=()=>{if(!(!a||u)){if(a&&!u){ee.getByteTimeDomainData(Be),ee.getByteFrequencyData(fe);const Ie=T(Be);N.push(A(Ie)),N.length>=ln&&N.shift(),t(2,N)}window.requestAnimationFrame($e)}};window.requestAnimationFrame($e)})()},W=async R=>{await Me();const M=cl(R,"recording.wav"),B=await dl(localStorage.token,M).catch(ee=>(Ee.error(ee),null));B&&(console.log(B.text),i("confirm",B.text))},j=async()=>{var M,B;S();const R=await navigator.mediaDevices.getUserMedia({audio:!0});if(w=new MediaRecorder(R),w.onstart=()=>{console.log("Recording started"),C=[],V(R)},w.ondataavailable=ee=>C.push(ee.data),w.onstop=async()=>{var ee,ne;if(console.log("Recording stopped"),(((ne=(ee=s==null?void 0:s.audio)==null?void 0:ee.stt)==null?void 0:ne.engine)??"")==="web")C=[];else{if(c){const fe=new Blob(C,{type:"audio/wav"});await W(fe),c=!1,t(0,u=!1)}C=[],t(8,a=!1)}},w.start(),(o.audio.stt.engine==="web"||(((B=(M=s==null?void 0:s.audio)==null?void 0:M.stt)==null?void 0:B.engine)??"")==="web")&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)){p=new(window.SpeechRecognition||window.webkitSpeechRecognition),p.continuous=!0;const ee=2e3;let ne;p.start(),p.onresult=async fe=>{var Ge;clearTimeout(ne),console.log(fe);const Be=fe.results[Object.keys(fe.results).length-1][0].transcript;b=`${b}${Be}`,await Me(),(Ge=document.getElementById("chat-textarea"))==null||Ge.focus(),ne=setTimeout(()=>{console.log("Speech recognition turned off due to inactivity."),p.stop()},ee)},p.onend=function(){console.log("recognition ended"),F(),i("confirm",b),c=!1,t(0,u=!1)},p.onerror=function(fe){console.log(fe),Ee.error(l.t("Speech recognition error: {{error}}",{error:fe.error})),i("cancel"),U()}}},U=async()=>{a&&w&&await w.stop(),g(),C=[]},F=async()=>{t(0,u=!0),c=!0,a&&w&&await w.stop(),clearInterval(m)},re=async()=>{i("cancel"),U()},le=async()=>{await F()};return n.$$set=R=>{"recording"in R&&t(8,a=R.recording)},n.$$.update=()=>{n.$$.dirty[0]&256&&(a?j():U())},[u,d,N,r,i,_,U,F,a,re,le]}class to extends Ke{constructor(e){super(),xe(this,e,eo,$r,Xe,{recording:8},null,[-1,-1])}}function nn(n,e,t){const l=n.slice();return l[74]=e[t],l[76]=t,l}function sn(n){let e,t,l,s,o,r,i;return o=new _s({}),{c(){e=E("div"),t=E("div"),l=E("div"),s=E("div"),oe(o.$$.fragment),this.h()},l(a){e=I(a,"DIV",{class:!0,id:!0,role:!0,"aria-label":!0});var u=k(e);t=I(u,"DIV",{class:!0});var c=k(t);l=I(c,"DIV",{class:!0});var d=k(l);s=I(d,"DIV",{class:!0});var m=k(s);ie(o.$$.fragment,m),m.forEach(h),d.forEach(h),c.forEach(h),u.forEach(h),this.h()},h(){f(s,"class","max-w-md"),f(l,"class","m-auto pt-64 flex flex-col justify-center"),f(t,"class","absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center"),f(e,"class",r="fixed "+(n[24]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"),f(e,"id","dropzone"),f(e,"role","region"),f(e,"aria-label","Drag and Drop Container")},m(a,u){O(a,e,u),v(e,t),v(t,l),v(l,s),ae(o,s,null),i=!0},p(a,u){(!i||u[0]&16777216&&r!==(r="fixed "+(a[24]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"))&&f(e,"class",r)},i(a){i||(H(o.$$.fragment,a),i=!0)},o(a){z(o.$$.fragment,a),i=!1},d(a){a&&h(e),ce(o)}}}function rn(n){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',s,o;return{c(){e=E("div"),t=E("button"),t.innerHTML=l,this.h()},l(r){e=I(r,"DIV",{class:!0});var i=k(e);t=I(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-a2mahu"&&(t.innerHTML=l),i.forEach(h),this.h()},h(){f(t,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full"),f(e,"class","absolute -top-12 left-0 right-0 flex justify-center z-30")},m(r,i){O(r,e,i),v(e,t),s||(o=$(t,"click",n[35]),s=!0)},p:we,d(r){r&&h(e),s=!1,o()}}}function lo(n){let e,t,l;function s(r){n[40](r)}let o={};return n[1]!==void 0&&(o.prompt=n[1]),e=new yr({props:o}),n[39](e),ke.push(()=>Oe(e,"prompt",s)),e.$on("youtube",n[41]),e.$on("url",n[42]),e.$on("select",n[43]),{c(){oe(e.$$.fragment)},l(r){ie(e.$$.fragment,r)},m(r,i){ae(e,r,i),l=!0},p(r,i){const a={};!t&&i[0]&2&&(t=!0,a.prompt=r[1],He(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){n[39](null),ce(e,r)}}}function no(n){let e,t,l,s;function o(a){n[37](a)}function r(a){n[38](a)}let i={};return n[1]!==void 0&&(i.prompt=n[1]),n[3]!==void 0&&(i.files=n[3]),e=new hr({props:i}),n[36](e),ke.push(()=>Oe(e,"prompt",o)),ke.push(()=>Oe(e,"files",r)),{c(){oe(e.$$.fragment)},l(a){ie(e.$$.fragment,a)},m(a,u){ae(e,a,u),s=!0},p(a,u){const c={};!t&&u[0]&2&&(t=!0,c.prompt=a[1],He(()=>t=!1)),!l&&u[0]&8&&(l=!0,c.files=a[3],He(()=>l=!1)),e.$set(c)},i(a){s||(H(e.$$.fragment,a),s=!0)},o(a){z(e.$$.fragment,a),s=!1},d(a){n[36](null),ce(e,a)}}}function on(n){let e,t,l,s,o,r,i,a,u=n[0].name+"",c,d,m,b,S,g,_,p;return S=new Cr({}),{c(){e=E("div"),t=E("div"),l=E("img"),o=J(),r=E("div"),i=ge("Talking to "),a=E("span"),c=ge(u),d=J(),m=E("div"),b=E("button"),oe(S.$$.fragment),this.h()},l(w){e=I(w,"DIV",{class:!0});var C=k(e);t=I(C,"DIV",{class:!0});var D=k(t);l=I(D,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),o=Q(D),r=I(D,"DIV",{});var N=k(r);i=_e(N,"Talking to "),a=I(N,"SPAN",{class:!0});var T=k(a);c=_e(T,u),T.forEach(h),N.forEach(h),D.forEach(h),d=Q(C),m=I(C,"DIV",{});var A=k(m);b=I(A,"BUTTON",{class:!0});var V=k(b);ie(S.$$.fragment,V),V.forEach(h),A.forEach(h),C.forEach(h),this.h()},h(){var w,C,D;f(l,"crossorigin","anonymous"),f(l,"alt","model profile"),f(l,"class","size-5 max-w-[28px] object-cover rounded-full"),At(l.src,s=((D=(C=(w=n[12].find(n[48]))==null?void 0:w.info)==null?void 0:C.meta)==null?void 0:D.profile_image_url)??(n[23].language==="dg-DG"?"/doge.png":`${xt}/static/favicon.png`))||f(l,"src",s),f(a,"class","font-medium"),f(t,"class","flex items-center gap-2 text-sm dark:text-gray-500"),f(b,"class","flex items-center"),f(e,"class","px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900")},m(w,C){O(w,e,C),v(e,t),v(t,l),v(t,o),v(t,r),v(r,i),v(r,a),v(a,c),v(e,d),v(e,m),v(m,b),ae(S,b,null),g=!0,_||(p=$(b,"click",n[49]),_=!0)},p(w,C){var D,N,T;(!g||C[0]&8392705&&!At(l.src,s=((T=(N=(D=w[12].find(w[48]))==null?void 0:D.info)==null?void 0:N.meta)==null?void 0:T.profile_image_url)??(w[23].language==="dg-DG"?"/doge.png":`${xt}/static/favicon.png`)))&&f(l,"src",s),(!g||C[0]&1)&&u!==(u=w[0].name+"")&&Se(c,u)},i(w){g||(H(S.$$.fragment,w),g=!0)},o(w){z(S.$$.fragment,w),g=!1},d(w){w&&h(e),ce(S),_=!1,p()}}}function so(n){let e,t,l,s,o,r,i,a,u,c,d,m,b,S=n[10].length==0||n[10].at(-1).done==!0,g,_,p,w,C,D,N,T,A,V=n[3].length>0&&an(n);function W(M){n[61](M)}function j(M){n[62](M)}let U={tools:n[26].reduce(n[58],{}),uploadFilesHandler:n[59],onClose:n[60],$$slots:{default:[ho]},$$scope:{ctx:n}};n[5]!==void 0&&(U.webSearchEnabled=n[5]),n[4]!==void 0&&(U.selectedToolIds=n[4]),r=new Jr({props:U}),ke.push(()=>Oe(r,"webSearchEnabled",W)),ke.push(()=>Oe(r,"selectedToolIds",j));let F=S&&fn(n);const re=[_o,go],le=[];function R(M,B){return B[0]&1024&&(w=null),w==null&&(w=M[10].length==0||M[10].at(-1).done==!0),w?0:1}return C=R(n,[-1,-1,-1]),D=le[C]=re[C](n),{c(){e=E("form"),t=E("div"),V&&V.c(),l=J(),s=E("div"),o=E("div"),oe(r.$$.fragment),u=J(),c=E("textarea"),m=J(),b=E("div"),F&&F.c(),_=J(),p=E("div"),D.c(),this.h()},l(M){e=I(M,"FORM",{class:!0});var B=k(e);t=I(B,"DIV",{class:!0,dir:!0});var ee=k(t);V&&V.l(ee),l=Q(ee),s=I(ee,"DIV",{class:!0});var ne=k(s);o=I(ne,"DIV",{class:!0});var fe=k(o);ie(r.$$.fragment,fe),fe.forEach(h),u=Q(ne),c=I(ne,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),k(c).forEach(h),m=Q(ne),b=I(ne,"DIV",{class:!0});var Be=k(b);F&&F.l(Be),Be.forEach(h),ne.forEach(h),ee.forEach(h),_=Q(B),p=I(B,"DIV",{class:!0});var Ge=k(p);D.l(Ge),Ge.forEach(h),B.forEach(h),this.h()},h(){var M;f(o,"class","ml-0.5 self-end mb-1.5 flex space-x-1"),f(c,"id","chat-textarea"),f(c,"class","scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-1 rounded-xl resize-none h-[48px] svelte-141e0sl"),f(c,"placeholder",d=n[21]!==""?n[21]:n[23].t("Send a Message")),f(c,"rows","1"),f(b,"class","self-end mb-2 flex space-x-1 mr-1"),f(s,"class","flex"),f(t,"class","flex-1 flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100"),f(t,"dir",g=((M=n[25])==null?void 0:M.chatDirection)??"LTR"),f(p,"class","flex items-end w-10"),f(e,"class","w-full flex gap-1.5")},m(M,B){O(M,e,B),v(e,t),V&&V.m(t,null),v(t,l),v(t,s),v(s,o),ae(r,o,null),v(s,u),v(s,c),n[63](c),_l(c,n[1]),v(s,m),v(s,b),F&&F.m(b,null),v(e,_),v(e,p),le[C].m(p,null),N=!0,T||(A=[$(c,"input",n[64]),$(c,"keypress",n[65]),$(c,"keydown",n[66]),$(c,"input",n[67]),$(c,"focus",n[68]),$(c,"paste",n[69]),$(e,"submit",Un(n[73]))],T=!0)},p(M,B){var fe;M[3].length>0?V?(V.p(M,B),B[0]&8&&H(V,1)):(V=an(M),V.c(),H(V,1),V.m(t,l)):V&&(Ue(),z(V,1,1,()=>{V=null}),Pe());const ee={};B[0]&201327104&&(ee.tools=M[26].reduce(M[58],{})),B[0]&16384&&(ee.uploadFilesHandler=M[59]),B[0]&2048&&(ee.onClose=M[60]),B[2]&32768&&(ee.$$scope={dirty:B,ctx:M}),!i&&B[0]&32&&(i=!0,ee.webSearchEnabled=M[5],He(()=>i=!1)),!a&&B[0]&16&&(a=!0,ee.selectedToolIds=M[4],He(()=>a=!1)),r.$set(ee),(!N||B[0]&10485760&&d!==(d=M[21]!==""?M[21]:M[23].t("Send a Message")))&&f(c,"placeholder",d),B[0]&2&&_l(c,M[1]),B[0]&1024&&(S=M[10].length==0||M[10].at(-1).done==!0),S?F?(F.p(M,B),B[0]&1024&&H(F,1)):(F=fn(M),F.c(),H(F,1),F.m(b,null)):F&&(Ue(),z(F,1,1,()=>{F=null}),Pe()),(!N||B[0]&33554432&&g!==(g=((fe=M[25])==null?void 0:fe.chatDirection)??"LTR"))&&f(t,"dir",g);let ne=C;C=R(M,B),C===ne?le[C].p(M,B):(Ue(),z(le[ne],1,1,()=>{le[ne]=null}),Pe(),D=le[C],D?D.p(M,B):(D=le[C]=re[C](M),D.c()),H(D,1),D.m(p,null))},i(M){N||(H(V),H(r.$$.fragment,M),H(F),H(D),N=!0)},o(M){z(V),z(r.$$.fragment,M),z(F),z(D),N=!1},d(M){M&&h(e),V&&V.d(),ce(r),n[63](null),F&&F.d(),le[C].d(),T=!1,gt(A)}}}function ro(n){let e,t,l;function s(r){n[53](r)}let o={};return n[13]!==void 0&&(o.recording=n[13]),e=new to({props:o}),ke.push(()=>Oe(e,"recording",s)),e.$on("cancel",n[54]),e.$on("confirm",n[55]),{c(){oe(e.$$.fragment)},l(r){ie(e.$$.fragment,r)},m(r,i){ae(e,r,i),l=!0},p(r,i){const a={};!t&&i[0]&8192&&(t=!0,a.recording=r[13],He(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){ce(e,r)}}}function an(n){let e,t,l=nt(n[3]),s=[];for(let r=0;r<l.length;r+=1)s[r]=un(nn(n,l,r));const o=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){e=E("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){e=I(r,"DIV",{class:!0});var i=k(e);for(let a=0;a<s.length;a+=1)s[a].l(i);i.forEach(h),this.h()},h(){f(e,"class","mx-2 mt-2 mb-1 flex flex-wrap gap-2")},m(r,i){O(r,e,i);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);t=!0},p(r,i){if(i[0]&12583177){l=nt(r[3]);let a;for(a=0;a<l.length;a+=1){const u=nn(r,l,a);s[a]?(s[a].p(u,i),H(s[a],1)):(s[a]=un(u),s[a].c(),H(s[a],1),s[a].m(e,null))}for(Ue(),a=l.length;a<s.length;a+=1)o(a);Pe()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)H(s[i]);t=!0}},o(r){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)z(s[i]);t=!1},d(r){r&&h(e),Dt(s,r)}}}function oo(n){var b;let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M7.5 3.375c0-1.036.84-1.875 1.875-1.875h.375a3.75 3.75 0 0 1 3.75 3.75v1.875C13.5 8.161 14.34 9 15.375 9h1.875A3.75 3.75 0 0 1 21 12.75v3.375C21 17.16 20.16 18 19.125 18h-9.75A1.875 1.875 0 0 1 7.5 16.125V3.375Z"></path><path d="M15 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 17.25 7.5h-1.875A.375.375 0 0 1 15 7.125V5.25ZM4.875 6H6v10.125A3.375 3.375 0 0 0 9.375 19.5H16.5v1.125c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V7.875C3 6.839 3.84 6 4.875 6Z"></path></svg>',s,o,r,i=(((b=n[74])==null?void 0:b.title)??`#${n[74].name}`)+"",a,u,c,d=n[23].t("Collection")+"",m;return{c(){e=E("div"),t=E("div"),t.innerHTML=l,s=J(),o=E("div"),r=E("div"),a=ge(i),u=J(),c=E("div"),m=ge(d),this.h()},l(S){e=I(S,"DIV",{class:!0});var g=k(e);t=I(g,"DIV",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-1kdy8bu"&&(t.innerHTML=l),s=Q(g),o=I(g,"DIV",{class:!0});var _=k(o);r=I(_,"DIV",{class:!0});var p=k(r);a=_e(p,i),p.forEach(h),u=Q(_),c=I(_,"DIV",{class:!0});var w=k(c);m=_e(w,d),w.forEach(h),_.forEach(h),g.forEach(h),this.h()},h(){f(t,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(r,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(c,"class","text-gray-500 text-sm"),f(o,"class","flex flex-col justify-center -space-y-0.5"),f(e,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(S,g){O(S,e,g),v(e,t),v(e,s),v(e,o),v(o,r),v(r,a),v(o,u),v(o,c),v(c,m)},p(S,g){var _;g[0]&8&&i!==(i=(((_=S[74])==null?void 0:_.title)??`#${S[74].name}`)+"")&&Se(a,i),g[0]&8388608&&d!==(d=S[23].t("Collection")+"")&&Se(m,d)},i:we,o:we,d(S){S&&h(e)}}}function io(n){let e,t,l,s,o,r=n[74].name+"",i,a,u,c=n[23].t("Document")+"",d;function m(g,_){return g[74].upload_status?uo:co}let b=m(n),S=b(n);return{c(){e=E("div"),t=E("div"),S.c(),l=J(),s=E("div"),o=E("div"),i=ge(r),a=J(),u=E("div"),d=ge(c),this.h()},l(g){e=I(g,"DIV",{class:!0});var _=k(e);t=I(_,"DIV",{class:!0});var p=k(t);S.l(p),p.forEach(h),l=Q(_),s=I(_,"DIV",{class:!0});var w=k(s);o=I(w,"DIV",{class:!0});var C=k(o);i=_e(C,r),C.forEach(h),a=Q(w),u=I(w,"DIV",{class:!0});var D=k(u);d=_e(D,c),D.forEach(h),w.forEach(h),_.forEach(h),this.h()},h(){f(t,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(o,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(u,"class","text-gray-500 text-sm"),f(s,"class","flex flex-col justify-center -space-y-0.5"),f(e,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(g,_){O(g,e,_),v(e,t),S.m(t,null),v(e,l),v(e,s),v(s,o),v(o,i),v(s,a),v(s,u),v(u,d)},p(g,_){b!==(b=m(g))&&(S.d(1),S=b(g),S&&(S.c(),S.m(t,null))),_[0]&8&&r!==(r=g[74].name+"")&&Se(i,r),_[0]&8388608&&c!==(c=g[23].t("Document")+"")&&Se(d,c)},i:we,o:we,d(g){g&&h(e),S.d()}}}function ao(n){let e,t,l,s,o,r=(n[0]?n[22].length===0:n[8].length!==n[22].length)&&cn(n);return{c(){e=E("div"),t=E("img"),s=J(),r&&r.c(),this.h()},l(i){e=I(i,"DIV",{class:!0});var a=k(e);t=I(a,"IMG",{src:!0,alt:!0,class:!0}),s=Q(a),r&&r.l(a),a.forEach(h),this.h()},h(){At(t.src,l=n[74].url)||f(t,"src",l),f(t,"alt","input"),f(t,"class","h-16 w-16 rounded-xl object-cover"),f(e,"class","relative")},m(i,a){O(i,e,a),v(e,t),v(e,s),r&&r.m(e,null),o=!0},p(i,a){(!o||a[0]&8&&!At(t.src,l=i[74].url))&&f(t,"src",l),(i[0]?i[22].length===0:i[8].length!==i[22].length)?r?(r.p(i,a),a[0]&4194561&&H(r,1)):(r=cn(i),r.c(),H(r,1),r.m(e,null)):r&&(Ue(),z(r,1,1,()=>{r=null}),Pe())},i(i){o||(H(r),o=!0)},o(i){z(r),o=!1},d(i){i&&h(e),r&&r.d()}}}function co(n){let e,t,l,s,o,r;return{c(){e=ve("svg"),t=ve("style"),l=ge(`.spinner_qM83 {
																		animation: spinner_8HQG 1.05s infinite;
																	}
																	.spinner_oXPr {
																		animation-delay: 0.1s;
																	}
																	.spinner_ZTLf {
																		animation-delay: 0.2s;
																	}
																	@keyframes spinner_8HQG {
																		0%,
																		57.14% {
																			animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																			transform: translate(0);
																		}
																		28.57% {
																			animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																			transform: translateY(-6px);
																		}
																		100% {
																			transform: translate(0);
																		}
																	}
																`),s=ve("circle"),o=ve("circle"),r=ve("circle"),this.h()},l(i){e=be(i,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var a=k(e);t=be(a,"style",{});var u=k(t);l=_e(u,`.spinner_qM83 {
																		animation: spinner_8HQG 1.05s infinite;
																	}
																	.spinner_oXPr {
																		animation-delay: 0.1s;
																	}
																	.spinner_ZTLf {
																		animation-delay: 0.2s;
																	}
																	@keyframes spinner_8HQG {
																		0%,
																		57.14% {
																			animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																			transform: translate(0);
																		}
																		28.57% {
																			animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																			transform: translateY(-6px);
																		}
																		100% {
																			transform: translate(0);
																		}
																	}
																`),u.forEach(h),s=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(s).forEach(h),o=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(o).forEach(h),r=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(r).forEach(h),a.forEach(h),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","2.5"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","2.5"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","2.5"),f(e,"class","w-6 h-6 translate-y-[0.5px]"),f(e,"fill","currentColor"),f(e,"viewBox","0 0 24 24"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){O(i,e,a),v(e,t),v(t,l),v(e,s),v(e,o),v(e,r)},d(i){i&&h(e)}}}function uo(n){let e,t,l;return{c(){e=ve("svg"),t=ve("path"),l=ve("path"),this.h()},l(s){e=be(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var o=k(e);t=be(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),k(t).forEach(h),l=be(o,"path",{d:!0}),k(l).forEach(h),o.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z"),f(t,"clip-rule","evenodd"),f(l,"d","M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","w-6 h-6")},m(s,o){O(s,e,o),v(e,t),v(e,l)},d(s){s&&h(e)}}}function cn(n){let e,t;return e=new It({props:{className:" absolute top-1 left-1",content:n[23].t("{{ models }}",{models:[...n[0]?[n[0]]:n[8]].filter(n[56]).join(", ")}),$$slots:{default:[fo]},$$scope:{ctx:n}}}),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s[0]&12583169&&(o.content=l[23].t("{{ models }}",{models:[...l[0]?[l[0]]:l[8]].filter(l[56]).join(", ")})),s[2]&32768&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function fo(n){let e,t;return{c(){e=ve("svg"),t=ve("path"),this.h()},l(l){e=be(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=k(e);t=be(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),k(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","size-4 fill-yellow-300")},m(l,s){O(l,e,s),v(e,t)},p:we,d(l){l&&h(e)}}}function un(n){let e,t,l,s,o,r,i='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',a,u,c,d;const m=[ao,io,oo],b=[];function S(_,p){return _[74].type==="image"?0:_[74].type==="doc"?1:_[74].type==="collection"?2:-1}~(t=S(n))&&(l=b[t]=m[t](n));function g(){return n[57](n[76])}return{c(){e=E("div"),l&&l.c(),s=J(),o=E("div"),r=E("button"),r.innerHTML=i,a=J(),this.h()},l(_){e=I(_,"DIV",{class:!0});var p=k(e);l&&l.l(p),s=Q(p),o=I(p,"DIV",{class:!0});var w=k(o);r=I(w,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(r)!=="svelte-6u4utr"&&(r.innerHTML=i),w.forEach(h),a=Q(p),p.forEach(h),this.h()},h(){f(r,"class","bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition"),f(r,"type","button"),f(o,"class","absolute -top-1 -right-1"),f(e,"class","relative group")},m(_,p){O(_,e,p),~t&&b[t].m(e,null),v(e,s),v(e,o),v(o,r),v(e,a),u=!0,c||(d=$(r,"click",g),c=!0)},p(_,p){n=_;let w=t;t=S(n),t===w?~t&&b[t].p(n,p):(l&&(Ue(),z(b[w],1,1,()=>{b[w]=null}),Pe()),~t?(l=b[t],l?l.p(n,p):(l=b[t]=m[t](n),l.c()),H(l,1),l.m(e,s)):l=null)},i(_){u||(H(l),u=!0)},o(_){z(l),u=!1},d(_){_&&h(e),~t&&b[t].d(),c=!1,d()}}}function ho(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-5"><path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"></path></svg>';return{c(){e=E("button"),e.innerHTML=t,this.h()},l(l){e=I(l,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-1948p7i"&&(e.innerHTML=t),this.h()},h(){f(e,"class","bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-2 outline-none focus:outline-none"),f(e,"type","button")},m(l,s){O(l,e,s)},p:we,d(l){l&&h(e)}}}function fn(n){let e,t;return e=new It({props:{content:n[23].t("Record voice"),$$slots:{default:[mo]},$$scope:{ctx:n}}}),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s[0]&8388608&&(o.content=l[23].t("Record voice")),s[0]&8396800|s[2]&32768&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function mo(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg>',l,s;return{c(){e=E("button"),e.innerHTML=t,this.h()},l(o){e=I(o,"BUTTON",{id:!0,class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-47fjze"&&(e.innerHTML=t),this.h()},h(){f(e,"id","voice-input-button"),f(e,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center"),f(e,"type","button")},m(o,r){O(o,e,r),l||(s=$(e,"click",n[70]),l=!0)},p:we,d(o){o&&h(e),l=!1,s()}}}function go(n){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',s,o;return{c(){e=E("div"),t=E("button"),t.innerHTML=l,this.h()},l(r){e=I(r,"DIV",{class:!0});var i=k(e);t=I(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-5uu99u"&&(t.innerHTML=l),i.forEach(h),this.h()},h(){f(t,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"),f(e,"class","flex items-center mb-1.5")},m(r,i){O(r,e,i),v(e,t),s||(o=$(t,"click",n[72]),s=!0)},p:we,i:we,o:we,d(r){r&&h(e),s=!1,o()}}}function _o(n){let e,t,l,s;const o=[vo,po],r=[];function i(a,u){return a[1]===""?0:1}return e=i(n),t=r[e]=o[e](n),{c(){t.c(),l=Fe()},l(a){t.l(a),l=Fe()},m(a,u){r[e].m(a,u),O(a,l,u),s=!0},p(a,u){let c=e;e=i(a),e===c?r[e].p(a,u):(Ue(),z(r[c],1,1,()=>{r[c]=null}),Pe(),t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),H(t,1),t.m(l.parentNode,l))},i(a){s||(H(t),s=!0)},o(a){z(t),s=!1},d(a){a&&h(l),r[e].d(a)}}}function po(n){let e,t,l;return t=new It({props:{content:n[23].t("Send message"),$$slots:{default:[bo]},$$scope:{ctx:n}}}),{c(){e=E("div"),oe(t.$$.fragment),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);ie(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","flex items-center mb-1")},m(s,o){O(s,e,o),ae(t,e,null),l=!0},p(s,o){const r={};o[0]&8388608&&(r.content=s[23].t("Send message")),o[0]&2|o[2]&32768&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),ce(t)}}}function vo(n){let e,t,l;return t=new It({props:{content:n[23].t("Call"),$$slots:{default:[wo]},$$scope:{ctx:n}}}),{c(){e=E("div"),oe(t.$$.fragment),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);ie(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","flex items-center mb-1")},m(s,o){O(s,e,o),ae(t,e,null),l=!0},p(s,o){const r={};o[0]&8388608&&(r.content=s[23].t("Call")),o[0]&545259776|o[2]&32768&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),ce(t)}}}function bo(n){let e,t,l,s,o;return{c(){e=E("button"),t=ve("svg"),l=ve("path"),this.h()},l(r){e=I(r,"BUTTON",{id:!0,class:!0,type:!0});var i=k(e);t=be(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=k(t);l=be(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),k(l).forEach(h),a.forEach(h),i.forEach(h),this.h()},h(){f(l,"fill-rule","evenodd"),f(l,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),f(l,"clip-rule","evenodd"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 16 16"),f(t,"fill","currentColor"),f(t,"class","size-6"),f(e,"id","send-message-button"),f(e,"class",s=(n[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 m-0.5 self-center"),f(e,"type","submit"),e.disabled=o=n[1]===""},m(r,i){O(r,e,i),v(e,t),v(t,l)},p(r,i){i[0]&2&&s!==(s=(r[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 m-0.5 self-center")&&f(e,"class",s),i[0]&2&&o!==(o=r[1]==="")&&(e.disabled=o)},d(r){r&&h(e)}}}function wo(n){let e,t,l,s,o;return t=new Xr({props:{className:"size-6"}}),{c(){e=E("button"),oe(t.$$.fragment),this.h()},l(r){e=I(r,"BUTTON",{class:!0,type:!0});var i=k(e);ie(t.$$.fragment,i),i.forEach(h),this.h()},h(){f(e,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-2 self-center"),f(e,"type","button")},m(r,i){O(r,e,i),ae(t,e,null),l=!0,s||(o=$(e,"click",n[71]),s=!0)},p:we,i(r){l||(H(t.$$.fragment,r),l=!0)},o(r){z(t.$$.fragment,r),l=!1},d(r){r&&h(e),ce(t),s=!1,o()}}}function ko(n){let e,t,l,s,o,r,i,a,u,c,d,m,b,S,g,_,p,w,C,D,N,T,A,V,W,j,U=n[23].t("LLMs can make mistakes. Verify important information.")+"",F,re,le,R,M=n[19]&&sn(n),B=n[2]===!1&&n[10].length>0&&rn(n);const ee=[no,lo],ne=[];function fe(P,Y){return Y[0]&2&&(a=null),Y[0]&2&&(u=null),a==null&&(a=P[1].charAt(0)==="/"),a?0:(u==null&&(u=P[1].charAt(0)==="#"),u?1:-1)}~(c=fe(n,[-1,-1,-1]))&&(d=ne[c]=ee[c](n));function Be(P){n[45](P)}function Ge(P){n[46](P)}let $e={messages:n[10]};n[1]!==void 0&&($e.prompt=n[1]),n[21]!==void 0&&($e.chatInputPlaceholder=n[21]),b=new Dr({props:$e}),n[44](b),ke.push(()=>Oe(b,"prompt",Be)),ke.push(()=>Oe(b,"chatInputPlaceholder",Ge)),b.$on("select",n[47]);let Ie=n[0]!==void 0&&on(n);const Z=[ro,so],et=[];function st(P,Y){return P[13]?0:1}return A=st(n),V=et[A]=Z[A](n),{c(){M&&M.c(),e=J(),t=E("div"),l=E("div"),s=E("div"),o=E("div"),B&&B.c(),r=J(),i=E("div"),d&&d.c(),m=J(),oe(b.$$.fragment),_=J(),Ie&&Ie.c(),p=J(),w=E("div"),C=E("div"),D=E("div"),N=E("input"),T=J(),V.c(),W=J(),j=E("div"),F=ge(U),this.h()},l(P){M&&M.l(P),e=Q(P),t=I(P,"DIV",{class:!0});var Y=k(t);l=I(Y,"DIV",{class:!0});var Ne=k(l);s=I(Ne,"DIV",{class:!0});var Le=k(s);o=I(Le,"DIV",{class:!0});var ze=k(o);B&&B.l(ze),ze.forEach(h),r=Q(Le),i=I(Le,"DIV",{class:!0});var Je=k(i);d&&d.l(Je),m=Q(Je),ie(b.$$.fragment,Je),_=Q(Je),Ie&&Ie.l(Je),Je.forEach(h),Le.forEach(h),Ne.forEach(h),p=Q(Y),w=I(Y,"DIV",{class:!0});var Mt=k(w);C=I(Mt,"DIV",{class:!0});var Tt=k(C);D=I(Tt,"DIV",{class:!0});var at=k(D);N=I(at,"INPUT",{type:!0}),T=Q(at),V.l(at),W=Q(at),j=I(at,"DIV",{class:!0});var Ct=k(j);F=_e(Ct,U),Ct.forEach(h),at.forEach(h),Tt.forEach(h),Mt.forEach(h),Y.forEach(h),this.h()},h(){f(o,"class","relative"),f(i,"class","w-full relative"),f(s,"class","flex flex-col max-w-6xl px-2.5 md:px-6 w-full"),f(l,"class","-mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center"),f(N,"type","file"),N.hidden=!0,N.multiple=!0,f(j,"class","mt-1.5 text-xs text-gray-500 text-center line-clamp-1"),f(D,"class","pb-2"),f(C,"class","max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0"),f(w,"class","bg-white dark:bg-gray-900"),f(t,"class","w-full")},m(P,Y){M&&M.m(P,Y),O(P,e,Y),O(P,t,Y),v(t,l),v(l,s),v(s,o),B&&B.m(o,null),v(s,r),v(s,i),~c&&ne[c].m(i,null),v(i,m),ae(b,i,null),v(i,_),Ie&&Ie.m(i,null),v(t,p),v(t,w),v(w,C),v(C,D),v(D,N),n[50](N),v(D,T),et[A].m(D,null),v(D,W),v(D,j),v(j,F),re=!0,le||(R=[$(N,"change",n[51]),$(N,"change",n[52])],le=!0)},p(P,Y){P[19]?M?(M.p(P,Y),Y[0]&524288&&H(M,1)):(M=sn(P),M.c(),H(M,1),M.m(e.parentNode,e)):M&&(Ue(),z(M,1,1,()=>{M=null}),Pe()),P[2]===!1&&P[10].length>0?B?B.p(P,Y):(B=rn(P),B.c(),B.m(o,null)):B&&(B.d(1),B=null);let Ne=c;c=fe(P,Y),c===Ne?~c&&ne[c].p(P,Y):(d&&(Ue(),z(ne[Ne],1,1,()=>{ne[Ne]=null}),Pe()),~c?(d=ne[c],d?d.p(P,Y):(d=ne[c]=ee[c](P),d.c()),H(d,1),d.m(i,m)):d=null);const Le={};Y[0]&1024&&(Le.messages=P[10]),!S&&Y[0]&2&&(S=!0,Le.prompt=P[1],He(()=>S=!1)),!g&&Y[0]&2097152&&(g=!0,Le.chatInputPlaceholder=P[21],He(()=>g=!1)),b.$set(Le),P[0]!==void 0?Ie?(Ie.p(P,Y),Y[0]&1&&H(Ie,1)):(Ie=on(P),Ie.c(),H(Ie,1),Ie.m(i,null)):Ie&&(Ue(),z(Ie,1,1,()=>{Ie=null}),Pe());let ze=A;A=st(P),A===ze?et[A].p(P,Y):(Ue(),z(et[ze],1,1,()=>{et[ze]=null}),Pe(),V=et[A],V?V.p(P,Y):(V=et[A]=Z[A](P),V.c()),H(V,1),V.m(D,W)),(!re||Y[0]&8388608)&&U!==(U=P[23].t("LLMs can make mistakes. Verify important information.")+"")&&Se(F,U)},i(P){re||(H(M),H(d),H(b.$$.fragment,P),H(Ie),H(V),re=!0)},o(P){z(M),z(d),z(b.$$.fragment,P),z(Ie),z(V),re=!1},d(P){P&&(h(e),h(t)),M&&M.d(P),B&&B.d(),~c&&ne[c].d(),n[44](null),ce(b),Ie&&Ie.d(),n[50](null),et[A].d(),le=!1,gt(R)}}}function yo(n,e,t){let l,s,o,r,i,a,u,c;ue(n,ll,y=>t(12,s=y)),ue(n,Kt,y=>t(24,o=y)),ue(n,kt,y=>t(25,r=y)),ue(n,Zn,y=>t(26,i=y)),ue(n,al,y=>t(27,a=y)),ue(n,Bn,y=>t(28,u=y)),ue(n,Jt,y=>t(29,c=y));const d=_t("i18n");ue(n,d,y=>t(23,l=y));let{submitPrompt:m}=e,{stopResponse:b}=e,{autoScroll:S=!0}=e,{atSelectedModel:g}=e,{selectedModels:_}=e,p=!1,w,C,D,N,T,A,V=!1,W=null,j="",{files:U=[]}=e,{availableToolIds:F=[]}=e,{selectedToolIds:re=[]}=e,{webSearchEnabled:le=!1}=e,{prompt:R=""}=e,{messages:M=[]}=e,B=[];const ee=()=>{const y=document.getElementById("messages-container");y.scrollTop=y.scrollHeight},ne=async y=>{console.log(y);const K={type:"doc",name:y.name,collection_name:"",upload_status:!1,error:""};try{if(t(3,U=[...U,K]),["audio/mpeg","audio/wav"].includes(y.type)){const se=await dl(localStorage.token,y).catch(De=>(Ee.error(De),null));if(se){console.log(se);const De=new Blob([se.text],{type:"text/plain"});y=cl(De,`${y.name}.txt`)}}const te=await ss(localStorage.token,"",y);te&&(K.upload_status=!0,K.collection_name=te.collection_name,t(3,U))}catch(te){t(3,U=U.filter(se=>se.name!==y.name)),Ee.error(te)}},fe=async y=>{console.log(y);const K={type:"doc",name:y,collection_name:"",upload_status:!1,url:y,error:""};try{t(3,U=[...U,K]);const te=await rs(localStorage.token,"",y);te&&(K.upload_status=!0,K.collection_name=te.collection_name,t(3,U))}catch(te){t(3,U=U.filter(se=>se.name!==y)),Ee.error(te)}},Be=async y=>{console.log(y);const K={type:"doc",name:y,collection_name:"",upload_status:!1,url:y,error:""};try{t(3,U=[...U,K]);const te=await os(localStorage.token,y);te&&(K.upload_status=!0,K.collection_name=te.collection_name,t(3,U))}catch(te){t(3,U=U.filter(se=>se.name!==y)),Ee.error(te)}};tl(()=>{window.setTimeout(()=>w==null?void 0:w.focus(),0);const y=document.querySelector("body"),K=Ze=>{Ze.key==="Escape"&&(console.log("Escape"),t(19,V=!1))},te=Ze=>{Ze.preventDefault(),t(19,V=!0)},se=()=>{t(19,V=!1)},De=async Ze=>{var pt,it;if(Ze.preventDefault(),console.log(Ze),(pt=Ze.dataTransfer)!=null&&pt.files){const vt=Array.from((it=Ze.dataTransfer)==null?void 0:it.files);vt&&vt.length>0?vt.forEach(tt=>{if(console.log(tt,tt.name.split(".").at(-1)),["image/gif","image/webp","image/jpeg","image/png"].includes(tt.type)){if(B.length===0){Ee.error(l.t("Selected model(s) do not support image inputs"));return}let bt=new FileReader;bt.onload=wt=>{t(3,U=[...U,{type:"image",url:`${wt.target.result}`}])},bt.readAsDataURL(tt)}else pl.includes(tt.type)||vl.includes(tt.name.split(".").at(-1))||Ee.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:tt.type})),ne(tt)}):Ee.error(l.t("File not found."))}t(19,V=!1)};return window.addEventListener("keydown",K),y==null||y.addEventListener("dragover",te),y==null||y.addEventListener("drop",De),y==null||y.addEventListener("dragleave",se),()=>{window.removeEventListener("keydown",K),y==null||y.removeEventListener("dragover",te),y==null||y.removeEventListener("drop",De),y==null||y.removeEventListener("dragleave",se)}});const Ge=()=>{t(2,S=!0),ee()};function $e(y){ke[y?"unshift":"push"](()=>{D=y,t(15,D)})}function Ie(y){R=y,t(1,R)}function Z(y){U=y,t(3,U)}function et(y){ke[y?"unshift":"push"](()=>{N=y,t(16,N)})}function st(y){R=y,t(1,R)}const P=y=>{console.log(y),Be(y.detail)},Y=y=>{console.log(y),fe(y.detail)},Ne=y=>{var K;console.log(y),t(3,U=[...U,{type:((K=y==null?void 0:y.detail)==null?void 0:K.type)??"doc",...y.detail,upload_status:!0}])};function Le(y){ke[y?"unshift":"push"](()=>{T=y,t(17,T)})}function ze(y){R=y,t(1,R)}function Je(y){j=y,t(21,j)}const Mt=y=>{t(0,g=y.detail),w==null||w.focus()},Tt=y=>y.id===g.id,at=()=>{t(0,g=void 0)};function Ct(y){ke[y?"unshift":"push"](()=>{C=y,t(14,C)})}function Pt(){A=this.files,t(18,A)}const zt=async()=>{A&&A.length>0?Array.from(A).forEach(K=>{if(["image/gif","image/webp","image/jpeg","image/png"].includes(K.type)){if(B.length===0){Ee.error(l.t("Selected model(s) do not support image inputs")),t(18,A=null),t(14,C.value="",C);return}let te=new FileReader;te.onload=se=>{t(3,U=[...U,{type:"image",url:`${se.target.result}`}]),t(18,A=null),t(14,C.value="",C)},te.readAsDataURL(K)}else pl.includes(K.type)||vl.includes(K.name.split(".").at(-1))?(ne(K),t(14,C.value="",C)):(Ee.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:K.type})),ne(K),t(14,C.value="",C))}):Ee.error(l.t("File not found."))};function Rt(y){p=y,t(13,p)}const jt=async()=>{var y;t(13,p=!1),await Me(),(y=document.getElementById("chat-textarea"))==null||y.focus()},G=async y=>{var te;const K=y.detail;t(1,R=`${R}${K} `),t(13,p=!1),await Me(),(te=document.getElementById("chat-textarea"))==null||te.focus(),((r==null?void 0:r.speechAutoSend)??!1)&&m(R)},ye=y=>!B.includes(y),de=y=>{U.splice(y,1),t(3,U)},he=(y,K,te,se)=>((F.includes(K.id)||((a==null?void 0:a.role)??"user")==="admin")&&(y[K.id]={name:K.name,description:K.meta.description,enabled:!1}),y),Ae=()=>{C.click()},qe=async()=>{await Me(),w==null||w.focus()};function rt(y){le=y,t(5,le)}function ot(y){re=y,t(4,re)}function Vt(y){ke[y?"unshift":"push"](()=>{w=y,t(11,w),t(1,R)})}function St(){R=this.value,t(1,R)}const Bt=y=>{(!u||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))&&(y.key==="Enter"&&!y.shiftKey&&y.preventDefault(),R!==""&&y.key==="Enter"&&!y.shiftKey&&m(R))},Ft=async y=>{var te;const K=y.ctrlKey||y.metaKey;if(R===""&&K&&y.key.toLowerCase()==="r"){y.preventDefault(),console.log("regenerate");const se=[...document.getElementsByClassName("regenerate-response-button")].at(-1);se==null||se.click()}if(R===""&&y.key=="ArrowUp"){y.preventDefault();const se=[...document.getElementsByClassName("user-message")].at(-1),De=[...document.getElementsByClassName("edit-user-message-button")].at(-1);console.log(se),se.scrollIntoView({block:"center"}),De==null||De.click()}if(["/","#","@"].includes(R.charAt(0))&&y.key==="ArrowUp"&&(y.preventDefault(),(D||N||T).selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(R.charAt(0))&&y.key==="ArrowDown"&&(y.preventDefault(),(D||N||T).selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(R.charAt(0))&&y.key==="Enter"){y.preventDefault();const se=[...document.getElementsByClassName("selected-command-option-button")].at(-1);y.shiftKey?t(1,R=`${R}
`):se?se==null||se.click():(te=document.getElementById("send-message-button"))==null||te.click()}if(["/","#","@"].includes(R.charAt(0))&&y.key==="Tab"){y.preventDefault();const se=[...document.getElementsByClassName("selected-command-option-button")].at(-1);se==null||se.click()}else if(y.key==="Tab"){const se=Ln(R);if(se.length>0){const De=se.at(0),Ze=R;t(1,R=R.substring(0,(De==null?void 0:De.endIndex)+1)),await Me(),y.target.scrollTop=y.target.scrollHeight,t(1,R=Ze),await Me(),y.preventDefault(),y.target.setSelectionRange(De==null?void 0:De.startIndex,De.endIndex+1)}y.target.style.height="",y.target.style.height=Math.min(y.target.scrollHeight,200)+"px"}y.key==="Escape"&&(console.log("Escape"),t(0,g=void 0))},L=y=>{y.target.style.height="",y.target.style.height=Math.min(y.target.scrollHeight,200)+"px",t(20,W=null)},X=y=>{y.target.style.height="",y.target.style.height=Math.min(y.target.scrollHeight,200)+"px"},me=y=>{const K=y.clipboardData||window.clipboardData;if(K&&K.items){for(const te of K.items)if(te.type.indexOf("image")!==-1){const se=te.getAsFile(),De=new FileReader;De.onload=function(Ze){t(3,U=[...U,{type:"image",url:`${Ze.target.result}`}])},De.readAsDataURL(se)}}},x=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function(K){return Ee.error(l.t("Permission denied when accessing microphone: {{error}}",{error:K})),null})&&t(13,p=!0)}catch{Ee.error(l.t("Permission denied when accessing microphone"))}},Ve=async()=>{if(_.length>1){Ee.error(l.t("Select only one model to call"));return}if(c.audio.stt.engine==="web"){Ee.error(l.t("Call feature is not supported when using Web STT engine"));return}try{await navigator.mediaDevices.getUserMedia({audio:!0}),$t.set(!0)}catch{Ee.error(l.t("Permission denied when accessing media devices"))}},q=()=>{b()},Re=()=>{m(R)};return n.$$set=y=>{"submitPrompt"in y&&t(6,m=y.submitPrompt),"stopResponse"in y&&t(7,b=y.stopResponse),"autoScroll"in y&&t(2,S=y.autoScroll),"atSelectedModel"in y&&t(0,g=y.atSelectedModel),"selectedModels"in y&&t(8,_=y.selectedModels),"files"in y&&t(3,U=y.files),"availableToolIds"in y&&t(9,F=y.availableToolIds),"selectedToolIds"in y&&t(4,re=y.selectedToolIds),"webSearchEnabled"in y&&t(5,le=y.webSearchEnabled),"prompt"in y&&t(1,R=y.prompt),"messages"in y&&t(10,M=y.messages)},n.$$.update=()=>{n.$$.dirty[0]&4353&&t(22,B=[...g?[g]:_].filter(y=>{var K,te,se,De;return((De=(se=(te=(K=s.find(Ze=>Ze.id===y))==null?void 0:K.info)==null?void 0:te.meta)==null?void 0:se.capabilities)==null?void 0:De.vision)??!0})),n.$$.dirty[0]&2050&&R&&w&&(t(11,w.style.height="",w),t(11,w.style.height=Math.min(w.scrollHeight,200)+"px",w))},[g,R,S,U,re,le,m,b,_,F,M,w,s,p,C,D,N,T,A,V,W,j,B,l,o,r,i,a,u,c,d,ee,ne,fe,Be,Ge,$e,Ie,Z,et,st,P,Y,Ne,Le,ze,Je,Mt,Tt,at,Ct,Pt,zt,Rt,jt,G,ye,de,he,Ae,qe,rt,ot,Vt,St,Bt,Ft,L,X,me,x,Ve,q,Re]}class Eo extends Ke{constructor(e){super(),xe(this,e,yo,ko,Xe,{submitPrompt:6,stopResponse:7,autoScroll:2,atSelectedModel:0,selectedModels:8,files:3,availableToolIds:9,selectedToolIds:4,webSearchEnabled:5,prompt:1,messages:10},null,[-1,-1,-1])}}function dn(n,e,t){const l=n.slice();return l[12]=e[t],l[13]=e,l[14]=t,l}function Io(n){let e,t,l;return t=new It({props:{content:n[4].t("Remove Model"),$$slots:{default:[Do]},$$scope:{ctx:n}}}),{c(){e=E("div"),oe(t.$$.fragment),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);ie(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2")},m(s,o){O(s,e,o),ae(t,e,null),l=!0},p(s,o){const r={};o&16&&(r.content=s[4].t("Remove Model")),o&32771&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),ce(t)}}}function So(n){let e,t,l;return t=new It({props:{content:n[4].t("Add Model"),$$slots:{default:[Mo]},$$scope:{ctx:n}}}),{c(){e=E("div"),oe(t.$$.fragment),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);ie(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","self-center mr-2 disabled:text-gray-600 disabled:hover:text-gray-600")},m(s,o){O(s,e,o),ae(t,e,null),l=!0},p(s,o){const r={};o&16&&(r.content=s[4].t("Add Model")),o&32771&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),ce(t)}}}function Do(n){let e,t,l,s,o;function r(){return n[10](n[14])}return{c(){e=E("button"),t=ve("svg"),l=ve("path"),this.h()},l(i){e=I(i,"BUTTON",{});var a=k(e);t=be(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var u=k(t);l=be(u,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),k(l).forEach(h),u.forEach(h),a.forEach(h),this.h()},h(){f(l,"stroke-linecap","round"),f(l,"stroke-linejoin","round"),f(l,"d","M19.5 12h-15"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","2"),f(t,"stroke","currentColor"),f(t,"class","size-3.5"),e.disabled=n[1]},m(i,a){O(i,e,a),v(e,t),v(t,l),s||(o=$(e,"click",r),s=!0)},p(i,a){n=i,a&2&&(e.disabled=n[1])},d(i){i&&h(e),s=!1,o()}}}function Mo(n){let e,t,l,s,o;return{c(){e=E("button"),t=ve("svg"),l=ve("path"),this.h()},l(r){e=I(r,"BUTTON",{class:!0});var i=k(e);t=be(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=k(t);l=be(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),k(l).forEach(h),a.forEach(h),i.forEach(h),this.h()},h(){f(l,"stroke-linecap","round"),f(l,"stroke-linejoin","round"),f(l,"d","M12 6v12m6-6H6"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","2"),f(t,"stroke","currentColor"),f(t,"class","size-3.5"),f(e,"class",""),e.disabled=n[1]},m(r,i){O(r,e,i),v(e,t),v(t,l),s||(o=$(e,"click",n[9]),s=!0)},p(r,i){i&2&&(e.disabled=r[1])},d(r){r&&h(e),s=!1,o()}}}function hn(n){let e,t,l,s,o,r,i,a,u,c;function d(_){n[8](_,n[12],n[13],n[14])}let m={placeholder:n[4].t("Select a model"),items:n[3].map(gn)};n[12]!==void 0&&(m.value=n[12]),s=new Es({props:m}),ke.push(()=>Oe(s,"value",d));const b=[So,Io],S=[];function g(_,p){return _[14]===0?0:1}return i=g(n),a=S[i]=b[i](n),{c(){e=E("div"),t=E("div"),l=E("div"),oe(s.$$.fragment),r=J(),a.c(),u=J(),this.h()},l(_){e=I(_,"DIV",{class:!0});var p=k(e);t=I(p,"DIV",{class:!0});var w=k(t);l=I(w,"DIV",{class:!0});var C=k(l);ie(s.$$.fragment,C),C.forEach(h),w.forEach(h),r=Q(p),a.l(p),u=Q(p),p.forEach(h),this.h()},h(){f(l,"class","mr-1 max-w-full"),f(t,"class","overflow-hidden w-full"),f(e,"class","flex w-full max-w-fit")},m(_,p){O(_,e,p),v(e,t),v(t,l),ae(s,l,null),v(e,r),S[i].m(e,null),v(e,u),c=!0},p(_,p){n=_;const w={};p&16&&(w.placeholder=n[4].t("Select a model")),p&8&&(w.items=n[3].map(gn)),!o&&p&1&&(o=!0,w.value=n[12],He(()=>o=!1)),s.$set(w),a.p(n,p)},i(_){c||(H(s.$$.fragment,_),H(a),c=!0)},o(_){z(s.$$.fragment,_),z(a),c=!1},d(_){_&&h(e),ce(s),S[i].d()}}}function mn(n){let e,t,l=n[4].t("Set as default")+"",s,o,r;return{c(){e=E("div"),t=E("button"),s=ge(l),this.h()},l(i){e=I(i,"DIV",{class:!0});var a=k(e);t=I(a,"BUTTON",{});var u=k(t);s=_e(u,l),u.forEach(h),a.forEach(h),this.h()},h(){f(e,"class","text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500")},m(i,a){O(i,e,a),v(e,t),v(t,s),o||(r=$(t,"click",n[7]),o=!0)},p(i,a){a&16&&l!==(l=i[4].t("Set as default")+"")&&Se(s,l)},d(i){i&&h(e),o=!1,r()}}}function To(n){let e,t,l,s,o=nt(n[0]),r=[];for(let u=0;u<o.length;u+=1)r[u]=hn(dn(n,o,u));const i=u=>z(r[u],1,1,()=>{r[u]=null});let a=n[2]&&!n[5]&&mn(n);return{c(){e=E("div");for(let u=0;u<r.length;u+=1)r[u].c();t=J(),a&&a.c(),l=Fe(),this.h()},l(u){e=I(u,"DIV",{class:!0});var c=k(e);for(let d=0;d<r.length;d+=1)r[d].l(c);c.forEach(h),t=Q(u),a&&a.l(u),l=Fe(),this.h()},h(){f(e,"class","flex flex-col w-full items-center md:items-start")},m(u,c){O(u,e,c);for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(e,null);O(u,t,c),a&&a.m(u,c),O(u,l,c),s=!0},p(u,[c]){if(c&27){o=nt(u[0]);let d;for(d=0;d<o.length;d+=1){const m=dn(u,o,d);r[d]?(r[d].p(m,c),H(r[d],1)):(r[d]=hn(m),r[d].c(),H(r[d],1),r[d].m(e,null))}for(Ue(),d=o.length;d<r.length;d+=1)i(d);Pe()}u[2]&&!u[5]?a?a.p(u,c):(a=mn(u),a.c(),a.m(l.parentNode,l)):a&&(a.d(1),a=null)},i(u){if(!s){for(let c=0;c<o.length;c+=1)H(r[c]);s=!0}},o(u){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)z(r[c]);s=!1},d(u){u&&(h(e),h(t),h(l)),Dt(r,u),a&&a.d(u)}}}const gn=n=>({value:n.id,label:n.name,model:n});function Co(n,e,t){let l,s,o,r;ue(n,ll,g=>t(3,l=g)),ue(n,kt,g=>t(11,o=g)),ue(n,Bn,g=>t(5,r=g));const i=_t("i18n");ue(n,i,g=>t(4,s=g));let{selectedModels:a=[""]}=e,{disabled:u=!1}=e,{showSetDefault:c=!0}=e;const d=async()=>{if(a.filter(_=>_==="").length){Ee.error(s.t("Choose a model before saving..."));return}kt.set({...o,models:a}),await $n(localStorage.token,{ui:o}),Ee.success(s.t("Default model updated"))};function m(g,_,p,w){p[w]=g,t(0,a),t(3,l)}const b=()=>{t(0,a=[...a,""])},S=g=>{a.splice(g,1),t(0,a),t(3,l)};return n.$$set=g=>{"selectedModels"in g&&t(0,a=g.selectedModels),"disabled"in g&&t(1,u=g.disabled),"showSetDefault"in g&&t(2,c=g.showSetDefault)},n.$$.update=()=>{n.$$.dirty&9&&a.length>0&&l.length>0&&t(0,a=a.map(g=>l.map(_=>_.id).includes(g)?g:""))},[a,u,c,l,s,r,i,d,m,b,S]}class Vo extends Ke{constructor(e){super(),xe(this,e,Co,To,Xe,{selectedModels:0,disabled:1,showSetDefault:2})}}function Bo(n){let e;const t=n[10].default,l=ft(t,n,n[16],null);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&65536)&&dt(l,t,s,s[16],e?mt(t,s[16],o,null):ht(s[16]),null)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function No(n){let e,t,l,s,o=n[3].t("Share")+"",r;return{c(){e=ve("svg"),t=ve("path"),l=J(),s=E("div"),r=ge(o),this.h()},l(i){e=be(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=k(e);t=be(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),k(t).forEach(h),a.forEach(h),l=Q(i),s=I(i,"DIV",{class:!0});var u=k(s);r=_e(u,o),u.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","size-4"),f(s,"class","flex items-center")},m(i,a){O(i,e,a),v(e,t),O(i,l,a),O(i,s,a),v(s,r)},p(i,a){a&8&&o!==(o=i[3].t("Share")+"")&&Se(r,o)},d(i){i&&(h(e),h(l),h(s))}}}function Lo(n){let e,t,l,s,o=n[3].t("Download")+"",r;return{c(){e=ve("svg"),t=ve("path"),l=J(),s=E("div"),r=ge(o),this.h()},l(i){e=be(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=k(e);t=be(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),k(t).forEach(h),a.forEach(h),l=Q(i),s=I(i,"DIV",{class:!0});var u=k(s);r=_e(u,o),u.forEach(h),this.h()},h(){f(t,"stroke-linecap","round"),f(t,"stroke-linejoin","round"),f(t,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width","1.5"),f(e,"stroke","currentColor"),f(e,"class","size-4"),f(s,"class","flex items-center")},m(i,a){O(i,e,a),v(e,t),O(i,l,a),O(i,s,a),v(s,r)},p(i,a){a&8&&o!==(o=i[3].t("Download")+"")&&Se(r,o)},d(i){i&&(h(e),h(l),h(s))}}}function Ao(n){let e,t=n[3].t("Export chat (.json)")+"",l;return{c(){e=E("div"),l=ge(t),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);l=_e(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(s,o){O(s,e,o),v(e,l)},p(s,o){o&8&&t!==(t=s[3].t("Export chat (.json)")+"")&&Se(l,t)},d(s){s&&h(e)}}}function Ho(n){let e,t=n[3].t("Plain text (.txt)")+"",l;return{c(){e=E("div"),l=ge(t),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);l=_e(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(s,o){O(s,e,o),v(e,l)},p(s,o){o&8&&t!==(t=s[3].t("Plain text (.txt)")+"")&&Se(l,t)},d(s){s&&h(e)}}}function Oo(n){let e,t=n[3].t("PDF document (.pdf)")+"",l;return{c(){e=E("div"),l=ge(t),this.h()},l(s){e=I(s,"DIV",{class:!0});var o=k(e);l=_e(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(s,o){O(s,e,o),v(e,l)},p(s,o){o&8&&t!==(t=s[3].t("PDF document (.pdf)")+"")&&Se(l,t)},d(s){s&&h(e)}}}function Uo(n){let e,t,l,s,o,r;return e=new Ht({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Ao]},$$scope:{ctx:n}}}),e.$on("click",n[12]),l=new Ht({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Ho]},$$scope:{ctx:n}}}),l.$on("click",n[13]),o=new Ht({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Oo]},$$scope:{ctx:n}}}),o.$on("click",n[14]),{c(){oe(e.$$.fragment),t=J(),oe(l.$$.fragment),s=J(),oe(o.$$.fragment)},l(i){ie(e.$$.fragment,i),t=Q(i),ie(l.$$.fragment,i),s=Q(i),ie(o.$$.fragment,i)},m(i,a){ae(e,i,a),O(i,t,a),ae(l,i,a),O(i,s,a),ae(o,i,a),r=!0},p(i,a){const u={};a&65544&&(u.$$scope={dirty:a,ctx:i}),e.$set(u);const c={};a&65544&&(c.$$scope={dirty:a,ctx:i}),l.$set(c);const d={};a&65544&&(d.$$scope={dirty:a,ctx:i}),o.$set(d)},i(i){r||(H(e.$$.fragment,i),H(l.$$.fragment,i),H(o.$$.fragment,i),r=!0)},o(i){z(e.$$.fragment,i),z(l.$$.fragment,i),z(o.$$.fragment,i),r=!1},d(i){i&&(h(t),h(s)),ce(e,i),ce(l,i),ce(o,i)}}}function Po(n){let e,t,l,s;return e=new $s({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Lo]},$$scope:{ctx:n}}}),l=new Gs({props:{class:"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:nl,sideOffset:8,$$slots:{default:[Uo]},$$scope:{ctx:n}}}),{c(){oe(e.$$.fragment),t=J(),oe(l.$$.fragment)},l(o){ie(e.$$.fragment,o),t=Q(o),ie(l.$$.fragment,o)},m(o,r){ae(e,o,r),O(o,t,r),ae(l,o,r),s=!0},p(o,r){const i={};r&65544&&(i.$$scope={dirty:r,ctx:o}),e.$set(i);const a={};r&65544&&(a.$$scope={dirty:r,ctx:o}),l.$set(a)},i(o){s||(H(e.$$.fragment,o),H(l.$$.fragment,o),s=!0)},o(o){z(e.$$.fragment,o),z(l.$$.fragment,o),s=!1},d(o){o&&h(t),ce(e,o),ce(l,o)}}}function zo(n){let e,t,l,s,o,r,i,a,u;return e=new Ht({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[No]},$$scope:{ctx:n}}}),e.$on("click",n[11]),l=new Bs({props:{$$slots:{default:[Po]},$$scope:{ctx:n}}}),a=new as({props:{chatId:n[1].id}}),{c(){oe(e.$$.fragment),t=J(),oe(l.$$.fragment),s=J(),o=E("hr"),r=J(),i=E("div"),oe(a.$$.fragment),this.h()},l(c){ie(e.$$.fragment,c),t=Q(c),ie(l.$$.fragment,c),s=Q(c),o=I(c,"HR",{class:!0}),r=Q(c),i=I(c,"DIV",{class:!0});var d=k(i);ie(a.$$.fragment,d),d.forEach(h),this.h()},h(){f(o,"class","border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5"),f(i,"class","flex p-1")},m(c,d){ae(e,c,d),O(c,t,d),ae(l,c,d),O(c,s,d),O(c,o,d),O(c,r,d),O(c,i,d),ae(a,i,null),u=!0},p(c,d){const m={};d&65544&&(m.$$scope={dirty:d,ctx:c}),e.$set(m);const b={};d&65544&&(b.$$scope={dirty:d,ctx:c}),l.$set(b);const S={};d&2&&(S.chatId=c[1].id),a.$set(S)},i(c){u||(H(e.$$.fragment,c),H(l.$$.fragment,c),H(a.$$.fragment,c),u=!0)},o(c){z(e.$$.fragment,c),z(l.$$.fragment,c),z(a.$$.fragment,c),u=!1},d(c){c&&(h(t),h(s),h(o),h(r),h(i)),ce(e,c),ce(l,c),ce(a)}}}function Ro(n){let e,t,l;return t=new fl({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:nl,$$slots:{default:[zo]},$$scope:{ctx:n}}}),{c(){e=E("div"),oe(t.$$.fragment),this.h()},l(s){e=I(s,"DIV",{slot:!0});var o=k(e);ie(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(s,o){O(s,e,o),ae(t,e,null),l=!0},p(s,o){const r={};o&65547&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),ce(t)}}}function jo(n){let e,t;return e=new ul({props:{$$slots:{content:[Ro],default:[Bo]},$$scope:{ctx:n}}}),e.$on("change",n[15]),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,[s]){const o={};s&65547&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function Fo(n,e,t){let l,{$$slots:s={},$$scope:o}=e;const{saveAs:r}=Ss,i=_t("i18n");ue(n,i,N=>t(3,l=N));let{shareEnabled:a=!1}=e,{shareHandler:u}=e,{downloadHandler:c}=e,{chat:d}=e,{onClose:m=()=>{}}=e;const b=async()=>{const N=d.chat;console.log("download",d);const T=N.messages.reduce((V,W,j,U)=>`${V}### ${W.role.toUpperCase()}
${W.content}

`,"");let A=new Blob([T],{type:"text/plain"});r(A,`chat-${N.title}.txt`)},S=async()=>{const N=d.chat;console.log("download",d);const T=await Ds(N),A=window.URL.createObjectURL(T),V=document.createElement("a");V.href=A,V.download=`chat-${N.title}.pdf`,document.body.appendChild(V),V.click(),document.body.removeChild(V),window.URL.revokeObjectURL(A)},g=async()=>{let N=new Blob([JSON.stringify([d])],{type:"application/json"});r(N,`chat-export-${Date.now()}.json`)},_=()=>{u()},p=()=>{g()},w=()=>{b()},C=()=>{S()},D=N=>{N.detail===!1&&m()};return n.$$set=N=>{"shareEnabled"in N&&t(8,a=N.shareEnabled),"shareHandler"in N&&t(0,u=N.shareHandler),"downloadHandler"in N&&t(9,c=N.downloadHandler),"chat"in N&&t(1,d=N.chat),"onClose"in N&&t(2,m=N.onClose),"$$scope"in N&&t(16,o=N.$$scope)},[u,d,m,l,i,b,S,g,a,c,s,_,p,w,C,D,o]}class qo extends Ke{constructor(e){super(),xe(this,e,Fo,jo,Xe,{shareEnabled:8,shareHandler:0,downloadHandler:9,chat:1,onClose:2})}}function _n(n){let e,t,l;function s(r){n[15](r)}let o={showSetDefault:!n[2]};return n[0]!==void 0&&(o.selectedModels=n[0]),e=new Vo({props:o}),ke.push(()=>Oe(e,"selectedModels",s)),{c(){oe(e.$$.fragment)},l(r){ie(e.$$.fragment,r)},m(r,i){ae(e,r,i),l=!0},p(r,i){const a={};i&4&&(a.showSetDefault=!r[2]),!t&&i&1&&(t=!0,a.selectedModels=r[0],He(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){ce(e,r)}}}function pn(n){let e,t;return e=new qo({props:{chat:n[3],shareEnabled:n[2],shareHandler:n[16],downloadHandler:n[17],$$slots:{default:[Wo]},$$scope:{ctx:n}}}),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s&8&&(o.chat=l[3]),s&4&&(o.shareEnabled=l[2]),s&32&&(o.shareHandler=l[16]),s&64&&(o.downloadHandler=l[17]),s&2097152&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function Wo(n){let e,t='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){e=E("button"),e.innerHTML=t,this.h()},l(l){e=I(l,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-9m6068"&&(e.innerHTML=t),this.h()},h(){f(e,"class","hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(e,"id","chat-context-menu-button")},m(l,s){O(l,e,s)},p:we,d(l){l&&h(e)}}}function Zo(n){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"></path><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"></path></svg>',s,o,r;return{c(){e=E("button"),t=E("div"),t.innerHTML=l,this.h()},l(i){e=I(i,"BUTTON",{id:!0,class:!0});var a=k(e);t=I(a,"DIV",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-1fcii9y"&&(t.innerHTML=l),a.forEach(h),this.h()},h(){f(t,"class","m-auto self-center"),f(e,"id","new-chat-button"),f(e,"class",s="flex "+(n[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")},m(i,a){O(i,e,a),v(e,t),o||(r=$(e,"click",n[18]),o=!0)},p(i,a){a&256&&s!==(s="flex "+(i[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")&&f(e,"class",s)},d(i){i&&h(e),o=!1,r()}}}function vn(n){let e,t;return e=new us({props:{className:"max-w-[200px]",role:n[10].role,$$slots:{default:[Go]},$$scope:{ctx:n}}}),e.$on("show",n[19]),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s&1024&&(o.role=l[10].role),s&2098176&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function Go(n){let e,t,l,s;return{c(){e=E("button"),t=E("div"),l=E("img"),this.h()},l(o){e=I(o,"BUTTON",{class:!0,"aria-label":!0});var r=k(e);t=I(r,"DIV",{class:!0});var i=k(t);l=I(i,"IMG",{src:!0,class:!0,alt:!0,draggable:!0}),i.forEach(h),r.forEach(h),this.h()},h(){At(l.src,s=n[10].profile_image_url)||f(l,"src",s),f(l,"class","size-6 object-cover rounded-full"),f(l,"alt","User profile"),f(l,"draggable","false"),f(t,"class","self-center"),f(e,"class","select-none flex rounded-xl p-1.5 w-full hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(e,"aria-label","User Menu")},m(o,r){O(o,e,r),v(e,t),v(t,l)},p(o,r){r&1024&&!At(l.src,s=o[10].profile_image_url)&&f(l,"src",s)},d(o){o&&h(e)}}}function Jo(n){let e,t,l,s,o,r,i,a,u,c,d,m,b,S,g,_,p,w,C,D,N;function T(U){n[13](U)}let A={chatId:n[7]};n[5]!==void 0&&(A.show=n[5]),e=new cs({props:A}),ke.push(()=>Oe(e,"show",T)),c=new Ms({});let V=n[4]&&_n(n),W=n[2]&&n[3]&&n[3].id&&pn(n);p=new It({props:{content:n[9].t("New Chat"),$$slots:{default:[Zo]},$$scope:{ctx:n}}});let j=n[10]!==void 0&&vn(n);return{c(){oe(e.$$.fragment),l=J(),s=E("nav"),o=E("div"),r=E("div"),i=E("div"),a=E("button"),u=E("div"),oe(c.$$.fragment),m=J(),b=E("div"),V&&V.c(),S=J(),g=E("div"),W&&W.c(),_=J(),oe(p.$$.fragment),w=J(),j&&j.c(),this.h()},l(U){ie(e.$$.fragment,U),l=Q(U),s=I(U,"NAV",{id:!0,class:!0});var F=k(s);o=I(F,"DIV",{class:!0});var re=k(o);r=I(re,"DIV",{class:!0});var le=k(r);i=I(le,"DIV",{class:!0});var R=k(i);a=I(R,"BUTTON",{id:!0,class:!0});var M=k(a);u=I(M,"DIV",{class:!0});var B=k(u);ie(c.$$.fragment,B),B.forEach(h),M.forEach(h),R.forEach(h),m=Q(le),b=I(le,"DIV",{class:!0});var ee=k(b);V&&V.l(ee),ee.forEach(h),S=Q(le),g=I(le,"DIV",{class:!0});var ne=k(g);W&&W.l(ne),_=Q(ne),ie(p.$$.fragment,ne),w=Q(ne),j&&j.l(ne),ne.forEach(h),le.forEach(h),re.forEach(h),F.forEach(h),this.h()},h(){f(u,"class","m-auto self-center"),f(a,"id","sidebar-toggle-button"),f(a,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(i,"class",d=(n[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(b,"class","flex-1 overflow-hidden max-w-full"),f(g,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(r,"class","flex items-center w-full max-w-full"),f(o,"class","flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]"),f(s,"id","nav"),f(s,"class","sticky py-2.5 top-0 flex flex-row justify-center z-30")},m(U,F){ae(e,U,F),O(U,l,F),O(U,s,F),v(s,o),v(o,r),v(r,i),v(i,a),v(a,u),ae(c,u,null),v(r,m),v(r,b),V&&V.m(b,null),v(r,S),v(r,g),W&&W.m(g,null),v(g,_),ae(p,g,null),v(g,w),j&&j.m(g,null),C=!0,D||(N=$(a,"click",n[14]),D=!0)},p(U,[F]){const re={};F&128&&(re.chatId=U[7]),!t&&F&32&&(t=!0,re.show=U[5],He(()=>t=!1)),e.$set(re),(!C||F&256&&d!==(d=(U[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&f(i,"class",d),U[4]?V?(V.p(U,F),F&16&&H(V,1)):(V=_n(U),V.c(),H(V,1),V.m(b,null)):V&&(Ue(),z(V,1,1,()=>{V=null}),Pe()),U[2]&&U[3]&&U[3].id?W?(W.p(U,F),F&12&&H(W,1)):(W=pn(U),W.c(),H(W,1),W.m(g,_)):W&&(Ue(),z(W,1,1,()=>{W=null}),Pe());const le={};F&512&&(le.content=U[9].t("New Chat")),F&2097410&&(le.$$scope={dirty:F,ctx:U}),p.$set(le),U[10]!==void 0?j?(j.p(U,F),F&1024&&H(j,1)):(j=vn(U),j.c(),H(j,1),j.m(g,null)):j&&(Ue(),z(j,1,1,()=>{j=null}),Pe())},i(U){C||(H(e.$$.fragment,U),H(c.$$.fragment,U),H(V),H(W),H(p.$$.fragment,U),H(j),C=!0)},o(U){z(e.$$.fragment,U),z(c.$$.fragment,U),z(V),z(W),z(p.$$.fragment,U),z(j),C=!1},d(U){U&&(h(l),h(s)),ce(e,U),ce(c),V&&V.d(),W&&W.d(),ce(p),j&&j.d(),D=!1,N()}}}function Qo(n,e,t){let l,s,o,r,i;ue(n,Nn,V=>t(20,l=V)),ue(n,Lt,V=>t(7,s=V)),ue(n,Kt,V=>t(8,o=V)),ue(n,al,V=>t(10,i=V));const a=_t("i18n");ue(n,a,V=>t(9,r=V));let{initNewChat:u}=e,{title:c=l}=e,{shareEnabled:d=!1}=e,{chat:m}=e,{selectedModels:b}=e,{showModelSelector:S=!0}=e,g=!1,_=!1;function p(V){g=V,t(5,g)}const w=()=>{Kt.set(!o)};function C(V){b=V,t(0,b)}const D=()=>{t(5,g=!g)},N=()=>{t(6,_=!_)},T=()=>{u()},A=V=>{V.detail==="archived-chat"&&Gn.set(!0)};return n.$$set=V=>{"initNewChat"in V&&t(1,u=V.initNewChat),"title"in V&&t(12,c=V.title),"shareEnabled"in V&&t(2,d=V.shareEnabled),"chat"in V&&t(3,m=V.chat),"selectedModels"in V&&t(0,b=V.selectedModels),"showModelSelector"in V&&t(4,S=V.showModelSelector)},[b,u,d,m,S,g,_,s,o,r,i,a,c,p,w,C,D,N,T,A]}class Yo extends Ke{constructor(e){super(),xe(this,e,Qo,Jo,Xe,{initNewChat:1,title:12,shareEnabled:2,chat:3,selectedModels:0,showModelSelector:4})}}function bn(n,e,t){const l=n.slice();return l[10]=e[t],l}function Xo(n){let e;const t=n[4].default,l=ft(t,n,n[8],null);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&256)&&dt(l,t,s,s[8],e?mt(t,s[8],o,null):ht(s[8]),null)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Ko(n){var r;let e,t,l=(((r=n[10])==null?void 0:r.label)??"Camera")+"",s,o;return{c(){e=E("div"),t=E("div"),s=ge(l),o=J(),this.h()},l(i){e=I(i,"DIV",{class:!0});var a=k(e);t=I(a,"DIV",{class:!0});var u=k(t);s=_e(u,l),u.forEach(h),a.forEach(h),o=Q(i),this.h()},h(){f(t,"class","line-clamp-1"),f(e,"class","flex items-center")},m(i,a){O(i,e,a),v(e,t),v(t,s),O(i,o,a)},p(i,a){var u;a&2&&l!==(l=(((u=i[10])==null?void 0:u.label)??"Camera")+"")&&Se(s,l)},d(i){i&&(h(e),h(o))}}}function wn(n){let e,t;function l(){return n[5](n[10])}return e=new Ht({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Ko]},$$scope:{ctx:n}}}),e.$on("click",l),{c(){oe(e.$$.fragment)},l(s){ie(e.$$.fragment,s)},m(s,o){ae(e,s,o),t=!0},p(s,o){n=s;const r={};o&258&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(s){t||(H(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){ce(e,s)}}}function xo(n){let e,t,l=nt(n[1]),s=[];for(let r=0;r<l.length;r+=1)s[r]=wn(bn(n,l,r));const o=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();e=Fe()},l(r){for(let i=0;i<s.length;i+=1)s[i].l(r);e=Fe()},m(r,i){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,i);O(r,e,i),t=!0},p(r,i){if(i&10){l=nt(r[1]);let a;for(a=0;a<l.length;a+=1){const u=bn(r,l,a);s[a]?(s[a].p(u,i),H(s[a],1)):(s[a]=wn(u),s[a].c(),H(s[a],1),s[a].m(e.parentNode,e))}for(Ue(),a=l.length;a<s.length;a+=1)o(a);Pe()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)H(s[i]);t=!0}},o(r){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)z(s[i]);t=!1},d(r){r&&h(e),Dt(s,r)}}}function $o(n){let e,t,l;return t=new fl({props:{class:"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-[9999] bg-white dark:bg-gray-900 dark:text-white shadow-sm",sideOffset:6,side:"top",align:"start",transition:nl,$$slots:{default:[xo]},$$scope:{ctx:n}}}),{c(){e=E("div"),oe(t.$$.fragment),this.h()},l(s){e=I(s,"DIV",{slot:!0});var o=k(e);ie(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(s,o){O(s,e,o),ae(t,e,null),l=!0},p(s,o){const r={};o&258&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),ce(t)}}}function ei(n){let e,t,l;function s(r){n[6](r)}let o={$$slots:{content:[$o],default:[Xo]},$$scope:{ctx:n}};return n[2]!==void 0&&(o.show=n[2]),e=new ul({props:o}),ke.push(()=>Oe(e,"show",s)),e.$on("change",n[7]),{c(){oe(e.$$.fragment)},l(r){ie(e.$$.fragment,r)},m(r,i){ae(e,r,i),l=!0},p(r,[i]){const a={};i&258&&(a.$$scope={dirty:i,ctx:r}),!t&&i&4&&(t=!0,a.show=r[2],He(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){ce(e,r)}}}function ti(n,e,t){let{$$slots:l={},$$scope:s}=e;_t("i18n");const o=Gt();let{onClose:r=()=>{}}=e,{devices:i}=e,a=!1;const u=m=>{o("change",m.deviceId)};function c(m){a=m,t(2,a)}const d=m=>{m.detail===!1&&r()};return n.$$set=m=>{"onClose"in m&&t(0,r=m.onClose),"devices"in m&&t(1,i=m.devices),"$$scope"in m&&t(8,s=m.$$scope)},[r,i,a,o,l,u,c,d,s]}class li extends Ke{constructor(e){super(),xe(this,e,ti,ei,Xe,{onClose:0,devices:1})}}function kn(n){let e,t,l,s,o,r,i,a,u,c,d,m,b,S,g,_,p,w='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg>',C,D,N,T=n[3]&&yn(n);function A(M,B){return M[3]?oi:ii}let V=A(n),W=V(n);const j=[di,fi],U=[];function F(M,B){return M[3]?0:1}u=F(n),c=U[u]=j[u](n);function re(M,B){return M[0]?pi:M[1]?_i:gi}let le=re(n),R=le(n);return{c(){e=E("div"),t=E("div"),l=E("div"),T&&T.c(),s=J(),o=E("div"),W.c(),r=J(),i=E("div"),a=E("div"),c.c(),d=J(),m=E("div"),b=E("button"),S=E("div"),R.c(),g=J(),_=E("div"),p=E("button"),p.innerHTML=w,this.h()},l(M){e=I(M,"DIV",{class:!0});var B=k(e);t=I(B,"DIV",{class:!0});var ee=k(t);l=I(ee,"DIV",{class:!0});var ne=k(l);T&&T.l(ne),s=Q(ne),o=I(ne,"DIV",{class:!0});var fe=k(o);W.l(fe),fe.forEach(h),r=Q(ne),i=I(ne,"DIV",{class:!0});var Be=k(i);a=I(Be,"DIV",{});var Ge=k(a);c.l(Ge),Ge.forEach(h),d=Q(Be),m=I(Be,"DIV",{});var $e=k(m);b=I($e,"BUTTON",{type:!0});var Ie=k(b);S=I(Ie,"DIV",{class:!0});var Z=k(S);R.l(Z),Z.forEach(h),Ie.forEach(h),$e.forEach(h),g=Q(Be),_=I(Be,"DIV",{});var et=k(_);p=I(et,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(p)!=="svelte-khrbnh"&&(p.innerHTML=w),et.forEach(h),Be.forEach(h),ne.forEach(h),ee.forEach(h),B.forEach(h),this.h()},h(){f(o,"class","flex justify-center items-center flex-1 h-full w-full max-h-full"),f(S,"class","line-clamp-1 text-sm font-medium"),f(b,"type","button"),f(p,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(p,"type","button"),f(i,"class","flex justify-between items-center pb-2 w-full"),f(l,"class","max-w-lg w-full h-screen max-h-[100dvh] flex flex-col justify-between p-3 md:p-6"),f(t,"class","absolute w-full h-screen max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center"),f(e,"class","absolute w-full h-screen max-h-[100dvh] flex z-[999] overflow-hidden")},m(M,B){O(M,e,B),v(e,t),v(t,l),T&&T.m(l,null),v(l,s),v(l,o),W.m(o,null),v(l,r),v(l,i),v(i,a),U[u].m(a,null),v(i,d),v(i,m),v(m,b),v(b,S),R.m(S,null),v(i,g),v(i,_),v(_,p),C=!0,D||(N=[$(b,"click",n[26]),$(p,"click",n[27])],D=!0)},p(M,B){M[3]?T?T.p(M,B):(T=yn(M),T.c(),T.m(l,s)):T&&(T.d(1),T=null),V===(V=A(M))&&W?W.p(M,B):(W.d(1),W=V(M),W&&(W.c(),W.m(o,null)));let ee=u;u=F(M),u===ee?U[u].p(M,B):(Ue(),z(U[ee],1,1,()=>{U[ee]=null}),Pe(),c=U[u],c?c.p(M,B):(c=U[u]=j[u](M),c.c()),H(c,1),c.m(a,null)),le===(le=re(M))&&R?R.p(M,B):(R.d(1),R=le(M),R&&(R.c(),R.m(S,null)))},i(M){C||(H(c),C=!0)},o(M){z(c),C=!1},d(M){M&&h(e),T&&T.d(),W.d(),U[u].d(),R.d(),D=!1,gt(N)}}}function yn(n){let e,t,l;function s(i,a){return i[2]?ri:i[0]||i[1]?si:ni}let o=s(n),r=o(n);return{c(){e=E("button"),r.c(),this.h()},l(i){e=I(i,"BUTTON",{type:!0,class:!0});var a=k(e);r.l(a),a.forEach(h),this.h()},h(){f(e,"type","button"),f(e,"class","flex justify-center items-center w-full h-20 min-h-20")},m(i,a){O(i,e,a),r.m(e,null),t||(l=$(e,"click",n[21]),t=!0)},p(i,a){o===(o=s(i))&&r?r.p(i,a):(r.d(1),r=o(i),r&&(r.c(),r.m(e,null)))},d(i){i&&h(e),r.d(),t=!1,l()}}}function ni(n){let e,t;return{c(){e=E("div"),this.h()},l(l){e=I(l,"DIV",{class:!0}),k(e).forEach(h),this.h()},h(){f(e,"class",t=(n[4]*100>4?" size-[4.5rem]":n[4]*100>2?" size-16":n[4]*100>1?"size-14":"size-12")+" transition-all bg-black dark:bg-white rounded-full")},m(l,s){O(l,e,s)},p(l,s){s[0]&16&&t!==(t=(l[4]*100>4?" size-[4.5rem]":l[4]*100>2?" size-16":l[4]*100>1?"size-14":"size-12")+" transition-all bg-black dark:bg-white rounded-full")&&f(e,"class",t)},d(l){l&&h(e)}}}function si(n){let e,t,l,s,o,r;return{c(){e=ve("svg"),t=ve("style"),l=ge(`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),s=ve("circle"),o=ve("circle"),r=ve("circle"),this.h()},l(i){e=be(i,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var a=k(e);t=be(a,"style",{});var u=k(t);l=_e(u,`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),u.forEach(h),s=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(s).forEach(h),o=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(o).forEach(h),r=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(r).forEach(h),a.forEach(h),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","3"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","3"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","3"),f(e,"class","size-12 text-gray-900 dark:text-gray-400"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){O(i,e,a),v(e,t),v(t,l),v(e,s),v(e,o),v(e,r)},p:we,d(i){i&&h(e)}}}function ri(n){let e,t;return{c(){e=E("div"),t=ge(n[2]),this.h()},l(l){e=I(l,"DIV",{class:!0,style:!0});var s=k(e);t=_e(s,n[2]),s.forEach(h),this.h()},h(){f(e,"class","transition-all rounded-full"),ct(e,"font-size",(n[4]*100>4?"4.5":n[4]*100>2?"4.25":n[4]*100>1?"3.75":"3.5")+"rem"),ct(e,"width","100%"),ct(e,"text-align","center")},m(l,s){O(l,e,s),v(e,t)},p(l,s){s[0]&4&&Se(t,l[2]),s[0]&16&&ct(e,"font-size",(l[4]*100>4?"4.5":l[4]*100>2?"4.25":l[4]*100>1?"3.75":"3.5")+"rem")},d(l){l&&h(e)}}}function oi(n){let e,t,l,s,o,r,i,a='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-6"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg>',u,c;return{c(){e=E("div"),t=E("video"),l=J(),s=E("canvas"),o=J(),r=E("div"),i=E("button"),i.innerHTML=a,this.h()},l(d){e=I(d,"DIV",{class:!0});var m=k(e);t=I(m,"VIDEO",{id:!0,class:!0}),k(t).forEach(h),l=Q(m),s=I(m,"CANVAS",{id:!0,style:!0}),k(s).forEach(h),o=Q(m),r=I(m,"DIV",{class:!0});var b=k(r);i=I(b,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Ye(i)!=="svelte-zfg1vd"&&(i.innerHTML=a),b.forEach(h),m.forEach(h),this.h()},h(){f(t,"id","camera-feed"),t.autoplay=!0,f(t,"class","rounded-2xl h-full min-w-full object-cover object-center"),t.playsInline=!0,f(s,"id","camera-canvas"),ct(s,"display","none"),f(i,"type","button"),f(i,"class","p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full"),f(r,"class","absolute top-4 md:top-8 left-4"),f(e,"class","relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full")},m(d,m){O(d,e,m),v(e,t),v(e,l),v(e,s),v(e,o),v(e,r),v(r,i),u||(c=$(i,"click",n[23]),u=!0)},p:we,d(d){d&&h(e),u=!1,c()}}}function ii(n){let e,t,l;function s(i,a){return i[2]?ui:i[0]||i[1]?ci:ai}let o=s(n),r=o(n);return{c(){e=E("button"),r.c(),this.h()},l(i){e=I(i,"BUTTON",{type:!0});var a=k(e);r.l(a),a.forEach(h),this.h()},h(){f(e,"type","button")},m(i,a){O(i,e,a),r.m(e,null),t||(l=$(e,"click",n[22]),t=!0)},p(i,a){o===(o=s(i))&&r?r.p(i,a):(r.d(1),r=o(i),r&&(r.c(),r.m(e,null)))},d(i){i&&h(e),r.d(),t=!1,l()}}}function ai(n){let e,t;return{c(){e=E("div"),this.h()},l(l){e=I(l,"DIV",{class:!0}),k(e).forEach(h),this.h()},h(){f(e,"class",t=(n[4]*100>4?" size-52":n[4]*100>2?"size-48":n[4]*100>1?"size-[11.5rem]":"size-44")+" transition-all bg-black dark:bg-white rounded-full")},m(l,s){O(l,e,s)},p(l,s){s[0]&16&&t!==(t=(l[4]*100>4?" size-52":l[4]*100>2?"size-48":l[4]*100>1?"size-[11.5rem]":"size-44")+" transition-all bg-black dark:bg-white rounded-full")&&f(e,"class",t)},d(l){l&&h(e)}}}function ci(n){let e,t,l,s,o,r;return{c(){e=ve("svg"),t=ve("style"),l=ge(`.spinner_qM83 {
											animation: spinner_8HQG 1.05s infinite;
										}
										.spinner_oXPr {
											animation-delay: 0.1s;
										}
										.spinner_ZTLf {
											animation-delay: 0.2s;
										}
										@keyframes spinner_8HQG {
											0%,
											57.14% {
												animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
												transform: translate(0);
											}
											28.57% {
												animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
												transform: translateY(-6px);
											}
											100% {
												transform: translate(0);
											}
										}
									`),s=ve("circle"),o=ve("circle"),r=ve("circle"),this.h()},l(i){e=be(i,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var a=k(e);t=be(a,"style",{});var u=k(t);l=_e(u,`.spinner_qM83 {
											animation: spinner_8HQG 1.05s infinite;
										}
										.spinner_oXPr {
											animation-delay: 0.1s;
										}
										.spinner_ZTLf {
											animation-delay: 0.2s;
										}
										@keyframes spinner_8HQG {
											0%,
											57.14% {
												animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
												transform: translate(0);
											}
											28.57% {
												animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
												transform: translateY(-6px);
											}
											100% {
												transform: translate(0);
											}
										}
									`),u.forEach(h),s=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(s).forEach(h),o=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(o).forEach(h),r=be(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),k(r).forEach(h),a.forEach(h),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","3"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","3"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","3"),f(e,"class","size-44 text-gray-900 dark:text-gray-400"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){O(i,e,a),v(e,t),v(t,l),v(e,s),v(e,o),v(e,r)},p:we,d(i){i&&h(e)}}}function ui(n){let e,t;return{c(){e=E("div"),t=ge(n[2]),this.h()},l(l){e=I(l,"DIV",{class:!0,style:!0});var s=k(e);t=_e(s,n[2]),s.forEach(h),this.h()},h(){f(e,"class","transition-all rounded-full"),ct(e,"font-size",(n[4]*100>4?"13":n[4]*100>2?"12":n[4]*100>1?"11.5":"11")+"rem"),ct(e,"width","100%"),ct(e,"text-align","center")},m(l,s){O(l,e,s),v(e,t)},p(l,s){s[0]&4&&Se(t,l[2]),s[0]&16&&ct(e,"font-size",(l[4]*100>4?"13":l[4]*100>2?"12":l[4]*100>1?"11.5":"11")+"rem")},d(l){l&&h(e)}}}function fi(n){let e,t;return e=new It({props:{content:n[8].t("Camera"),$$slots:{default:[hi]},$$scope:{ctx:n}}}),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s[0]&256&&(o.content=l[8].t("Camera")),s[1]&33554432&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function di(n){let e,t;return e=new li({props:{devices:n[5],$$slots:{default:[mi]},$$scope:{ctx:n}}}),e.$on("change",n[24]),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s[0]&32&&(o.devices=l[5]),s[1]&33554432&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function hi(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"></path></svg>',l,s;return{c(){e=E("button"),e.innerHTML=t,this.h()},l(o){e=I(o,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-ehdlsa"&&(e.innerHTML=t),this.h()},h(){f(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(e,"type","button")},m(o,r){O(o,e,r),l||(s=$(e,"click",n[25]),l=!0)},p:we,d(o){o&&h(e),l=!1,s()}}}function mi(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd"></path></svg>';return{c(){e=E("button"),e.innerHTML=t,this.h()},l(l){e=I(l,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-t977tc"&&(e.innerHTML=t),this.h()},h(){f(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(e,"type","button")},m(l,s){O(l,e,s)},p:we,d(l){l&&h(e)}}}function gi(n){let e=n[8].t("Listening...")+"",t;return{c(){t=ge(e)},l(l){t=_e(l,e)},m(l,s){O(l,t,s)},p(l,s){s[0]&256&&e!==(e=l[8].t("Listening...")+"")&&Se(t,e)},d(l){l&&h(t)}}}function _i(n){let e=n[8].t("Tap to interrupt")+"",t;return{c(){t=ge(e)},l(l){t=_e(l,e)},m(l,s){O(l,t,s)},p(l,s){s[0]&256&&e!==(e=l[8].t("Tap to interrupt")+"")&&Se(t,e)},d(l){l&&h(t)}}}function pi(n){let e=n[8].t("Thinking...")+"",t;return{c(){t=ge(e)},l(l){t=_e(l,e)},m(l,s){O(l,t,s)},p(l,s){s[0]&256&&e!==(e=l[8].t("Thinking...")+"")&&Se(t,e)},d(l){l&&h(t)}}}function vi(n){let e,t,l=n[7]&&kn(n);return{c(){l&&l.c(),e=Fe()},l(s){l&&l.l(s),e=Fe()},m(s,o){l&&l.m(s,o),O(s,e,o),t=!0},p(s,o){s[7]?l?(l.p(s,o),o[0]&128&&H(l,1)):(l=kn(s),l.c(),H(l,1),l.m(e.parentNode,e)):l&&(Ue(),z(l,1,1,()=>{l=null}),Pe())},i(s){t||(H(l),t=!0)},o(s){z(l),t=!1},d(s){s&&h(e),l&&l.d(s)}}}function bi(n,e,t){let l,s,o,r;ue(n,Jt,G=>t(40,l=G)),ue(n,kt,G=>t(41,s=G)),ue(n,$t,G=>t(7,o=G));const i=_t("i18n");ue(n,i,G=>t(8,r=G));let{eventTarget:a}=e,{submitPrompt:u}=e,{stopResponse:c}=e,{files:d}=e,{chatId:m}=e,{modelId:b}=e,S=!1,g=!1,_=!1,p=null,w=!1,C=null,D=!1,N=0,T=!1,A,V=[],W=[],j=null;const U=async()=>{const G=await navigator.mediaDevices.enumerateDevices();t(5,W=G.filter(ye=>ye.kind==="videoinput")),navigator.mediaDevices.getDisplayMedia&&t(5,W=[...W,{deviceId:"screen",label:"Screen Share"}]),console.log(W),j===null&&W.length>0&&t(6,j=W[0].deviceId)},F=async()=>{if(await U(),C===null){t(3,w=!0),await Me();try{await re()}catch(G){console.error("Error accessing webcam: ",G)}}},re=async()=>{const G=document.getElementById("camera-feed");G&&(j==="screen"?C=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}):C=await navigator.mediaDevices.getUserMedia({video:{deviceId:j?{exact:j}:void 0}}),C&&(await U(),G.srcObject=C,await G.play()))},le=async()=>{C&&C.getTracks().forEach(ye=>ye.stop()),C=null},R=()=>{const G=document.getElementById("camera-feed"),ye=document.getElementById("camera-canvas");if(!ye)return;const de=ye.getContext("2d");ye.width=G.videoWidth,ye.height=G.videoHeight,de.drawImage(G,0,0,G.videoWidth,G.videoHeight);const he=ye.toDataURL("image/png");return console.log(he),he},M=async()=>{await le(),t(3,w=!1)},B=-55,ee=async G=>{await Me();const ye=cl(G,"recording.wav"),de=await dl(localStorage.token,ye).catch(he=>(Ee.error(he),null));if(de&&(console.log(de.text),de.text!=="")){const he=await u(de.text,{_raw:!0});console.log(he)}},ne=async(G=!0)=>{if(o){console.log("%c%s","color: red; font-size: 20px;","🚨 stopRecordingCallback 🚨");const ye=V.slice(0);if(V=[],A=!1,G&&fe(),g){if(t(0,S=!0),t(2,p=null),C){const he=R();t(15,d=[{type:"image",url:he}])}const de=new Blob(ye,{type:"audio/wav"});await ee(de),g=!1,t(0,S=!1)}}else V=[],A=!1},fe=async()=>{const G=await navigator.mediaDevices.getUserMedia({audio:!0});A=new MediaRecorder(G),A.onstart=()=>{console.log("Recording started"),V=[],Ge(G)},A.ondataavailable=ye=>{T&&V.push(ye.data)},A.onstop=ye=>{console.log("Recording stopped",ye),ne()},A.start()},Be=G=>{let ye=0;for(let de=0;de<G.length;de++){const he=(G[de]-128)/128;ye+=he*he}return Math.sqrt(ye/G.length)},Ge=G=>{const ye=new AudioContext,de=ye.createMediaStreamSource(G),he=ye.createAnalyser();he.minDecibels=B,de.connect(he);const Ae=he.frequencyBinCount,qe=new Uint8Array(Ae),rt=new Uint8Array(he.fftSize);let ot=Date.now();T=!1,console.log("🔊 Sound detection started",ot,T),(()=>{const St=()=>{if(!A||!o)return;if(_?(he.maxDecibels=0,he.minDecibels=-1):(he.minDecibels=B,he.maxDecibels=-30),he.getByteTimeDomainData(rt),he.getByteFrequencyData(qe),t(4,N=Be(rt)),qe.some(Ft=>Ft>0)&&(console.log("%c%s","color: red; font-size: 20px;","🔊 Sound detected"),T||(T=!0,P()),ot=Date.now()),T&&Date.now()-ot>2e3&&(g=!0,A)){console.log("%c%s","color: red; font-size: 20px;","🔇 Silence detected"),A.stop();return}window.requestAnimationFrame(St)};window.requestAnimationFrame(St)})()};let $e={},Ie=null,Z=null;const et=G=>o?new Promise(ye=>{let de=[];const he=setInterval(async()=>{var Ae;if(de=await speechSynthesis.getVoices(),de.length>0){clearInterval(he);const qe=((Ae=de==null?void 0:de.filter(rt=>{var ot,Vt,St,Bt;return rt.voiceURI===(((Vt=(ot=s==null?void 0:s.audio)==null?void 0:ot.tts)==null?void 0:Vt.voice)??((Bt=(St=l==null?void 0:l.audio)==null?void 0:St.tts)==null?void 0:Bt.voice))}))==null?void 0:Ae.at(0))??void 0;Z=new SpeechSynthesisUtterance(G),qe&&(Z.voice=qe),speechSynthesis.speak(Z),Z.onend=async rt=>{await new Promise(ot=>setTimeout(ot,200)),ye(rt)}}},100)}):Promise.resolve(),st=G=>o?new Promise(ye=>{const de=document.getElementById("audioElement");de&&(de.src=G.src,de.muted=!0,de.play().then(()=>{de.muted=!1}).catch(he=>{console.error(he)}),de.onended=async he=>{await new Promise(Ae=>setTimeout(Ae,100)),ye(he)})}):Promise.resolve(),P=async()=>{t(1,_=!1),D&&c(),Z&&(speechSynthesis.cancel(),Z=null);const G=document.getElementById("audioElement");G&&(G.muted=!0,G.pause(),G.currentTime=0)};let Y=new AbortController;const Ne=new Map,Le=new Map,ze=async G=>{var ye,de,he,Ae;if(!Ne.has(G))try{if((s==null?void 0:s.showEmojiInCall)??!1){const qe=await ds(localStorage.token,b,G,m);qe&&Le.set(G,qe)}if(l.audio.tts.engine!==""){const qe=await ys(localStorage.token,((de=(ye=s==null?void 0:s.audio)==null?void 0:ye.tts)==null?void 0:de.voice)??((Ae=(he=l==null?void 0:l.audio)==null?void 0:he.tts)==null?void 0:Ae.voice),G).catch(rt=>(console.error(rt),null));if(qe){const rt=await qe.blob(),ot=URL.createObjectURL(rt);Ne.set(G,new Audio(ot))}}else Ne.set(G,!0)}catch(qe){console.error("Error synthesizing speech:",qe)}return Ne.get(G)};let Je={};const Mt=async(G,ye)=>{for(;!ye.aborted;)if(Je[G]&&Je[G].length>0){const de=Je[G].shift();if(Ne.has(de))if(((s==null?void 0:s.showEmojiInCall)??!1)&&Le.has(de)?t(2,p=Le.get(de)):t(2,p=null),l.audio.tts.engine!=="")try{console.log("%c%s","color: red; font-size: 20px;",`Playing audio for content: ${de}`);const he=Ne.get(de);await st(he),console.log(`Played audio for content: ${de}`),await new Promise(Ae=>setTimeout(Ae,200))}catch(he){console.error("Error playing audio:",he)}else await et(de);else Je[G].unshift(de),console.log(`Audio for "${de}" not yet available in the cache, re-queued...`),await new Promise(he=>setTimeout(he,200))}else if($e[G]&&Je[G]&&Je[G].length===0){t(1,_=!1);break}else await new Promise(de=>setTimeout(de,200));console.log(`Audio monitoring and playing stopped for message ID ${G}`)};tl(async()=>{fe();const G=async he=>{const{id:Ae}=he.detail;D=!0,Ie!==Ae&&(console.log(`Received chat start event for message ID ${Ae}`),Ie=Ae,Y&&Y.abort(),Y=new AbortController,t(1,_=!0),Mt(Ae,Y.signal))},ye=async he=>{const{id:Ae,content:qe}=he.detail;if(Ie===Ae){console.log(`Received chat event for message ID ${Ae}: ${qe}`);try{Je[Ae]===void 0?Je[Ae]=[qe]:Je[Ae].push(qe),console.log(qe),ze(qe)}catch(rt){console.error("Failed to fetch or play audio:",rt)}}},de=async he=>{const{id:Ae,content:qe}=he.detail;$e[Ae]=!0,D=!1};return a.addEventListener("chat:start",G),a.addEventListener("chat",ye),a.addEventListener("chat:finish",de),async()=>{a.removeEventListener("chat:start",G),a.removeEventListener("chat",ye),a.removeEventListener("chat:finish",de),Y.abort(),await Me(),await P(),await ne(!1),await M()}});const Tt=()=>{_&&P()},at=()=>{_&&P()},Ct=()=>{M()},Pt=async G=>{console.log(G.detail),t(6,j=G.detail),await le(),await re()},zt=async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),F()},Rt=()=>{_&&P()},jt=async()=>{$t.set(!1)};return n.$$set=G=>{"eventTarget"in G&&t(16,a=G.eventTarget),"submitPrompt"in G&&t(17,u=G.submitPrompt),"stopResponse"in G&&t(18,c=G.stopResponse),"files"in G&&t(15,d=G.files),"chatId"in G&&t(19,m=G.chatId),"modelId"in G&&t(20,b=G.modelId)},[S,_,p,w,N,W,j,o,r,i,F,re,le,M,P,d,a,u,c,m,b,Tt,at,Ct,Pt,zt,Rt,jt]}class wi extends Ke{constructor(e){super(),xe(this,e,bi,vi,Xe,{eventTarget:16,submitPrompt:17,stopResponse:18,files:15,chatId:19,modelId:20},null,[-1,-1])}}const{document:il}=zn;function En(n,e,t){const l=n.slice();return l[68]=e[t],l}function In(n){var r;let e,t,l;function s(i){n[30](i)}let o={submitPrompt:n[25],stopResponse:n[27],modelId:((r=n[8])==null?void 0:r.at(0))??null,chatId:n[16],eventTarget:n[23]};return n[14]!==void 0&&(o.files=n[14]),e=new wi({props:o}),ke.push(()=>Oe(e,"files",s)),{c(){oe(e.$$.fragment)},l(i){ie(e.$$.fragment,i)},m(i,a){ae(e,i,a),l=!0},p(i,a){var c;const u={};a[0]&256&&(u.modelId=((c=i[8])==null?void 0:c.at(0))??null),a[0]&65536&&(u.chatId=i[16]),!t&&a[0]&16384&&(t=!0,u.files=i[14],He(()=>t=!1)),e.$set(u)},i(i){l||(H(e.$$.fragment,i),l=!0)},o(i){z(e.$$.fragment,i),l=!1},d(i){ce(e,i)}}}function Sn(n){let e,t,l,s,o,r,i,a,u,c,d,m,b,S,g,_,p,w,C,D,N,T,A,V,W,j,U;function F(P){n[31](P)}function re(P){n[32](P)}let le={title:n[12],shareEnabled:n[15].length>0,chat:n[11],initNewChat:n[24]};n[1]!==void 0&&(le.selectedModels=n[1]),n[7]!==void 0&&(le.showModelSelector=n[7]),t=new Yo({props:le}),ke.push(()=>Oe(t,"selectedModels",F)),ke.push(()=>Oe(t,"showModelSelector",re));let R=n[21].length>0&&n[15].length===0&&!n[16]&&n[1].length<=1&&Dn(n);function M(P){n[35](P)}function B(P){n[36](P)}function ee(P){n[37](P)}function ne(P){n[38](P)}let fe={chatId:n[16],selectedModels:n[1],processing:yi,bottomPadding:n[14].length>0,sendPrompt:n[26],continueGeneration:n[29],regenerateResponse:n[28]};n[3]!==void 0&&(fe.history=n[3]),n[15]!==void 0&&(fe.messages=n[15]),n[5]!==void 0&&(fe.autoScroll=n[5]),n[13]!==void 0&&(fe.prompt=n[13]),c=new Rn({props:fe}),ke.push(()=>Oe(c,"history",M)),ke.push(()=>Oe(c,"messages",B)),ke.push(()=>Oe(c,"autoScroll",ee)),ke.push(()=>Oe(c,"prompt",ne));function Be(P){n[42](P)}function Ge(P){n[43](P)}function $e(P){n[44](P)}function Ie(P){n[45](P)}function Z(P){n[46](P)}function et(P){n[47](P)}let st={availableToolIds:n[8].reduce(n[41],[]),selectedModels:n[1],messages:n[15],submitPrompt:n[25],stopResponse:n[27]};return n[14]!==void 0&&(st.files=n[14]),n[13]!==void 0&&(st.prompt=n[13]),n[5]!==void 0&&(st.autoScroll=n[5]),n[9]!==void 0&&(st.selectedToolIds=n[9]),n[10]!==void 0&&(st.webSearchEnabled=n[10]),n[2]!==void 0&&(st.atSelectedModel=n[2]),p=new Eo({props:st}),ke.push(()=>Oe(p,"files",Be)),ke.push(()=>Oe(p,"prompt",Ge)),ke.push(()=>Oe(p,"autoScroll",$e)),ke.push(()=>Oe(p,"selectedToolIds",Ie)),ke.push(()=>Oe(p,"webSearchEnabled",Z)),ke.push(()=>Oe(p,"atSelectedModel",et)),{c(){e=E("div"),oe(t.$$.fragment),o=J(),R&&R.c(),r=J(),i=E("div"),a=E("div"),u=E("div"),oe(c.$$.fragment),_=J(),oe(p.$$.fragment),this.h()},l(P){e=I(P,"DIV",{class:!0});var Y=k(e);ie(t.$$.fragment,Y),o=Q(Y),R&&R.l(Y),r=Q(Y),i=I(Y,"DIV",{class:!0});var Ne=k(i);a=I(Ne,"DIV",{class:!0,id:!0});var Le=k(a);u=I(Le,"DIV",{class:!0});var ze=k(u);ie(c.$$.fragment,ze),ze.forEach(h),Le.forEach(h),_=Q(Ne),ie(p.$$.fragment,Ne),Ne.forEach(h),Y.forEach(h),this.h()},h(){f(u,"class",g="h-full w-full flex flex-col "+(n[0]?"py-4":"pt-2 pb-4")),f(a,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full"),f(a,"id","messages-container"),f(i,"class","flex flex-col flex-auto"),f(e,"class",V="h-screen max-h-[100dvh] "+(n[20]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col")},m(P,Y){O(P,e,Y),ae(t,e,null),v(e,o),R&&R.m(e,null),v(e,r),v(e,i),v(i,a),v(a,u),ae(c,u,null),n[39](a),v(i,_),ae(p,i,null),W=!0,j||(U=$(a,"scroll",n[40]),j=!0)},p(P,Y){const Ne={};Y[0]&4096&&(Ne.title=P[12]),Y[0]&32768&&(Ne.shareEnabled=P[15].length>0),Y[0]&2048&&(Ne.chat=P[11]),!l&&Y[0]&2&&(l=!0,Ne.selectedModels=P[1],He(()=>l=!1)),!s&&Y[0]&128&&(s=!0,Ne.showModelSelector=P[7],He(()=>s=!1)),t.$set(Ne),P[21].length>0&&P[15].length===0&&!P[16]&&P[1].length<=1?R?(R.p(P,Y),Y[0]&2195458&&H(R,1)):(R=Dn(P),R.c(),H(R,1),R.m(e,r)):R&&(Ue(),z(R,1,1,()=>{R=null}),Pe());const Le={};Y[0]&65536&&(Le.chatId=P[16]),Y[0]&2&&(Le.selectedModels=P[1]),Y[0]&16384&&(Le.bottomPadding=P[14].length>0),!d&&Y[0]&8&&(d=!0,Le.history=P[3],He(()=>d=!1)),!m&&Y[0]&32768&&(m=!0,Le.messages=P[15],He(()=>m=!1)),!b&&Y[0]&32&&(b=!0,Le.autoScroll=P[5],He(()=>b=!1)),!S&&Y[0]&8192&&(S=!0,Le.prompt=P[13],He(()=>S=!1)),c.$set(Le),(!W||Y[0]&1&&g!==(g="h-full w-full flex flex-col "+(P[0]?"py-4":"pt-2 pb-4")))&&f(u,"class",g);const ze={};Y[0]&131328&&(ze.availableToolIds=P[8].reduce(P[41],[])),Y[0]&2&&(ze.selectedModels=P[1]),Y[0]&32768&&(ze.messages=P[15]),!w&&Y[0]&16384&&(w=!0,ze.files=P[14],He(()=>w=!1)),!C&&Y[0]&8192&&(C=!0,ze.prompt=P[13],He(()=>C=!1)),!D&&Y[0]&32&&(D=!0,ze.autoScroll=P[5],He(()=>D=!1)),!N&&Y[0]&512&&(N=!0,ze.selectedToolIds=P[9],He(()=>N=!1)),!T&&Y[0]&1024&&(T=!0,ze.webSearchEnabled=P[10],He(()=>T=!1)),!A&&Y[0]&4&&(A=!0,ze.atSelectedModel=P[2],He(()=>A=!1)),p.$set(ze),(!W||Y[0]&1048576&&V!==(V="h-screen max-h-[100dvh] "+(P[20]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col"))&&f(e,"class",V)},i(P){W||(H(t.$$.fragment,P),H(R),H(c.$$.fragment,P),H(p.$$.fragment,P),W=!0)},o(P){z(t.$$.fragment,P),z(R),z(c.$$.fragment,P),z(p.$$.fragment,P),W=!1},d(P){P&&h(e),ce(t),R&&R.d(),ce(c),n[39](null),ce(p),j=!1,U()}}}function Dn(n){let e,t,l,s,o=nt(n[21].filter(n[33])),r=[];for(let a=0;a<o.length;a+=1)r[a]=Mn(En(n,o,a));const i=a=>z(r[a],1,1,()=>{r[a]=null});return{c(){e=E("div"),t=E("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){e=I(a,"DIV",{class:!0});var u=k(e);t=I(u,"DIV",{class:!0});var c=k(t);for(let d=0;d<r.length;d+=1)r[d].l(c);c.forEach(h),u.forEach(h),this.h()},h(){f(t,"class","flex flex-col gap-1 w-full"),f(e,"class",l="absolute top-[4.25rem] w-full "+(n[20]?"md:max-w-[calc(100%-260px)]":""))},m(a,u){O(a,e,u),v(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(t,null);s=!0},p(a,u){if(u[0]&2097152){o=nt(a[21].filter(a[33]));let c;for(c=0;c<o.length;c+=1){const d=En(a,o,c);r[c]?(r[c].p(d,u),H(r[c],1)):(r[c]=Mn(d),r[c].c(),H(r[c],1),r[c].m(t,null))}for(Ue(),c=o.length;c<r.length;c+=1)i(c);Pe()}(!s||u[0]&1048576&&l!==(l="absolute top-[4.25rem] w-full "+(a[20]?"md:max-w-[calc(100%-260px)]":"")))&&f(e,"class",l)},i(a){if(!s){for(let u=0;u<o.length;u+=1)H(r[u]);s=!0}},o(a){r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)z(r[u]);s=!1},d(a){a&&h(e),Dt(r,a)}}}function Mn(n){let e,t;return e=new cr({props:{banner:n[68]}}),e.$on("dismiss",n[34]),{c(){oe(e.$$.fragment)},l(l){ie(e.$$.fragment,l)},m(l,s){ae(e,l,s),t=!0},p(l,s){const o={};s[0]&2097152&&(o.banner=l[68]),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){ce(e,l)}}}function ki(n){let e,t,l,s,o,r,i,a;il.title=e=`
		`+(n[12]?`${n[12].length>30?`${n[12].slice(0,30)}...`:n[12]} | ${n[19]}`:`${n[19]}`)+`
	`;let u=n[18]&&In(n),c=(!n[0]||n[4]&&n[0])&&Sn(n);return{c(){t=J(),l=E("audio"),o=J(),u&&u.c(),r=J(),c&&c.c(),i=Fe(),this.h()},l(d){Pn("svelte-1123lr8",il.head).forEach(h),t=Q(d),l=I(d,"AUDIO",{id:!0,src:!0,style:!0}),k(l).forEach(h),o=Q(d),u&&u.l(d),r=Q(d),c&&c.l(d),i=Fe(),this.h()},h(){f(l,"id","audioElement"),At(l.src,s="")||f(l,"src",s),ct(l,"display","none")},m(d,m){O(d,t,m),O(d,l,m),O(d,o,m),u&&u.m(d,m),O(d,r,m),c&&c.m(d,m),O(d,i,m),a=!0},p(d,m){(!a||m[0]&528384)&&e!==(e=`
		`+(d[12]?`${d[12].length>30?`${d[12].slice(0,30)}...`:d[12]} | ${d[19]}`:`${d[19]}`)+`
	`)&&(il.title=e),d[18]?u?(u.p(d,m),m[0]&262144&&H(u,1)):(u=In(d),u.c(),H(u,1),u.m(r.parentNode,r)):u&&(Ue(),z(u,1,1,()=>{u=null}),Pe()),!d[0]||d[4]&&d[0]?c?(c.p(d,m),m[0]&17&&H(c,1)):(c=Sn(d),c.c(),H(c,1),c.m(i.parentNode,i)):c&&(Ue(),z(c,1,1,()=>{c=null}),Pe())},i(d){a||(H(u),H(c),a=!0)},o(d){z(u),z(c),a=!1},d(d){d&&(h(t),h(l),h(o),h(r),h(i)),u&&u.d(d),c&&c.d(d)}}}let yi="";function Ei(n,e,t){let l,s,o,r,i,a,u,c,d,m,b,S;ue(n,Lt,L=>t(16,l=L)),ue(n,kt,L=>t(51,o=L)),ue(n,ll,L=>t(17,r=L)),ue(n,$t,L=>t(18,i=L)),ue(n,al,L=>t(52,a=L)),ue(n,Jn,L=>t(53,u=L)),ue(n,Fn,L=>t(54,c=L)),ue(n,Jt,L=>t(55,d=L)),ue(n,Nn,L=>t(19,m=L)),ue(n,Kt,L=>t(20,b=L)),ue(n,Qn,L=>t(21,S=L));const g=_t("i18n");ue(n,g,L=>t(50,s=L));let{chatIdProp:_=""}=e,p=!1;const w=new EventTarget;let C=!1,D=!0,N,T=!0,A=[""],V,W=[],j=[],U=!1,F=null,re="",le="",R=[],M=[],B={messages:{},currentId:null};tl(async()=>{l?(o.saveChatHistory??!0)||await sl("/"):Lt.subscribe(async L=>{L||await ee()})});const ee=async()=>{var me;window.history.replaceState(B.state,"","/"),await Lt.set(""),t(5,D=!0),t(12,re=""),t(15,M=[]),t(3,B={messages:{},currentId:null}),c.url.searchParams.get("models")?t(1,A=(me=c.url.searchParams.get("models"))==null?void 0:me.split(",")):o!=null&&o.models?t(1,A=o==null?void 0:o.models):d!=null&&d.default_models?(console.log((d==null?void 0:d.default_models.split(","))??""),t(1,A=d==null?void 0:d.default_models.split(","))):t(1,A=[""]),c.url.searchParams.get("q")&&(t(13,le=c.url.searchParams.get("q")??""),le&&(await Me(),Ie(le))),t(1,A=A.map(x=>r.map(Ve=>Ve.id).includes(x)?x:""));const L=await El(localStorage.token);L?kt.set(L.ui):kt.set(JSON.parse(localStorage.getItem("settings")??"{}"));const X=document.getElementById("chat-textarea");setTimeout(()=>X==null?void 0:X.focus(),0)},ne=async()=>{if(Lt.set(_),t(11,F=await ts(localStorage.token,l).catch(async L=>(await sl("/"),null))),F){await Tt();const L=F.chat;if(L){console.log(L),t(1,A=((L==null?void 0:L.models)??void 0)!==void 0?L.models:[L.models??""]),t(3,B=((L==null?void 0:L.history)??void 0)!==void 0?L.history:Kn(L.messages)),t(12,re=L.title);const X=await El(localStorage.token);return X?await kt.set(X.ui):await kt.set(JSON.parse(localStorage.getItem("settings")??"{}")),await kt.set({...o,system:L.system??o.system,params:L.options??o.params}),t(5,D=!0),await Me(),M.length>0&&t(3,B.messages[M.at(-1).id].done=!0,B),await Me(),!0}else return null}},fe=async()=>{await Me(),N&&t(6,N.scrollTop=N.scrollHeight,N)},Be=L=>{const X=B.messages[L];return X.parentId?[...Be(X.parentId),X]:[X]},Ge=async(L,X)=>{await jn.run({querySelector:".mermaid"});const me=await ms(localStorage.token,{model:L,messages:X.map(x=>({id:x.id,role:x.role,content:x.content,timestamp:x.timestamp})),chat_id:l}).catch(x=>(console.error(x),null));if(me!==null)for(const x of me.messages)t(3,B.messages[x.id]={...B.messages[x.id],...B.messages[x.id].content!==x.content?{originalContent:B.messages[x.id].content}:{},...x},B)},$e=async(L,X="")=>setInterval(()=>{u==null||u.emit("usage",{action:"chat",model:L,chat_id:X})},1e3),Ie=async(L,{_raw:X=!1}={})=>{let me=[];if(console.log("submitPrompt",l),t(1,A=A.map(x=>r.map(Ve=>Ve.id).includes(x)?x:"")),A.includes(""))Ee.error(s.t("Model not selected"));else if(M.length!=0&&M.at(-1).done!=!0)console.log("wait");else if(R.length>0&&R.filter(x=>x.upload_status===!1).length>0)Ee.error(s.t("Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready."));else{const x=document.getElementById("chat-textarea");x&&(x.value="",x.style.height="");const Ve=JSON.parse(JSON.stringify(R));t(14,R=[]),t(13,le="");let q=wl(),Re={id:q,parentId:M.length!==0?M.at(-1).id:null,childrenIds:[],role:"user",content:L,files:Ve.length>0?Ve:void 0,timestamp:Math.floor(Date.now()/1e3),models:A.filter((y,K)=>A.indexOf(y)===K)};t(3,B.messages[q]=Re,B),t(3,B.currentId=q,B),M.length!==0&&B.messages[M.at(-1).id].childrenIds.push(q),await Me(),me=await Z(L,q,{newChat:!0})}return me},Z=async(L,X,{modelId:me=null,newChat:x=!1}={})=>{let Ve=[],q=me?[me]:V!==void 0?[V.id]:A;const Re={};for(const K of q){const te=r.filter(se=>se.id===K).at(0);if(te){let se=wl(),De={parentId:X,id:se,childrenIds:[],role:"assistant",content:"",model:te.id,modelName:te.name??te.id,userContext:null,timestamp:Math.floor(Date.now()/1e3)};t(3,B.messages[se]=De,B),t(3,B.currentId=se,B),X!==null&&t(3,B.messages[X].childrenIds=[...B.messages[X].childrenIds,se],B),Re[K]=se}}await Me(),x&&M.length==2&&(o.saveChatHistory??!0?(t(11,F=await es(localStorage.token,{id:l,title:s.t("New Chat"),models:A,system:o.system??void 0,options:{...o.params??{}},messages:M,history:B,tags:[],timestamp:Date.now()})),await Wt.set(await Zt(localStorage.token)),await Lt.set(F.id)):await Lt.set("local"),await Me());const y=JSON.parse(JSON.stringify(l));return await Promise.all(q.map(async K=>{var se,De,Ze;console.log("modelId",K);const te=r.filter(pt=>pt.id===K).at(0);if(te){M.some(pe=>{var We;return(We=pe.files)==null?void 0:We.some(je=>je.type==="image")})&&!(((Ze=(De=(se=te.info)==null?void 0:se.meta)==null?void 0:De.capabilities)==null?void 0:Ze.vision)??!0)&&Ee.error(s.t("Model {{modelName}} is not vision capable",{modelName:te.name??te.id}));let it=Re[K],vt=B.messages[it],tt=null;if(((o==null?void 0:o.memory)??!1)&&tt===null){const pe=await fs(localStorage.token,L).catch(We=>(Ee.error(We),null));pe&&(pe.documents[0].length>0&&(tt=pe.documents.reduce((We,je,Qe)=>{const Te=pe.metadatas[Qe][0].created_at,Ce=new Date(Te*1e3).toISOString().split("T")[0];return We.push(`${Qe+1}. [${Ce}]. ${je[0]}`),We},[])),console.log(tt))}vt.userContext=tt;const bt=await $e(te.id,y);U&&await Mt(te.id,X,it);let wt=null;(te==null?void 0:te.owned_by)==="openai"?wt=await st(te,L,it,y):te&&(wt=await et(te,L,it,y)),Ve.push(wt),bt&&clearInterval(bt)}else Ee.error(s.t("Model {{modelId}} not found",{modelId:K}))})),await Wt.set(await Zt(localStorage.token)),Ve},et=async(L,X,me,x)=>{var Ze,pt,it,vt,tt,bt,wt;let Ve=null;const q=B.messages[me];await Me(),fe();const Re=[o.system||((q==null?void 0:q.userContext)??null)?{role:"system",content:`${kl((o==null?void 0:o.system)??"",a.name,o!=null&&o.userLocation?await Il(localStorage.token):void 0)}${(q==null?void 0:q.userContext)??null?`

User Context:
${((q==null?void 0:q.userContext)??[]).join(`
`)}`:""}`}:void 0,...M].filter(pe=>{var We;return(We=pe==null?void 0:pe.content)==null?void 0:We.trim()}).map((pe,We,je)=>{var Ce;const Qe={role:pe.role,content:pe.content},Te=(Ce=pe.files)==null?void 0:Ce.filter(lt=>lt.type==="image").map(lt=>lt.url.slice(lt.url.indexOf(",")+1));return Te&&Te.length>0&&pe.role==="user"&&(Qe.images=Te),Qe});let y=-1;Re.forEach((pe,We)=>{pe.images&&(y=We)}),Re.forEach((pe,We)=>{We!==y&&delete pe.images});let K=[];(((pt=(Ze=L==null?void 0:L.info)==null?void 0:Ze.meta)==null?void 0:pt.knowledge)??!1)&&(K=L.info.meta.knowledge),K=[...K,...M.filter(pe=>(pe==null?void 0:pe.files)??null).map(pe=>pe.files.filter(We=>["doc","collection","web_search_results"].includes(We.type))).flat(1)].filter((pe,We,je)=>je.findIndex(Qe=>JSON.stringify(Qe)===JSON.stringify(pe))===We),w.dispatchEvent(new CustomEvent("chat:start",{detail:{id:me}})),await Me();const[te,se]=await xn(localStorage.token,{model:L.id,messages:Re,options:{...o.params??{},stop:((it=o==null?void 0:o.params)==null?void 0:it.stop)??void 0?o.params.stop.map(pe=>decodeURIComponent(JSON.parse('"'+pe.replace(/\"/g,'\\"')+'"'))):void 0,num_predict:((vt=o==null?void 0:o.params)==null?void 0:vt.max_tokens)??void 0,repeat_penalty:((tt=o==null?void 0:o.params)==null?void 0:tt.frequency_penalty)??void 0},format:o.requestFormat??void 0,keep_alive:o.keepAlive??void 0,tool_ids:j.length>0?j:void 0,docs:K.length>0?K:void 0,citations:K.length>0,chat_id:l});if(te&&te.ok){console.log("controller",se);const pe=te.body.pipeThrough(new TextDecoderStream).pipeThrough(Xn(`
`)).getReader();for(;;){const{value:We,done:je}=await pe.read();if(je||C||x!==l){if(q.done=!0,t(15,M),t(3,B),C)se.abort("User: Stop Response");else{const Qe=Be(me);await Ge(L.id,Qe)}Ve=q.content;break}try{let Qe=We.split(`
`);for(const Te of Qe)if(Te!==""){console.log(Te);let Ce=JSON.parse(Te);if("citations"in Ce){q.citations=Ce.citations;continue}if("detail"in Ce)throw Ce;if(Ce.done==!1){if(q.content==""&&Ce.message.content==`
`)continue;{q.content+=Ce.message.content;const lt=Qt(q.content);lt.pop(),lt.length>0&&lt[lt.length-1]!==q.lastSentence&&(q.lastSentence=lt[lt.length-1],w.dispatchEvent(new CustomEvent("chat",{detail:{id:me,content:lt[lt.length-1]}}))),t(15,M),t(3,B)}}else{if(q.done=!0,q.content==""&&(q.error={code:400,content:"Oops! No text generated from Ollama, Please try again."}),q.context=Ce.context??null,q.info={total_duration:Ce.total_duration,load_duration:Ce.load_duration,sample_count:Ce.sample_count,sample_duration:Ce.sample_duration,prompt_eval_count:Ce.prompt_eval_count,prompt_eval_duration:Ce.prompt_eval_duration,eval_count:Ce.eval_count,eval_duration:Ce.eval_duration},t(15,M),t(3,B),o.notificationEnabled&&!document.hasFocus()){const lt=new Notification(`${L.id}`,{body:q.content,icon:`${xt}/static/favicon.png`})}((o==null?void 0:o.responseAutoCopy)??!1)&&yl(q.content),o.responseAutoPlayback&&!i&&(await Me(),(bt=document.getElementById(`speak-button-${q.id}`))==null||bt.click())}}}catch(Qe){console.log(Qe),"detail"in Qe&&Ee.error(Qe.detail);break}D&&fe()}l==x&&(o.saveChatHistory??!0)&&(t(11,F=await ol(localStorage.token,x,{messages:M,history:B,models:A})),await Wt.set(await Zt(localStorage.token)))}else{if(te!==null){const pe=await te.json();console.log(pe),"detail"in pe?(Ee.error(pe.detail),q.error={content:pe.detail}):(Ee.error(pe.error),q.error={content:pe.error})}else Ee.error(s.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})),q.error={content:s.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})};q.done=!0,t(15,M),t(3,B)}C=!1,await Me();let De=((wt=Qt(q.content))==null?void 0:wt.at(-1))??"";if(De&&w.dispatchEvent(new CustomEvent("chat",{detail:{id:me,content:De}})),w.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:me,content:q.content}})),D&&fe(),M.length==2&&M.at(1).content!==""){window.history.replaceState(B.state,"",`/c/${x}`);const pe=await ze(X);await Je(x,pe)}return Ve},st=async(L,X,me,x)=>{var K,te,se,De,Ze,pt,it,vt,tt,bt,wt,pe,We;let Ve=null;const q=B.messages[me];let Re=[];(((te=(K=L==null?void 0:L.info)==null?void 0:K.meta)==null?void 0:te.knowledge)??!1)&&(Re=L.info.meta.knowledge),Re=[...Re,...M.filter(je=>(je==null?void 0:je.files)??null).map(je=>je.files.filter(Qe=>["doc","collection","web_search_results"].includes(Qe.type))).flat(1)].filter((je,Qe,Te)=>Te.findIndex(Ce=>JSON.stringify(Ce)===JSON.stringify(je))===Qe),fe(),w.dispatchEvent(new CustomEvent("chat:start",{detail:{id:me}})),await Me();try{const[je,Qe]=await ns(localStorage.token,{model:L.id,stream:!0,stream_options:((Ze=(De=(se=L.info)==null?void 0:se.meta)==null?void 0:De.capabilities)==null?void 0:Ze.usage)??!1?{include_usage:!0}:void 0,messages:[o.system||((q==null?void 0:q.userContext)??null)?{role:"system",content:`${kl((o==null?void 0:o.system)??"",a.name,o!=null&&o.userLocation?await Il(localStorage.token):void 0)}${(q==null?void 0:q.userContext)??null?`

User Context:
${((q==null?void 0:q.userContext)??[]).join(`
`)}`:""}`}:void 0,...M].filter(Te=>{var Ce;return(Ce=Te==null?void 0:Te.content)==null?void 0:Ce.trim()}).map((Te,Ce,lt)=>{var qt;return{role:Te.role,...((qt=Te.files)==null?void 0:qt.filter(Nt=>Nt.type==="image").length)>0&&Te.role==="user"?{content:[{type:"text",text:lt.length-1!==Ce?Te.content:(Te==null?void 0:Te.raContent)??Te.content},...Te.files.filter(Nt=>Nt.type==="image").map(Nt=>({type:"image_url",image_url:{url:Nt.url}}))]}:{content:lt.length-1!==Ce?Te.content:(Te==null?void 0:Te.raContent)??Te.content}}}),seed:((pt=o==null?void 0:o.params)==null?void 0:pt.seed)??void 0,stop:((it=o==null?void 0:o.params)==null?void 0:it.stop)??void 0?o.params.stop.map(Te=>decodeURIComponent(JSON.parse('"'+Te.replace(/\"/g,'\\"')+'"'))):void 0,temperature:((vt=o==null?void 0:o.params)==null?void 0:vt.temperature)??void 0,top_p:((tt=o==null?void 0:o.params)==null?void 0:tt.top_p)??void 0,frequency_penalty:((bt=o==null?void 0:o.params)==null?void 0:bt.frequency_penalty)??void 0,max_tokens:((wt=o==null?void 0:o.params)==null?void 0:wt.max_tokens)??void 0,tool_ids:j.length>0?j:void 0,docs:Re.length>0?Re:void 0,citations:Re.length>0,chat_id:l},`${Yn}`);if(await Me(),fe(),je&&je.ok&&je.body){const Te=await nr(je.body,o.splitLargeChunks);let Ce=null;for await(const lt of Te){const{value:qt,done:Nt,citations:hl,error:ml,usage:gl}=lt;if(ml){await P(ml,null,L,q);break}if(Nt||C||x!==l){if(q.done=!0,t(15,M),t(3,B),C)Qe.abort("User: Stop Response");else{const yt=Be(me);await Ge(L.id,yt)}Ve=q.content;break}if(gl&&(Ce=gl),hl){q.citations=hl;continue}if(!(q.content==""&&qt==`
`)){{q.content+=qt;const yt=Qt(q.content);yt.pop(),yt.length>0&&yt[yt.length-1]!==q.lastSentence&&(q.lastSentence=yt[yt.length-1],w.dispatchEvent(new CustomEvent("chat",{detail:{id:me,content:yt[yt.length-1]}}))),t(15,M),t(3,B)}D&&fe()}}if(o.notificationEnabled&&!document.hasFocus()){const lt=new Notification(`${L.id}`,{body:q.content,icon:`${xt}/static/favicon.png`})}o.responseAutoCopy&&yl(q.content),o.responseAutoPlayback&&!i&&(await Me(),(pe=document.getElementById(`speak-button-${q.id}`))==null||pe.click()),Ce&&(q.info={...Ce,openai:!0}),l==x&&(o.saveChatHistory??!0)&&(t(11,F=await ol(localStorage.token,x,{models:A,messages:M,history:B})),await Wt.set(await Zt(localStorage.token)))}else await P(null,je,L,q)}catch(je){await P(je,null,L,q)}t(15,M),t(3,B),C=!1,await Me();let y=((We=Qt(q.content))==null?void 0:We.at(-1))??"";if(y&&w.dispatchEvent(new CustomEvent("chat",{detail:{id:me,content:y}})),w.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:me,content:q.content}})),D&&fe(),M.length==2){window.history.replaceState(B.state,"",`/c/${x}`);const je=await ze(X);await Je(x,je)}return Ve},P=async(L,X,me,x)=>{let Ve="",q;L?q=L:X!==null&&(q=await X.json()),console.error(q),"detail"in q?(Ee.error(q.detail),Ve=q.detail):"error"in q?"message"in q.error?(Ee.error(q.error.message),Ve=q.error.message):(Ee.error(q.error),Ve=q.error):"message"in q&&(Ee.error(q.message),Ve=q.message),x.error={content:s.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:me.name??me.id})+`
`+Ve},x.done=!0,t(15,M),t(3,B)},Y=()=>{C=!0,console.log("stopResponse")},Ne=async L=>{if(console.log("regenerateResponse"),M.length!=0){let X=B.messages[L.parentId],me=X.content;((X==null?void 0:X.models)??[...A]).length==1?await Z(me,X.id):await Z(me,X.id,{modelId:L.model})}},Le=async()=>{console.log("continueGeneration");const L=JSON.parse(JSON.stringify(l));if(M.length!=0&&M.at(-1).done==!0){const X=B.messages[B.currentId];X.done=!1,await Me();const me=r.filter(x=>x.id===X.model).at(0);me&&((me==null?void 0:me.owned_by)==="openai"?await st(me,B.messages[X.parentId].content,X.id,L):await et(me,B.messages[X.parentId].content,X.id,L))}else Ee.error(s.t("Model {{modelId}} not found",{modelId}))},ze=async L=>{var X;return((X=o==null?void 0:o.title)==null?void 0:X.auto)??!0?await hs(localStorage.token,A[0],L,l).catch(x=>(console.error(x),"New Chat")):`${L}`},Je=async(L,X)=>{L===l&&t(12,re=X),(o.saveChatHistory??!0)&&(t(11,F=await ol(localStorage.token,L,{title:X})),await Wt.set(await Zt(localStorage.token)))},Mt=async(L,X,me)=>{const x=B.messages[me];x.statusHistory=[{done:!1,action:"web_search",description:s.t("Generating search query")}],t(15,M),t(3,B);const Ve=B.messages[X].content;let q=await gs(localStorage.token,L,M,Ve).catch(y=>(console.log(y),Ve));q||(Ee.warning(s.t("No search query generated")),x.statusHistory.push({done:!0,error:!0,action:"web_search",description:"No search query generated"}),t(15,M),t(3,B)),x.statusHistory.push({done:!1,action:"web_search",description:s.t('Searching "{{searchQuery}}"',{searchQuery:q})}),t(15,M),t(3,B);const Re=await is(localStorage.token,q).catch(y=>(console.log(y),Ee.error(y),null));Re?(x.statusHistory.push({done:!0,action:"web_search",description:s.t("Searched {{count}} sites",{count:Re.filenames.length}),query:q,urls:Re.filenames}),((x==null?void 0:x.files)??!0)&&(x.files=[]),x.files.push({collection_name:Re.collection_name,name:q,type:"web_search_results",urls:Re.filenames}),t(15,M),t(3,B)):(x.statusHistory.push({done:!0,error:!0,action:"web_search",description:"No search results found"}),t(15,M),t(3,B))},Tt=async()=>await ls(localStorage.token,l).catch(async L=>[]);function at(L){R=L,t(14,R)}function Ct(L){A=L,t(1,A)}function Pt(L){T=L,t(7,T)}const zt=L=>L.dismissible?!JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]").includes(L.id):!0,Rt=L=>{const X=L.detail;localStorage.setItem("dismissedBannerIds",JSON.stringify([X,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(me=>S.find(x=>x.id===me))))};function jt(L){B=L,t(3,B)}function G(L){M=L,t(15,M),t(3,B)}function ye(L){D=L,t(5,D)}function de(L){le=L,t(13,le)}function he(L){ke[L?"unshift":"push"](()=>{N=L,t(6,N)})}const Ae=L=>{t(5,D=N.scrollHeight-N.scrollTop<=N.clientHeight+5)},qe=(L,X,me,x)=>{var q,Re;const Ve=r.find(y=>y.id===X);return((Re=(q=Ve==null?void 0:Ve.info)==null?void 0:q.meta)==null?void 0:Re.toolIds)??!1?[...new Set([...L,...Ve.info.meta.toolIds])]:L};function rt(L){R=L,t(14,R)}function ot(L){le=L,t(13,le)}function Vt(L){D=L,t(5,D)}function St(L){j=L,t(9,j)}function Bt(L){U=L,t(10,U)}function Ft(L){V=L,t(2,V)}return n.$$set=L=>{"chatIdProp"in L&&t(0,_=L.chatIdProp)},n.$$.update=()=>{if(n.$$.dirty[0]&6&&t(8,W=V!==void 0?[V.id]:A),n.$$.dirty[0]&8)if(B.currentId!==null){let L=[],X=B.messages[B.currentId];for(;X!==null;)L.unshift({...X}),X=X.parentId!==null?B.messages[X.parentId]:null;t(15,M=L)}else t(15,M=[]);n.$$.dirty[0]&1&&_&&(async()=>{if(console.log(_),_&&await ne()){await Me(),t(4,p=!0),window.setTimeout(()=>fe(),0);const L=document.getElementById("chat-textarea");L==null||L.focus()}else await sl("/")})()},[_,A,V,B,p,D,N,T,W,j,U,F,re,le,R,M,l,r,i,m,b,S,g,w,ee,Ie,Z,Y,Ne,Le,at,Ct,Pt,zt,Rt,jt,G,ye,de,he,Ae,qe,rt,ot,Vt,St,Bt,Ft]}class ra extends Ke{constructor(e){super(),xe(this,e,Ei,ki,Xe,{chatIdProp:0},null,[-1,-1,-1])}}export{ra as C};
//# sourceMappingURL=Chat.513f3349.js.map
