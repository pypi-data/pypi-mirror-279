import{aL as k,al as D,cH as B,cI as E,V as N,D as w,br as v,W as f,m as c,B as L,_ as A,Y as i,Z as a,X as n,$ as l,ar as U,as as p,S as d,aj as h,aH as u,aP as _,aF as I,aO as P,bo as b,aJ as g}from"./admin-drawer-panel-vQfT7tFo.js";import{S as O,a as M,V as m}from"./VTextField-CLXM8_Dv.js";import{V as F}from"./VDialog-DqQgZayw.js";const R={name:"ChangePasswordDialog",components:{SubmitFooter:O,CloseButton:k,DrawerItem:D},props:{user:{type:Object,required:!0},isAdminMode:{type:Boolean,default:!1},size:{type:String,default:"default"},density:{type:String,default:"default"}},data(){return{rules:{oldPassword:[e=>!!e||"Old Password is required"],password:[e=>e?e.length<this.MIN_PASSWORD_LENGTH?`Password must be ${this.MIN_PASSWORD_LENGTH} characters long`:e===this.credentials.oldPassword?"New password must be different than old password":!0:"New Password is required"],passwordConfirm:[e=>e===this.credentials.password||"Passwords must match"]},credentials:{oldPassword:"",password:"",passwordConfirm:""},submitButtonEnabled:!1,mdiLockReset:B,mdiLockPlusOutline:E}},computed:{...N(w,{formErrors:e=>e.form.errors,formSuccess:e=>e.form.success,MIN_PASSWORD_LEN:e=>e.MIN_PASSWORD_LEN}),...v(c,["showChangePasswordDialog"])},watch:{showChangePasswordDialog(e){if(e){const s=this.$refs.form;s&&s.reset(),this.clearErrors()}},credentials:{handler(){const e=this.$refs.form;if(!e){this.submitButtonEnabled=!1;return}e.validate().then(({valid:s})=>this.submitButtonEnabled=s).catch(()=>{this.submitButtonEnabled=!1})},deep:!0}},mounted(){window.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){window.removeEventListener("keyup",this._keyUpListener)},methods:{...f(c,["changePassword"]),...f(w,["clearErrors"]),doUserChange(){return L().changeUserPassword(this.user.pk,this.credentials).catch(console.error)},doSelfChange(){return this.changePassword(this.credentials).catch(console.error)},submit(){const e=this.$refs.form;e&&e.validate().then(({valid:s})=>{if(s)return this.isAdminMode?this.doUserChange():this.doSelfChange()}).catch(console.error)},_keyUpListener(e){e.stopImmediatePropagation()}}},W={key:0,class:"codexFormSuccess"},z=["value"];function H(e,s,t,T,r,C){const S=i("DrawerItem"),y=i("CloseButton"),V=i("SubmitFooter");return t.user?(a(),n(F,{key:0,modelValue:e.showChangePasswordDialog,"onUpdate:modelValue":s[7]||(s[7]=o=>e.showChangePasswordDialog=o),origin:"center-top",transition:"slide-y-transition","max-width":"22em"},{activator:l(({props:o})=>[t.isAdminMode?(a(),n(U,p({key:0,icon:""},o,{size:t.size,density:t.density,title:"Change Password"}),{default:l(()=>[d(_,null,{default:l(()=>[h(u(r.mdiLockPlusOutline),1)]),_:1})]),_:2},1040,["size","density"])):(a(),n(S,p({key:1,"prepend-icon":r.mdiLockReset},o,{title:"Change Password"}),null,16,["prepend-icon"]))]),default:l(()=>[e.formSuccess?(a(),I("div",W,[h(u(e.formSuccess)+" ",1),d(y,{onClick:s[0]||(s[0]=o=>e.showChangePasswordDialog=!1)})])):(a(),n(M,{key:1,ref:"form",class:"changePasswordForm"},{default:l(()=>[P("h2",null,"User "+u(t.user.username),1),P("input",{name:"username",autocomplete:"username",disabled:"",type:"text",class:"hidden",value:t.user.username},null,8,z),t.isAdminMode?g("",!0):(a(),n(m,{key:0,ref:"oldPassword",modelValue:r.credentials.oldPassword,"onUpdate:modelValue":s[1]||(s[1]=o=>r.credentials.oldPassword=o),autocomplete:"current-password",label:"Old Password",rules:r.rules.oldPassword,clearable:"",type:"password",autofocus:"",onKeydown:s[2]||(s[2]=b(o=>e.$refs.password.focus(),["enter"]))},null,8,["modelValue","rules"])),d(m,{ref:"password",modelValue:r.credentials.password,"onUpdate:modelValue":s[3]||(s[3]=o=>r.credentials.password=o),autocomplete:"new-password",label:"New Password",rules:r.rules.password,clearable:"",type:"password",autofocus:t.isAdminMode,onKeydown:s[4]||(s[4]=b(o=>e.$refs.passwordConfirm.focus(),["enter"]))},null,8,["modelValue","rules","autofocus"]),d(m,{ref:"passwordConfirm",modelValue:r.credentials.passwordConfirm,"onUpdate:modelValue":s[5]||(s[5]=o=>r.credentials.passwordConfirm=o),autocomplete:"new-password",label:"Confirm Password",rules:r.rules.passwordConfirm,clearable:"",type:"password"},null,8,["modelValue","rules"]),d(V,{verb:"Change",table:"Password",disabled:!r.submitButtonEnabled,onSubmit:C.submit,onCancel:s[6]||(s[6]=o=>e.showChangePasswordDialog=!1)},null,8,["disabled","onSubmit"])]),_:1},512))]),_:1},8,["modelValue"])):g("",!0)}const G=A(R,[["render",H],["__scopeId","data-v-29c23ebe"]]);export{G as C};
