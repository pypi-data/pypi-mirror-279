SELECT
    flat_similarity_clusters.*
FROM
    flat_similarity_clusters
    {% include "_similarity_join_filtering.jinja2" %}
WHERE
    True
    {% include "_composite_filter.jinja2" %}
ORDER BY
--{% if similarity_using_vector_db and anchor_media_id and cosine_similarity %}
(image_vector.embedding {{ similarity_metric }} anchor.embedding) DESC
--{% elif similarity_using_vector_db and anchor_media_id %}
(image_vector.embedding {{ similarity_metric }} anchor.embedding) ASC
--{% elif anchor_media_id %}
distance DESC
--{% else %}
preview_order ASC
--{% endif %}
--{% if page_number %}
OFFSET {{ page_number * page_size }} LIMIT {{ page_size }}
--{% else %}
LIMIT {{ page_size }}
--{% endif %}
