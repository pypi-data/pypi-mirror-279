
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Behind the Scenes &#8212; Django Compressor 4.3.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Jinja2 Support" href="jinja2.html" />
    <link rel="prev" title="Remote Storages" href="remote-storages.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="behind-the-scenes">
<span id="id1"></span><h1>Behind the Scenes<a class="headerlink" href="#behind-the-scenes" title="Permalink to this headline">¶</a></h1>
<p>This document assumes you already have an up and running instance of
Django Compressor, and that you understand how to use it in your templates.
The goal is to explain what the main template tag, {% compress %}, does
behind the scenes, to help you debug performance problems for instance.</p>
<section id="offline-compression">
<h2>Offline compression<a class="headerlink" href="#offline-compression" title="Permalink to this headline">¶</a></h2>
<p>If offline compression is activated, the {% compress %} tag will try to
retrieve the compressed version for its nodelist from the offline manifest
cache. It doesn’t parse, doesn’t check the modified times of the files, doesn’t
even know which files are concerned actually, since it doesn’t look inside the
nodelist of the template block enclosed by the <code class="docutils literal notranslate"><span class="pre">compress</span></code> template tag.
The offline cache manifest is just a json file, stored on disk inside the
directory that holds the compressed files. The format of the manifest is simply
a key-value dictionary, with the hash of the nodelist being the key,
and the HTML containing the element code for the combined file or piece of code
being the value. The <code class="docutils literal notranslate"><span class="pre">compress</span></code> management command generates the
offline manifest as well as the combined files referenced in the manifest.</p>
<p>If offline compression is enabled and the nodelist hash can not be found inside the
manifest, {% compress %} will raise an <code class="docutils literal notranslate"><span class="pre">OfflineGenerationError</span></code>.</p>
<p>If offline compression is disabled, the following happens:</p>
</section>
<section id="first-step-parsing-and-file-list">
<h2>First step: parsing and file list<a class="headerlink" href="#first-step-parsing-and-file-list" title="Permalink to this headline">¶</a></h2>
<p>A compressor instance is created, which in turns instantiates the HTML parser.
The parser is used to determine a file or code hunk list. Each file mtime is
checked, first in cache and then on disk/storage, and this is used to
determine an unique cache key.</p>
</section>
<section id="second-step-checking-the-main-cache">
<h2>Second step: Checking the “main” cache<a class="headerlink" href="#second-step-checking-the-main-cache" title="Permalink to this headline">¶</a></h2>
<p>Compressor checks if it can get some info about the combined file/hunks
corresponding to its instance, using the cache key obtained in the previous
step. The cache content here will actually be the HTML containing the final
element code, just like in the offline step before.</p>
<p>Everything stops here if the cache entry exists.</p>
</section>
<section id="third-step-generating-the-combined-file-if-needed">
<h2>Third step: Generating the combined file if needed<a class="headerlink" href="#third-step-generating-the-combined-file-if-needed" title="Permalink to this headline">¶</a></h2>
<p>The file is generated if necessary. All precompilers are called and all
filters are executed, and a hash is determined from the contents. This in
turns helps determine the file name, which is only saved if it didn’t exist
already. Then the HTML output is returned (and also saved in the cache).
And that’s it!</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Django Compressor</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="scenarios.html">Common Deployment Scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote-storages.html">Remote Storages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Behind the Scenes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#offline-compression">Offline compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="#first-step-parsing-and-file-list">First step: parsing and file list</a></li>
<li class="toctree-l2"><a class="reference internal" href="#second-step-checking-the-main-cache">Second step: Checking the “main” cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="#third-step-generating-the-combined-file-if-needed">Third step: Generating the combined file if needed</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="jinja2.html">Jinja2 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="django-sekizai.html">django-sekizai Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="reactjs.html">Facebook React Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="remote-storages.html" title="previous chapter">Remote Storages</a></li>
      <li>Next: <a href="jinja2.html" title="next chapter">Jinja2 Support</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Django Compressor authors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/behind-the-scenes.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>